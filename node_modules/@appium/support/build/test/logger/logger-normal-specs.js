"use strict";

require("source-map-support/register");

var _helpers = require("./helpers");

const LOG_LEVELS = ['silly', 'verbose', 'info', 'http', 'warn', 'error'];
describe('normal logger', function () {
  let writers, log;
  beforeEach(function () {
    writers = (0, _helpers.setupWriters)();
    log = (0, _helpers.getDynamicLogger)(false, false);
    log.level = 'silly';
  });
  afterEach(function () {
    (0, _helpers.restoreWriters)(writers);
  });
  it('should not rewrite log levels outside of testing', function () {
    for (const levelName of LOG_LEVELS) {
      log[levelName](levelName);
      (0, _helpers.assertOutputContains)(writers, levelName);
    }
  });
  it('throw should not rewrite log levels outside of testing and throw error', function () {
    (() => {
      log.errorAndThrow('msg1');
    }).should.throw('msg1');
    (() => {
      log.errorAndThrow(new Error('msg2'));
    }).should.throw('msg2');
    (0, _helpers.assertOutputContains)(writers, 'msg1');
    (0, _helpers.assertOutputContains)(writers, 'msg2');
  });
  it('should get and set log levels', function () {
    log.level = 'warn';
    log.level.should.equal('warn');
    log.info('information');
    log.warn('warning');
    (0, _helpers.assertOutputDoesntContain)(writers, 'information');
    (0, _helpers.assertOutputContains)(writers, 'warning');
  });
  it('should split lines of multi-line logs', function () {
    log.level = 'warn';
    log.warn('this is one line\nand this is another');
    (0, _helpers.assertOutputDoesntContain)(writers, 'this is one line\nand this is another');
    (0, _helpers.assertOutputContains)(writers, 'this is one line');
    (0, _helpers.assertOutputContains)(writers, 'and this is another');
  });
  it('should split stack trace of Error', function () {
    log.level = 'warn';
    let error = new Error('this is an error');
    error.stack = 'stack line 1\nstack line 2';
    log.warn(error);
    (0, _helpers.assertOutputDoesntContain)(writers, 'stack line 1\nstack line 2');
    (0, _helpers.assertOutputContains)(writers, 'stack line 1');
    (0, _helpers.assertOutputContains)(writers, 'stack line 2');
  });
});
describe('normal logger with static prefix', function () {
  let writers, log;
  const PREFIX = 'my_static_prefix';
  before(function () {
    writers = (0, _helpers.setupWriters)();
    log = (0, _helpers.getDynamicLogger)(false, false, PREFIX);
    log.level = 'silly';
  });
  after(function () {
    (0, _helpers.restoreWriters)(writers);
  });
  it('should not rewrite log levels outside of testing', function () {
    for (const levelName of LOG_LEVELS) {
      log[levelName](levelName);
      (0, _helpers.assertOutputContains)(writers, levelName);
      (0, _helpers.assertOutputContains)(writers, PREFIX);
    }
  });
  it('throw should not rewrite log levels outside of testing and throw error', function () {
    (() => {
      log.errorAndThrow('msg');
    }).should.throw('msg');
    (0, _helpers.assertOutputContains)(writers, 'error');
    (0, _helpers.assertOutputContains)(writers, PREFIX);
  });
});
describe('normal logger with dynamic prefix', function () {
  let writers, log;
  const PREFIX = 'my_dynamic_prefix';
  before(function () {
    writers = (0, _helpers.setupWriters)();
    log = (0, _helpers.getDynamicLogger)(false, false, () => PREFIX);
    log.level = 'silly';
  });
  after(function () {
    (0, _helpers.restoreWriters)(writers);
  });
  it('should not rewrite log levels outside of testing', function () {
    for (const levelName of LOG_LEVELS) {
      log[levelName](levelName);
      (0, _helpers.assertOutputContains)(writers, levelName);
      (0, _helpers.assertOutputContains)(writers, PREFIX);
    }
  });
  it('throw should not rewrite log levels outside of testing and throw error', function () {
    (() => {
      log.errorAndThrow('msg');
    }).should.throw('msg');
    (0, _helpers.assertOutputContains)(writers, 'error');
    (0, _helpers.assertOutputContains)(writers, PREFIX);
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvbG9nZ2VyL2xvZ2dlci1ub3JtYWwtc3BlY3MuanMiXSwibmFtZXMiOlsiTE9HX0xFVkVMUyIsImRlc2NyaWJlIiwid3JpdGVycyIsImxvZyIsImJlZm9yZUVhY2giLCJsZXZlbCIsImFmdGVyRWFjaCIsIml0IiwibGV2ZWxOYW1lIiwiZXJyb3JBbmRUaHJvdyIsInNob3VsZCIsInRocm93IiwiRXJyb3IiLCJlcXVhbCIsImluZm8iLCJ3YXJuIiwiZXJyb3IiLCJzdGFjayIsIlBSRUZJWCIsImJlZm9yZSIsImFmdGVyIl0sIm1hcHBpbmdzIjoiOzs7O0FBRUE7O0FBR0EsTUFBTUEsVUFBVSxHQUFHLENBQUMsT0FBRCxFQUFVLFNBQVYsRUFBcUIsTUFBckIsRUFBNkIsTUFBN0IsRUFBcUMsTUFBckMsRUFBNkMsT0FBN0MsQ0FBbkI7QUFFQUMsUUFBUSxDQUFDLGVBQUQsRUFBa0IsWUFBWTtBQUNwQyxNQUFJQyxPQUFKLEVBQWFDLEdBQWI7QUFDQUMsRUFBQUEsVUFBVSxDQUFDLFlBQVk7QUFDckJGLElBQUFBLE9BQU8sR0FBRyw0QkFBVjtBQUNBQyxJQUFBQSxHQUFHLEdBQUcsK0JBQWlCLEtBQWpCLEVBQXdCLEtBQXhCLENBQU47QUFDQUEsSUFBQUEsR0FBRyxDQUFDRSxLQUFKLEdBQVksT0FBWjtBQUNELEdBSlMsQ0FBVjtBQU1BQyxFQUFBQSxTQUFTLENBQUMsWUFBWTtBQUNwQixpQ0FBZUosT0FBZjtBQUNELEdBRlEsQ0FBVDtBQUlBSyxFQUFBQSxFQUFFLENBQUMsa0RBQUQsRUFBcUQsWUFBWTtBQUNqRSxTQUFLLE1BQU1DLFNBQVgsSUFBd0JSLFVBQXhCLEVBQW9DO0FBQ2xDRyxNQUFBQSxHQUFHLENBQUNLLFNBQUQsQ0FBSCxDQUFlQSxTQUFmO0FBQ0EseUNBQXFCTixPQUFyQixFQUE4Qk0sU0FBOUI7QUFDRDtBQUNGLEdBTEMsQ0FBRjtBQU1BRCxFQUFBQSxFQUFFLENBQUMsd0VBQUQsRUFBMkUsWUFBWTtBQUN2RixLQUFDLE1BQU07QUFB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c291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCB7IGdldER5bmFtaWNMb2dnZXIsIHJlc3RvcmVXcml0ZXJzLCBzZXR1cFdyaXRlcnMsXG4gICAgICAgICBhc3NlcnRPdXRwdXRDb250YWlucywgYXNzZXJ0T3V0cHV0RG9lc250Q29udGFpbiB9IGZyb20gJy4vaGVscGVycyc7XG5cbmNvbnN0IExPR19MRVZFTFMgPSBbJ3NpbGx5JywgJ3ZlcmJvc2UnLCAnaW5mbycsICdodHRwJywgJ3dhcm4nLCAnZXJyb3InXTtcblxuZGVzY3JpYmUoJ25vcm1hbCBsb2dnZXInLCBmdW5jdGlvbiAoKSB7XG4gIGxldCB3cml0ZXJzLCBsb2c7XG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIHdyaXRlcnMgPSBzZXR1cFdyaXRlcnMoKTtcbiAgICBsb2cgPSBnZXREeW5hbWljTG9nZ2VyKGZhbHNlLCBmYWxzZSk7XG4gICAgbG9nLmxldmVsID0gJ3NpbGx5JztcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICByZXN0b3JlV3JpdGVycyh3cml0ZXJzKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3QgcmV3cml0ZSBsb2cgbGV2ZWxzIG91dHNpZGUgb2YgdGVzdGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKGNvbnN0IGxldmVsTmFtZSBvZiBMT0dfTEVWRUxTKSB7XG4gICAgICBsb2dbbGV2ZWxOYW1lXShsZXZlbE5hbWUpO1xuICAgICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgbGV2ZWxOYW1lKTtcbiAgICB9XG4gIH0pO1xuICBpdCgndGhyb3cgc2hvdWxkIG5vdCByZXdyaXRlIGxvZyBsZXZlbHMgb3V0c2lkZSBvZiB0ZXN0aW5nIGFuZCB0aHJvdyBlcnJvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAoKCkgPT4geyBsb2cuZXJyb3JBbmRUaHJvdygnbXNnMScpOyB9KS5zaG91bGQudGhyb3coJ21zZzEnKTtcbiAgICAoKCkgPT4geyBsb2cuZXJyb3JBbmRUaHJvdyhuZXcgRXJyb3IoJ21zZzInKSk7IH0pLnNob3VsZC50aHJvdygnbXNnMicpO1xuICAgIGFzc2VydE91dHB1dENvbnRhaW5zKHdyaXRlcnMsICdtc2cxJyk7XG4gICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgJ21zZzInKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZ2V0IGFuZCBzZXQgbG9nIGxldmVscycsIGZ1bmN0aW9uICgpIHtcbiAgICBsb2cubGV2ZWwgPSAnd2Fybic7XG4gICAgbG9nLmxldmVsLnNob3VsZC5lcXVhbCgnd2FybicpO1xuICAgIGxvZy5pbmZvKCdpbmZvcm1hdGlvbicpO1xuICAgIGxvZy53YXJuKCd3YXJuaW5nJyk7XG4gICAgYXNzZXJ0T3V0cHV0RG9lc250Q29udGFpbih3cml0ZXJzLCAnaW5mb3JtYXRpb24nKTtcbiAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCAnd2FybmluZycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBzcGxpdCBsaW5lcyBvZiBtdWx0aS1saW5lIGxvZ3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgbG9nLmxldmVsID0gJ3dhcm4nO1xuICAgIGxvZy53YXJuKCd0aGlzIGlzIG9uZSBsaW5lXFxuYW5kIHRoaXMgaXMgYW5vdGhlcicpO1xuICAgIGFzc2VydE91dHB1dERvZXNudENvbnRhaW4od3JpdGVycywgJ3RoaXMgaXMgb25lIGxpbmVcXG5hbmQgdGhpcyBpcyBhbm90aGVyJyk7XG4gICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgJ3RoaXMgaXMgb25lIGxpbmUnKTtcbiAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCAnYW5kIHRoaXMgaXMgYW5vdGhlcicpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBzcGxpdCBzdGFjayB0cmFjZSBvZiBFcnJvcicsIGZ1bmN0aW9uICgpIHtcbiAgICBsb2cubGV2ZWwgPSAnd2Fybic7XG4gICAgbGV0IGVycm9yID0gbmV3IEVycm9yKCd0aGlzIGlzIGFuIGVycm9yJyk7XG4gICAgZXJyb3Iuc3RhY2sgPSAnc3RhY2sgbGluZSAxXFxuc3RhY2sgbGluZSAyJztcbiAgICBsb2cud2FybihlcnJvcik7XG4gICAgYXNzZXJ0T3V0cHV0RG9lc250Q29udGFpbih3cml0ZXJzLCAnc3RhY2sgbGluZSAxXFxuc3RhY2sgbGluZSAyJyk7XG4gICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgJ3N0YWNrIGxpbmUgMScpO1xuICAgIGFzc2VydE91dHB1dENvbnRhaW5zKHdyaXRlcnMsICdzdGFjayBsaW5lIDInKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ25vcm1hbCBsb2dnZXIgd2l0aCBzdGF0aWMgcHJlZml4JywgZnVuY3Rpb24gKCkge1xuICBsZXQgd3JpdGVycywgbG9nO1xuICBjb25zdCBQUkVGSVggPSAnbXlfc3RhdGljX3ByZWZpeCc7XG5cbiAgYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgICB3cml0ZXJzID0gc2V0dXBXcml0ZXJzKCk7XG4gICAgbG9nID0gZ2V0RHluYW1pY0xvZ2dlcihmYWxzZSwgZmFsc2UsIFBSRUZJWCk7XG4gICAgbG9nLmxldmVsID0gJ3NpbGx5JztcbiAgfSk7XG5cbiAgYWZ0ZXIoZnVuY3Rpb24gKCkge1xuICAgIHJlc3RvcmVXcml0ZXJzKHdyaXRlcnMpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCByZXdyaXRlIGxvZyBsZXZlbHMgb3V0c2lkZSBvZiB0ZXN0aW5nJywgZnVuY3Rpb24gKCkge1xuICAgIGZvciAoY29uc3QgbGV2ZWxOYW1lIG9mIExPR19MRVZFTFMpIHtcbiAgICAgIGxvZ1tsZXZlbE5hbWVdKGxldmVsTmFtZSk7XG4gICAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCBsZXZlbE5hbWUpO1xuICAgICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgUFJFRklYKTtcbiAgICB9XG4gIH0pO1xuICBpdCgndGhyb3cgc2hvdWxkIG5vdCByZXdyaXRlIGxvZyBsZXZlbHMgb3V0c2lkZSBvZiB0ZXN0aW5nIGFuZCB0aHJvdyBlcnJvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAoKCkgPT4geyBsb2cuZXJyb3JBbmRUaHJvdygnbXNnJyk7IH0pLnNob3VsZC50aHJvdygnbXNnJyk7XG4gICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgJ2Vycm9yJyk7XG4gICAgYXNzZXJ0T3V0cHV0Q29udGFpbnMod3JpdGVycywgUFJFRklYKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ25vcm1hbCBsb2dnZXIgd2l0aCBkeW5hbWljIHByZWZpeCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHdyaXRlcnMsIGxvZztcbiAgY29uc3QgUFJFRklYID0gJ215X2R5bmFtaWNfcHJlZml4JztcblxuICBiZWZvcmUoZnVuY3Rpb24gKCkge1xuICAgIHdyaXRlcnMgPSBzZXR1cFdyaXRlcnMoKTtcbiAgICBsb2cgPSBnZXREeW5hbWljTG9nZ2VyKGZhbHNlLCBmYWxzZSwgKCkgPT4gUFJFRklYKTtcbiAgICBsb2cubGV2ZWwgPSAnc2lsbHknO1xuICB9KTtcblxuICBhZnRlcihmdW5jdGlvbiAoKSB7XG4gICAgcmVzdG9yZVdyaXRlcnMod3JpdGVycyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IHJld3JpdGUgbG9nIGxldmVscyBvdXRzaWRlIG9mIHRlc3RpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yIChjb25zdCBsZXZlbE5hbWUgb2YgTE9HX0xFVkVMUykge1xuICAgICAgbG9nW2xldmVsTmFtZV0obGV2ZWxOYW1lKTtcbiAgICAgIGFzc2VydE91dHB1dENvbnRhaW5zKHdyaXRlcnMsIGxldmVsTmFtZSk7XG4gICAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCBQUkVGSVgpO1xuICAgIH1cbiAgfSk7XG4gIGl0KCd0aHJvdyBzaG91bGQgbm90IHJld3JpdGUgbG9nIGxldmVscyBvdXRzaWRlIG9mIHRlc3RpbmcgYW5kIHRocm93IGVycm9yJywgZnVuY3Rpb24gKCkge1xuICAgICgoKSA9PiB7IGxvZy5lcnJvckFuZFRocm93KCdtc2cnKTsgfSkuc2hvdWxkLnRocm93KCdtc2cnKTtcbiAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCAnZXJyb3InKTtcbiAgICBhc3NlcnRPdXRwdXRDb250YWlucyh3cml0ZXJzLCBQUkVGSVgpO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L2xvZ2dlci9sb2dnZXItbm9ybWFsLXNwZWNzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
