"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _index = require("../lib/index");

var _os = _interopRequireDefault(require("os"));

var _path = _interopRequireDefault(require("path"));

var _logInternal = require("../lib/log-internal");

const CONFIG_PATH = _path.default.resolve(_os.default.tmpdir(), 'rules.json');

describe('Log Internals', function () {
  let preprocessor;
  beforeEach(function () {
    preprocessor = new _logInternal.SecureValuesPreprocessor();
  });
  it('should preprocess a string and make replacements', async function () {
    const issues = await preprocessor.loadRules(['yolo']);
    issues.length.should.eql(0);
    preprocessor.rules.length.should.eql(1);
    const replacer = preprocessor.rules[0].replacer;
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(`:${replacer}" yo Yolo yyolo`);
  });
  it('should preprocess a string and make replacements with multiple simple rules', async function () {
    const issues = await preprocessor.loadRules(['yolo', 'yo']);
    issues.length.should.eql(0);
    preprocessor.rules.length.should.eql(2);
    const replacer = preprocessor.rules[0].replacer;
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(`:${replacer}" ${replacer} Yolo yyolo`);
  });
  it('should preprocess a string and make replacements with multiple complex rules', async function () {
    const replacer2 = '***';
    const issues = await preprocessor.loadRules([{
      text: 'yolo',
      flags: 'i'
    }, {
      pattern: '^:',
      replacer: replacer2
    }]);
    issues.length.should.eql(0);
    preprocessor.rules.length.should.eql(2);
    const replacer = preprocessor.rules[0].replacer;
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(`${replacer2}${replacer}" yo ${replacer} yyolo`);
  });
  it(`should preprocess a string and apply a rule where 'pattern' has priority over 'text'`, async function () {
    const replacer = '***';
    const issues = await preprocessor.loadRules([{
      pattern: '^:',
      text: 'yo',
      replacer
    }]);
    issues.length.should.eql(0);
    preprocessor.rules.length.should.eql(1);
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(`${replacer}yolo" yo Yolo yyolo`);
  });
  it('should preprocess a string and make replacements with multiple complex rules and issues', async function () {
    const replacer2 = '***';
    const issues = await preprocessor.loadRules([{
      text: 'yolo',
      flags: 'i'
    }, {
      pattern: '^:(',
      replacer: replacer2
    }]);
    issues.length.should.eql(1);
    preprocessor.rules.length.should.eql(1);
    const replacer = preprocessor.rules[0].replacer;
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(`:${replacer}" yo ${replacer} yyolo`);
  });
  it('should leave the string unchanged if all rules have issues', async function () {
    const replacer2 = '***';
    const issues = await preprocessor.loadRules([null, {
      flags: 'i'
    }, {
      pattern: '^:(',
      replacer: replacer2
    }]);
    issues.length.should.eql(3);
    preprocessor.rules.length.should.eql(0);
    preprocessor.preprocess(':yolo" yo Yolo yyolo').should.eql(':yolo" yo Yolo yyolo');
  });
  it('should fail if rules cannot be accessed', async function () {
    await preprocessor.loadRules('bla').should.eventually.be.rejected;
  });
  it('should fail if rules JSON cannot be parsed', async function () {
    await _index.fs.writeFile(CONFIG_PATH, 'blabla', 'utf8');
    await preprocessor.loadRules(CONFIG_PATH).should.eventually.be.rejected;
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvbG9nLWludGVybmFscy1zcGVjcy5qcyJdLCJuYW1lcyI6WyJDT05GSUdfUEFUSCIsInBhdGgiLCJyZXNvbHZlIiwib3MiLCJ0bXBkaXIiLCJkZXNjcmliZSIsInByZXByb2Nlc3NvciIsImJlZm9yZUVhY2giLCJTZWN1cmVWYWx1ZXNQcmVwcm9jZXNzb3IiLCJpdCIsImlzc3VlcyIsImxvYWRSdWxlcyIsImxlbmd0aCIsInNob3VsZCIsImVxbCIsInJ1bGVzIiwicmVwbGFjZXIiLCJwcmVwcm9jZXNzIiwicmVwbGFjZXIyIiwidGV4dCIsImZsYWdzIiwicGF0dGVybiIsImV2ZW50dWFsbHkiLCJiZSIsInJlamVjdGVkIiwiZnMiLCJ3cml0ZUZpbGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLFdBQVcsR0FBR0MsY0FBS0MsT0FBTCxDQUFhQyxZQUFHQyxNQUFILEVBQWIsRUFBMEIsWUFBMUIsQ0FBcEI7O0FBS0FDLFFBQVEsQ0FBQyxlQUFELEVBQWtCLFlBQVk7QUFDcEMsTUFBSUMsWUFBSjtBQUVBQyxFQUFBQSxVQUFVLENBQUMsWUFBWTtBQUNyQkQsSUFBQUEsWUFBWSxHQUFHLElBQUlFLHFDQUFKLEVBQWY7QUFDRCxHQUZTLENBQVY7QUFJQUMsRUFBQUEsRUFBRSxDQUFDLGtEQUFELEVBQXFELGtCQUFrQjtBQUN2RSxVQUFNQyxNQUFNLEdBQUcsTUFBTUosWUFBWSxDQUFDSyxTQUFiLENBQXVCLENBQzFDLE1BRDBDLENBQXZCLENBQXJCO0FBR0FELElBQUFBLE1BQU0sQ0FBQ0UsTUFBUCxDQUFjQyxNQUFkLENBQXFCQyxHQUFyQixDQUF5QixDQUF6QjtBQUNBUixJQUFBQSxZQUFZLENBQUNTLEtBQWIsQ0FBbUJILE1BQW5CLENBQTBCQyxNQUExQixDQUFpQ0MsR0FBakMsQ0FBcUMsQ0FBckM7QUFDQSxVQUFNRSxRQUFRLEdBQUdWLFlBQVksQ0FBQ1MsS0FBYixDQUFtQixDQUFuQixFQUFz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QyxDQUFGO0FBWUFMLEVBQUFBLEVBQUUsQ0FBQyx5Q0FBRCxFQUE0QyxrQkFBa0I7QUFDOUQsVUFBTUgsWUFBWSxDQUFDSyxTQUFiLENBQXVCLEtBQXZCLEVBQThCRSxNQUE5QixDQUFxQ1MsVUFBckMsQ0FBZ0RDLEVBQWhELENBQW1EQyxRQUF6RDtBQUNELEdBRkMsQ0FBRjtBQUlBZixFQUFBQSxFQUFFLENBQUMsNENBQUQsRUFBK0Msa0JBQWtCO0FBQ2pFLFVBQU1nQixVQUFHQyxTQUFILENBQWExQixXQUFiLEVBQTBCLFFBQTFCLEVBQW9DLE1BQXBDLENBQU47QUFDQSxVQUFNTSxZQUFZLENBQUNLLFNBQWIsQ0FBdUJYLFdBQXZCLEVBQW9DYSxNQUFwQyxDQUEyQ1MsVUFBM0MsQ0FBc0RDLEVBQXRELENBQXlEQyxRQUEvRDtBQUNELEdBSEMsQ0FBRjtBQUlELENBbEZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcyB9IGZyb20gJy4uL2xpYi9pbmRleCc7XG5pbXBvcnQgb3MgZnJvbSAnb3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBTZWN1cmVWYWx1ZXNQcmVwcm9jZXNzb3IgfSBmcm9tICcuLi9saWIvbG9nLWludGVybmFsJztcblxuXG5jb25zdCBDT05GSUdfUEFUSCA9IHBhdGgucmVzb2x2ZShvcy50bXBkaXIoKSwgJ3J1bGVzLmpzb24nKTtcblxuXG5cblxuZGVzY3JpYmUoJ0xvZyBJbnRlcm5hbHMnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBwcmVwcm9jZXNzb3I7XG5cbiAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgcHJlcHJvY2Vzc29yID0gbmV3IFNlY3VyZVZhbHVlc1ByZXByb2Nlc3NvcigpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHByZXByb2Nlc3MgYSBzdHJpbmcgYW5kIG1ha2UgcmVwbGFjZW1lbnRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGlzc3VlcyA9IGF3YWl0IHByZXByb2Nlc3Nvci5sb2FkUnVsZXMoW1xuICAgICAgJ3lvbG8nLFxuICAgIF0pO1xuICAgIGlzc3Vlcy5sZW5ndGguc2hvdWxkLmVxbCgwKTtcbiAgICBwcmVwcm9jZXNzb3IucnVsZXMubGVuZ3RoLnNob3VsZC5lcWwoMSk7XG4gICAgY29uc3QgcmVwbGFjZXIgPSBwcmVwcm9jZXNzb3IucnVsZXNbMF0ucmVwbGFjZXI7XG4gICAgcHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoJzp5b2xvXCIgeW8gWW9sbyB5eW9sbycpLnNob3VsZC5lcWwoYDoke3JlcGxhY2VyfVwiIHlvIFlvbG8geXlvbG9gKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBwcmVwcm9jZXNzIGEgc3RyaW5nIGFuZCBtYWtlIHJlcGxhY2VtZW50cyB3aXRoIG11bHRpcGxlIHNpbXBsZSBydWxlcycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBpc3N1ZXMgPSBhd2FpdCBwcmVwcm9jZXNzb3IubG9hZFJ1bGVzKFtcbiAgICAgICd5b2xvJyxcbiAgICAgICd5bycsXG4gICAgXSk7XG4gICAgaXNzdWVzLmxlbmd0aC5zaG91bGQuZXFsKDApO1xuICAgIHByZXByb2Nlc3Nvci5ydWxlcy5sZW5ndGguc2hvdWxkLmVxbCgyKTtcbiAgICBjb25zdCByZXBsYWNlciA9IHByZXByb2Nlc3Nvci5ydWxlc1swXS5yZXBsYWNlcjtcbiAgICBwcmVwcm9jZXNzb3IucHJlcHJvY2VzcygnOnlvbG9cIiB5byBZb2xvIHl5b2xvJykuc2hvdWxkLmVxbChgOiR7cmVwbGFjZXJ9XCIgJHtyZXBsYWNlcn0gWW9sbyB5eW9sb2ApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHByZXByb2Nlc3MgYSBzdHJpbmcgYW5kIG1ha2UgcmVwbGFjZW1lbnRzIHdpdGggbXVsdGlwbGUgY29tcGxleCBydWxlcycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCByZXBsYWNlcjIgPSAnKioqJztcbiAgICBjb25zdCBpc3N1ZXMgPSBhd2FpdCBwcmVwcm9jZXNzb3IubG9hZFJ1bGVzKFtcbiAgICAgIHsgdGV4dDogJ3lvbG8nLCBmbGFnczogJ2knIH0sXG4gICAgICB7IHBhdHRlcm46ICdeOicsIHJlcGxhY2VyOiByZXBsYWNlcjIgfSxcbiAgICBdKTtcbiAgICBpc3N1ZXMubGVuZ3RoLnNob3VsZC5lcWwoMCk7XG4gICAgcHJlcHJvY2Vzc29yLnJ1bGVzLmxlbmd0aC5zaG91bGQuZXFsKDIpO1xuICAgIGNvbnN0IHJlcGxhY2VyID0gcHJlcHJvY2Vzc29yLnJ1bGVzWzBdLnJlcGxhY2VyO1xuICAgIHByZXByb2Nlc3Nvci5wcmVwcm9jZXNzKCc6eW9sb1wiIHlvIFlvbG8geXlvbG8nKS5zaG91bGQuZXFsKGAke3JlcGxhY2VyMn0ke3JlcGxhY2VyfVwiIHlvICR7cmVwbGFjZXJ9IHl5b2xvYCk7XG4gIH0pO1xuXG4gIGl0KGBzaG91bGQgcHJlcHJvY2VzcyBhIHN0cmluZyBhbmQgYXBwbHkgYSBydWxlIHdoZXJlICdwYXR0ZXJuJyBoYXMgcHJpb3JpdHkgb3ZlciAndGV4dCdgLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgcmVwbGFjZXIgPSAnKioqJztcbiAgICBjb25zdCBpc3N1ZXMgPSBhd2FpdCBwcmVwcm9jZXNzb3IubG9hZFJ1bGVzKFtcbiAgICAgIHsgcGF0dGVybjogJ146JywgdGV4dDogJ3lvJywgcmVwbGFjZXIgfSxcbiAgICBdKTtcbiAgICBpc3N1ZXMubGVuZ3RoLnNob3VsZC5lcWwoMCk7XG4gICAgcHJlcHJvY2Vzc29yLnJ1bGVzLmxlbmd0aC5zaG91bGQuZXFsKDEpO1xuICAgIHByZXByb2Nlc3Nvci5wcmVwcm9jZXNzKCc6eW9sb1wiIHlvIFlvbG8geXlvbG8nKS5zaG91bGQuZXFsKGAke3JlcGxhY2VyfXlvbG9cIiB5byBZb2xvIHl5b2xvYCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcHJlcHJvY2VzcyBhIHN0cmluZyBhbmQgbWFrZSByZXBsYWNlbWVudHMgd2l0aCBtdWx0aXBsZSBjb21wbGV4IHJ1bGVzIGFuZCBpc3N1ZXMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgcmVwbGFjZXIyID0gJyoqKic7XG4gICAgY29uc3QgaXNzdWVzID0gYXdhaXQgcHJlcHJvY2Vzc29yLmxvYWRSdWxlcyhbXG4gICAgICB7IHRleHQ6ICd5b2xvJywgZmxhZ3M6ICdpJyB9LFxuICAgICAgeyBwYXR0ZXJuOiAnXjooJywgcmVwbGFjZXI6IHJlcGxhY2VyMiB9LFxuICAgIF0pO1xuICAgIGlzc3Vlcy5sZW5ndGguc2hvdWxkLmVxbCgxKTtcbiAgICBwcmVwcm9jZXNzb3IucnVsZXMubGVuZ3RoLnNob3VsZC5lcWwoMSk7XG4gICAgY29uc3QgcmVwbGFjZXIgPSBwcmVwcm9jZXNzb3IucnVsZXNbMF0ucmVwbGFjZXI7XG4gICAgcHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoJzp5b2xvXCIgeW8gWW9sbyB5eW9sbycpLnNob3VsZC5lcWwoYDoke3JlcGxhY2VyfVwiIHlvICR7cmVwbGFjZXJ9IHl5b2xvYCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbGVhdmUgdGhlIHN0cmluZyB1bmNoYW5nZWQgaWYgYWxsIHJ1bGVzIGhhdmUgaXNzdWVzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlcGxhY2VyMiA9ICcqKionO1xuICAgIGNvbnN0IGlzc3VlcyA9IGF3YWl0IHByZXByb2Nlc3Nvci5sb2FkUnVsZXMoW1xuICAgICAgbnVsbCxcbiAgICAgIHsgZmxhZ3M6ICdpJyB9LFxuICAgICAgeyBwYXR0ZXJuOiAnXjooJywgcmVwbGFjZXI6IHJlcGxhY2VyMiB9LFxuICAgIF0pO1xuICAgIGlzc3Vlcy5sZW5ndGguc2hvdWxkLmVxbCgzKTtcbiAgICBwcmVwcm9jZXNzb3IucnVsZXMubGVuZ3RoLnNob3VsZC5lcWwoMCk7XG4gICAgcHJlcHJvY2Vzc29yLnByZXByb2Nlc3MoJzp5b2xvXCIgeW8gWW9sbyB5eW9sbycpLnNob3VsZC5lcWwoJzp5b2xvXCIgeW8gWW9sbyB5eW9sbycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZhaWwgaWYgcnVsZXMgY2Fubm90IGJlIGFjY2Vzc2VkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGF3YWl0IHByZXByb2Nlc3Nvci5sb2FkUnVsZXMoJ2JsYScpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZhaWwgaWYgcnVsZXMgSlNPTiBjYW5ub3QgYmUgcGFyc2VkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShDT05GSUdfUEFUSCwgJ2JsYWJsYScsICd1dGY4Jyk7XG4gICAgYXdhaXQgcHJlcHJvY2Vzc29yLmxvYWRSdWxlcyhDT05GSUdfUEFUSCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gIH0pO1xufSk7XG4iXSwiZmlsZSI6InRlc3QvbG9nLWludGVybmFscy1zcGVjcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
