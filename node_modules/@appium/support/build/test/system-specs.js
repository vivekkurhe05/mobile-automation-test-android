"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _index = require("../lib/index.js");

var _os = _interopRequireDefault(require("os"));

var _sinon = _interopRequireDefault(require("sinon"));

var teen_process = _interopRequireWildcard(require("teen_process"));

var _lodash = _interopRequireDefault(require("lodash"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

let sandbox,
    tpMock,
    osMock = null;
let SANDBOX = Symbol();
let mocks = {};
let libs = {
  teen_process,
  os: _os.default,
  system: _index.system
};
describe('system', function () {
  describe('isX functions', function () {
    beforeEach(function () {
      osMock = _sinon.default.mock(_os.default);
    });
    afterEach(function () {
      osMock.verify();
    });
    it('should correctly return Windows System if it is a Windows', function () {
      osMock.expects('type').returns('Windows_NT');
      _index.system.isWindows().should.be.true;
    });
    it('should correctly return Mac if it is a Mac', function () {
      osMock.expects('type').returns('Darwin');
      _index.system.isMac().should.be.true;
    });
    it('should correctly return Linux if it is a Linux', function () {
      osMock.expects('type').twice().returns('Linux');
      _index.system.isLinux().should.be.true;
    });
  });
  describe('mac OSX version', function () {
    beforeEach(function () {
      tpMock = _sinon.default.mock(teen_process);
    });
    afterEach(function () {
      tpMock.verify();
    });
    it('should return correct version for 10.10.5', async function () {
      tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({
        stdout: '10.10.5'
      });
      await _index.system.macOsxVersion().should.eventually.equal('10.10');
    });
    it('should return correct version for 10.12', async function () {
      tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({
        stdout: '10.12.0'
      });
      await _index.system.macOsxVersion().should.eventually.equal('10.12');
    });
    it('should return correct version for 10.12 with newline', async function () {
      tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({
        stdout: '10.12   \n'
      });
      await _index.system.macOsxVersion().should.eventually.equal('10.12');
    });
    it("should throw an error if OSX version can't be determined", async function () {
      let invalidOsx = 'error getting operation system version blabla';
      tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({
        stdout: invalidOsx
      });
      await _index.system.macOsxVersion().should.eventually.be.rejectedWith(new RegExp(_lodash.default.escapeRegExp(invalidOsx)));
    });
  });
  describe('architecture', function () {
    beforeEach(function () {
      sandbox = _sinon.default.createSandbox();
      mocks[SANDBOX] = sandbox;

      for (let [key, value] of _lodash.default.toPairs(libs)) {
        mocks[key] = sandbox.mock(value);
      }
    });
    afterEach(function () {
      sandbox.restore();
    });
    it('should return correct architecture if it is a 64 bit Mac/Linux', async function () {
      mocks.os.expects('type').thrice().returns('Darwin');
      mocks.teen_process.expects('exec').once().withExactArgs('uname', ['-m']).returns({
        stdout: 'x86_64'
      });
      let arch = await _index.system.arch();
      arch.should.equal('64');
      mocks[SANDBOX].verify();
    });
    it('should return correct architecture if it is a 32 bit Mac/Linux', async function () {
      mocks.os.expects('type').twice().returns('Linux');
      mocks.teen_process.expects('exec').once().withExactArgs('uname', ['-m']).returns({
        stdout: 'i686'
      });
      let arch = await _index.system.arch();
      arch.should.equal('32');
      mocks[SANDBOX].verify();
    });
    it('should return correct architecture if it is a 64 bit Windows', async function () {
      mocks.os.expects('type').thrice().returns('Windows_NT');
      mocks.system.expects('isOSWin64').once().returns(true);
      let arch = await _index.system.arch();
      arch.should.equal('64');
      mocks[SANDBOX].verify();
    });
    it('should return correct architecture if it is a 32 bit Windows', async function () {
      mocks.os.expects('type').thrice().returns('Windows_NT');
      mocks.system.expects('isOSWin64').once().returns(false);
      let arch = await _index.system.arch();
      arch.should.equal('32');
      mocks[SANDBOX].verify();
    });
  });
  it('should know architecture', function () {
    return _index.system.arch();
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3Qvc3lzdGVtLXNwZWNzLmpzIl0sIm5hbWVzIjpbInNhbmRib3giLCJ0cE1vY2siLCJvc01vY2siLCJTQU5EQk9YIiwiU3ltYm9sIiwibW9ja3MiLCJsaWJzIiwidGVlbl9wcm9jZXNzIiwib3MiLCJzeXN0ZW0iLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJzaW5vbiIsIm1vY2siLCJhZnRlckVhY2giLCJ2ZXJpZnkiLCJpdCIsImV4cGVjdHMiLCJyZXR1cm5zIiwiaXNXaW5kb3dzIiwic2hvdWxkIiwiYmUiLCJ0cnVlIiwiaXNNYWMiLCJ0d2ljZSIsImlzTGludXgiLCJvbmNlIiwid2l0aEV4YWN0QXJncyIsInN0ZG91dCIsIm1hY09zeFZlcnNpb24iLCJldmVudHVhbGx5IiwiZXF1YWwiLCJpbnZhbGlkT3N4IiwicmVqZWN0ZWRXaXRoIiwiUmVnRXhwIiwiXyIsImVzY2FwZVJlZ0V4cCIsImNyZWF0ZVNhbmRib3giLCJrZXkiLCJ2YWx1ZSIsInRvUGFpcnMiLCJyZXN0b3JlIiwidGhyaWNlIiwiYXJjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUdBLElBQUlBLE9BQUo7QUFBQSxJQUFhQyxNQUFiO0FBQUEsSUFBcUJDLE1BQU0sR0FBRyxJQUE5QjtBQUNBLElBQUlDLE9BQU8sR0FBR0MsTUFBTSxFQUFwQjtBQUNBLElBQUlDLEtBQUssR0FBRyxFQUFaO0FBQ0EsSUFBSUMsSUFBSSxHQUFHO0FBQUNDLEVBQUFBLFlBQUQ7QUFBZUMsRUFBQUEsRUFBRSxFQUFGQSxXQUFmO0FBQW1CQyxFQUFBQSxNQUFNLEVBQU5BO0FBQW5CLENBQVg7QUFFQUMsUUFBUSxDQUFDLFFBQUQsRUFBVyxZQUFZO0FBQzdCQSxFQUFBQSxRQUFRLENBQUMsZUFBRCxFQUFrQixZQUFZO0FBQ3BDQyxJQUFBQSxVQUFVLENBQUMsWUFBWTtBQUNyQlQsTUFBQUEsTUFBTSxHQUFHVSxlQUFNQyxJQUFOLENBQVdMLFdBQVgs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QUFiLENBQXFCLFdBQXJCLEVBQWtDUyxJQUFsQyxHQUF5Q1IsT0FBekMsQ0FBaUQsSUFBakQ7QUFDQSxVQUFJeUIsSUFBSSxHQUFHLE1BQU1sQyxjQUFPa0MsSUFBUCxFQUFqQjtBQUNBQSxNQUFBQSxJQUFJLENBQUN2QixNQUFMLENBQVlXLEtBQVosQ0FBa0IsSUFBbEI7QUFDQTFCLE1BQUFBLEtBQUssQ0FBQ0YsT0FBRCxDQUFMLENBQWVZLE1BQWY7QUFDRCxLQU5DLENBQUY7QUFRQUMsSUFBQUEsRUFBRSxDQUFDLDhEQUFELEVBQWlFLGtCQUFrQjtBQUNuRlgsTUFBQUEsS0FBSyxDQUFDRyxFQUFOLENBQVNTLE9BQVQsQ0FBaUIsTUFBakIsRUFBeUJ5QixNQUF6QixHQUFrQ3hCLE9BQWxDLENBQTBDLFlBQTFDO0FBQ0FiLE1BQUFBLEtBQUssQ0FBQ0ksTUFBTixDQUFhUSxPQUFiLENBQXFCLFdBQXJCLEVBQWtDUyxJQUFsQyxHQUF5Q1IsT0FBekMsQ0FBaUQsS0FBakQ7QUFDQSxVQUFJeUIsSUFBSSxHQUFHLE1BQU1sQyxjQUFPa0MsSUFBUCxFQUFqQjtBQUNBQSxNQUFBQSxJQUFJLENBQUN2QixNQUFMLENBQVlXLEtBQVosQ0FBa0IsSUFBbEI7QUFDQTFCLE1BQUFBLEtBQUssQ0FBQ0YsT0FBRCxDQUFMLENBQWVZLE1BQWY7QUFDRCxLQU5DLENBQUY7QUFPRCxHQTVDTyxDQUFSO0FBOENBQyxFQUFBQSxFQUFFLENBQUMsMEJBQUQsRUFBNkIsWUFBWTtBQUN6QyxXQUFPUCxjQUFPa0MsSUFBUCxFQUFQO0FBQ0QsR0FGQyxDQUFGO0FBR0QsQ0F4R08sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgc3lzdGVtIH0gZnJvbSAnLi4vbGliL2luZGV4LmpzJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0ICogYXMgdGVlbl9wcm9jZXNzIGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5cbmxldCBzYW5kYm94LCB0cE1vY2ssIG9zTW9jayA9IG51bGw7XG5sZXQgU0FOREJPWCA9IFN5bWJvbCgpO1xubGV0IG1vY2tzID0ge307XG5sZXQgbGlicyA9IHt0ZWVuX3Byb2Nlc3MsIG9zLCBzeXN0ZW19O1xuXG5kZXNjcmliZSgnc3lzdGVtJywgZnVuY3Rpb24gKCkge1xuICBkZXNjcmliZSgnaXNYIGZ1bmN0aW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIG9zTW9jayA9IHNpbm9uLm1vY2sob3MpO1xuICAgIH0pO1xuICAgIGFmdGVyRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBvc01vY2sudmVyaWZ5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSByZXR1cm4gV2luZG93cyBTeXN0ZW0gaWYgaXQgaXMgYSBXaW5kb3dzJywgZnVuY3Rpb24gKCkge1xuICAgICAgb3NNb2NrLmV4cGVjdHMoJ3R5cGUnKS5yZXR1cm5zKCdXaW5kb3dzX05UJyk7XG4gICAgICBzeXN0ZW0uaXNXaW5kb3dzKCkuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSByZXR1cm4gTWFjIGlmIGl0IGlzIGEgTWFjJywgZnVuY3Rpb24gKCkge1xuICAgICAgb3NNb2NrLmV4cGVjdHMoJ3R5cGUnKS5yZXR1cm5zKCdEYXJ3aW4nKTtcbiAgICAgIHN5c3RlbS5pc01hYygpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgcmV0dXJuIExpbnV4IGlmIGl0IGlzIGEgTGludXgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBvc01vY2suZXhwZWN0cygndHlwZScpLnR3aWNlKCkucmV0dXJucygnTGludXgnKTtcbiAgICAgIHN5c3RlbS5pc0xpbnV4KCkuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYWMgT1NYIHZlcnNpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB0cE1vY2sgPSBzaW5vbi5tb2NrKHRlZW5fcHJvY2Vzcyk7XG4gICAgfSk7XG4gICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHRwTW9jay52ZXJpZnkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgdmVyc2lvbiBmb3IgMTAuMTAuNScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRwTW9jay5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3N3X3ZlcnMnLCBbJy1wcm9kdWN0VmVyc2lvbiddKS5yZXR1cm5zKHtzdGRvdXQ6ICcxMC4xMC41J30pO1xuICAgICAgYXdhaXQgc3lzdGVtLm1hY09zeFZlcnNpb24oKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnMTAuMTAnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgdmVyc2lvbiBmb3IgMTAuMTInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICB0cE1vY2suZXhwZWN0cygnZXhlYycpLm9uY2UoKS53aXRoRXhhY3RBcmdzKCdzd192ZXJzJywgWyctcHJvZHVjdFZlcnNpb24nXSkucmV0dXJucyh7c3Rkb3V0OiAnMTAuMTIuMCd9KTtcbiAgICAgIGF3YWl0IHN5c3RlbS5tYWNPc3hWZXJzaW9uKCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJzEwLjEyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IHZlcnNpb24gZm9yIDEwLjEyIHdpdGggbmV3bGluZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRwTW9jay5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3N3X3ZlcnMnLCBbJy1wcm9kdWN0VmVyc2lvbiddKS5yZXR1cm5zKHtzdGRvdXQ6ICcxMC4xMiAgIFxcbid9KTtcbiAgICAgIGF3YWl0IHN5c3RlbS5tYWNPc3hWZXJzaW9uKCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJzEwLjEyJyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBhbiBlcnJvciBpZiBPU1ggdmVyc2lvbiBjYW4ndCBiZSBkZXRlcm1pbmVkXCIsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBpbnZhbGlkT3N4ID0gJ2Vycm9yIGdldHRpbmcgb3BlcmF0aW9uIHN5c3RlbSB2ZXJzaW9uIGJsYWJsYSc7XG4gICAgICB0cE1vY2suZXhwZWN0cygnZXhlYycpLm9uY2UoKS53aXRoRXhhY3RBcmdzKCdzd192ZXJzJywgWyctcHJvZHVjdFZlcnNpb24nXSkucmV0dXJucyh7c3Rkb3V0OiBpbnZhbGlkT3N4fSk7XG4gICAgICBhd2FpdCBzeXN0ZW0ubWFjT3N4VmVyc2lvbigpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aChuZXcgUmVnRXhwKF8uZXNjYXBlUmVnRXhwKGludmFsaWRPc3gpKSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhcmNoaXRlY3R1cmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICAgICAgbW9ja3NbU0FOREJPWF0gPSBzYW5kYm94O1xuICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhsaWJzKSkge1xuICAgICAgICBtb2Nrc1trZXldID0gc2FuZGJveC5tb2NrKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgNjQgYml0IE1hYy9MaW51eCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIG1vY2tzLm9zLmV4cGVjdHMoJ3R5cGUnKS50aHJpY2UoKS5yZXR1cm5zKCdEYXJ3aW4nKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3VuYW1lJywgWyctbSddKS5yZXR1cm5zKHtzdGRvdXQ6ICd4ODZfNjQnfSk7XG4gICAgICBsZXQgYXJjaCA9IGF3YWl0IHN5c3RlbS5hcmNoKCk7XG4gICAgICBhcmNoLnNob3VsZC5lcXVhbCgnNjQnKTtcbiAgICAgIG1vY2tzW1NBTkRCT1hdLnZlcmlmeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBhcmNoaXRlY3R1cmUgaWYgaXQgaXMgYSAzMiBiaXQgTWFjL0xpbnV4JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbW9ja3Mub3MuZXhwZWN0cygndHlwZScpLnR3aWNlKCkucmV0dXJucygnTGludXgnKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3VuYW1lJywgWyctbSddKS5yZXR1cm5zKHtzdGRvdXQ6ICdpNjg2J30pO1xuICAgICAgbGV0IGFyY2ggPSBhd2FpdCBzeXN0ZW0uYXJjaCgpO1xuICAgICAgYXJjaC5zaG91bGQuZXF1YWwoJzMyJyk7XG4gICAgICBtb2Nrc1tTQU5EQk9YXS52ZXJpZnkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgNjQgYml0IFdpbmRvd3MnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBtb2Nrcy5vcy5leHBlY3RzKCd0eXBlJykudGhyaWNlKCkucmV0dXJucygnV2luZG93c19OVCcpO1xuICAgICAgbW9ja3Muc3lzdGVtLmV4cGVjdHMoJ2lzT1NXaW42NCcpLm9uY2UoKS5yZXR1cm5zKHRydWUpO1xuICAgICAgbGV0IGFyY2ggPSBhd2FpdCBzeXN0ZW0uYXJjaCgpO1xuICAgICAgYXJjaC5zaG91bGQuZXF1YWwoJzY0Jyk7XG4gICAgICBtb2Nrc1tTQU5EQk9YXS52ZXJpZnkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgMzIgYml0IFdpbmRvd3MnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBtb2Nrcy5vcy5leHBlY3RzKCd0eXBlJykudGhyaWNlKCkucmV0dXJucygnV2luZG93c19OVCcpO1xuICAgICAgbW9ja3Muc3lzdGVtLmV4cGVjdHMoJ2lzT1NXaW42NCcpLm9uY2UoKS5yZXR1cm5zKGZhbHNlKTtcbiAgICAgIGxldCBhcmNoID0gYXdhaXQgc3lzdGVtLmFyY2goKTtcbiAgICAgIGFyY2guc2hvdWxkLmVxdWFsKCczMicpO1xuICAgICAgbW9ja3NbU0FOREJPWF0udmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQga25vdyBhcmNoaXRlY3R1cmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHN5c3RlbS5hcmNoKCk7XG4gIH0pO1xufSk7XG4iXSwiZmlsZSI6InRlc3Qvc3lzdGVtLXNwZWNzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
