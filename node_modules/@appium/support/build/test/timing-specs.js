"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _sinon = _interopRequireDefault(require("sinon"));

var _lib = require("../lib");

const expect = chai.expect;
describe('timing', function () {
  let processMock;
  afterEach(function () {
    processMock.verify();
  });
  describe('no bigint', function () {
    const bigintFn = process.hrtime.bigint;
    before(function () {
      if (_lodash.default.isFunction(bigintFn)) {
        delete process.hrtime.bigint;
      }
    });
    beforeEach(function () {
      processMock = _sinon.default.mock(process);
    });
    after(function () {
      if (_lodash.default.isFunction(bigintFn)) {
        process.hrtime.bigint = bigintFn;
      }
    });
    it('should get a start time as array', function () {
      const timer = new _lib.timing.Timer().start();
      _lodash.default.isArray(timer.startTime).should.be.true;
    });
    it('should get a duration', function () {
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      _lodash.default.isNumber(duration.nanos).should.be.true;
    });
    it('should get correct seconds', function () {
      processMock.expects('hrtime').twice().onFirstCall().returns([12, 12345]).onSecondCall().returns([13, 54321]);
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asSeconds.should.eql(13.000054321);
    });
    it('should get correct milliseconds', function () {
      processMock.expects('hrtime').twice().onFirstCall().returns([12, 12345]).onSecondCall().returns([13, 54321]);
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asMilliSeconds.should.eql(13000.054321);
    });
    it('should get correct nanoseconds', function () {
      processMock.expects('hrtime').twice().onFirstCall().returns([12, 12345]).onSecondCall().returns([13, 54321]);
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asNanoSeconds.should.eql(13000054321);
    });
    it('should error if the timer was not started', function () {
      const timer = new _lib.timing.Timer();
      expect(() => timer.getDuration()).to.throw('Unable to get duration');
    });
    it('should error if start time is a number', function () {
      const timer = new _lib.timing.Timer();
      timer._startTime = 12345;
      expect(() => timer.getDuration()).to.throw('Unable to get duration');
    });
  });
  describe('bigint', function () {
    beforeEach(function () {
      if (!_lodash.default.isFunction(process.hrtime.bigint)) {
        return this.skip();
      }

      processMock = _sinon.default.mock(process.hrtime);
    });

    function setupMocks(once = false) {
      if (once) {
        processMock.expects('bigint').once().onFirstCall().returns(BigInt(1172941153404030));
      } else {
        processMock.expects('bigint').twice().onFirstCall().returns(BigInt(1172941153404030)).onSecondCall().returns(BigInt(1172951164887132));
      }
    }

    it('should get a duration', function () {
      setupMocks();
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      _lodash.default.isNumber(duration.nanos).should.be.true;
    });
    it('should get correct seconds', function () {
      setupMocks();
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asSeconds.should.be.eql(10.011483102);
    });
    it('should get correct milliseconds', function () {
      setupMocks();
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asMilliSeconds.should.be.eql(10011.483102);
    });
    it('should get correct nanoseconds', function () {
      setupMocks();
      const timer = new _lib.timing.Timer().start();
      const duration = timer.getDuration();
      duration.asNanoSeconds.should.be.eql(10011483102);
    });
    it('should error if the timer was not started', function () {
      const timer = new _lib.timing.Timer();
      expect(() => timer.getDuration()).to.throw('Unable to get duration');
    });
    it('should error if passing in a non-bigint', function () {
      const timer = new _lib.timing.Timer();
      timer._startTime = 12345;
      expect(() => timer.getDuration()).to.throw('Unable to get duration');
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdGltaW5nLXNwZWNzLmpzIl0sIm5hbWVzIjpbImV4cGVjdCIsImNoYWkiLCJkZXNjcmliZSIsInByb2Nlc3NNb2NrIiwiYWZ0ZXJFYWNoIiwidmVyaWZ5IiwiYmlnaW50Rm4iLCJwcm9jZXNzIiwiaHJ0aW1lIiwiYmlnaW50IiwiYmVmb3JlIiwiXyIsImlzRnVuY3Rpb24iLCJiZWZvcmVFYWNoIiwic2lub24iLCJtb2NrIiwiYWZ0ZXIiLCJpdCIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsImlzQXJyYXkiLCJzdGFydFRpbWUiLCJzaG91bGQiLCJiZSIsInRydWUiLCJkdXJhdGlvbiIsImdldER1cmF0aW9uIiwiaXNOdW1iZXIiLCJuYW5vcyIsImV4cGVjdHMiLCJ0d2ljZSIsIm9uRmlyc3RDYWxsIiwicmV0dXJucyIsIm9uU2Vjb25kQ2FsbCIsImFzU2Vjb25kcyIsImVxbCIsImFzTWlsbGlTZWNvbmRzIiwiYXNOYW5vU2Vjb25kcyIsInRvIiwidGhyb3ciLCJfc3RhcnRUaW1lIiwic2tpcCIsInNldHVwTW9ja3MiLCJvbmNlIiwiQmlnSW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxNQUFNLEdBQUdDLElBQUksQ0FBQ0QsTUFBcEI7QUFFQUUsUUFBUSxDQUFDLFFBQUQsRUFBVyxZQUFZO0FBQzdCLE1BQUlDLFdBQUo7QUFDQUMsRUFBQUEsU0FBUyxDQUFDLFlBQVk7QUFDcEJELElBQUFBLFdBQVcsQ0FBQ0UsTUFBWjtBQUNELEdBRlEsQ0FBVDtBQUlBSCxFQUFBQSxRQUFRLENBQUMsV0FBRCxFQUFjLFlBQVk7QUFDaEMsVUFBTUksUUFBUSxHQUFHQyxPQUFPLENBQUNDLE1BQVIsQ0FBZUMsTUFBaEM7QUFDQUMsSUFBQUEsTUFBTSxDQUFDLFlBQVk7QUFFakIsVUFBSUMsZ0JBQUVDLFVBQUYsQ0FBYU4sUUFBYixDQUFKLEVBQTRCO0FBQzFCLGVBQU9DLE9BQU8sQ0FBQ0MsTUFBUixD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LENBQUNXLGNBQVQsQ0FBd0JkLE1BQXhCLENBQStCQyxFQUEvQixDQUFrQ1ksR0FBbEMsQ0FBc0MsWUFBdEM7QUFDRCxLQU5DLENBQUY7QUFPQXBCLElBQUFBLEVBQUUsQ0FBQyxnQ0FBRCxFQUFtQyxZQUFZO0FBQy9DMkIsTUFBQUEsVUFBVTtBQUVWLFlBQU0xQixLQUFLLEdBQUcsSUFBSUMsWUFBT0MsS0FBWCxHQUFtQkMsS0FBbkIsRUFBZDtBQUNBLFlBQU1NLFFBQVEsR0FBR1QsS0FBSyxDQUFDVSxXQUFOLEVBQWpCO0FBQ0FELE1BQUFBLFFBQVEsQ0FBQ1ksYUFBVCxDQUF1QmYsTUFBdkIsQ0FBOEJDLEVBQTlCLENBQWlDWSxHQUFqQyxDQUFxQyxXQUFyQztBQUNELEtBTkMsQ0FBRjtBQU9BcEIsSUFBQUEsRUFBRSxDQUFDLDJDQUFELEVBQThDLFlBQVk7QUFDMUQsWUFBTUMsS0FBSyxHQUFHLElBQUlDLFlBQU9DLEtBQVgsRUFBZDtBQUNBcEIsTUFBQUEsTUFBTSxDQUFDLE1BQU1rQixLQUFLLENBQUNVLFdBQU4sRUFBUCxDQUFOLENBQ0dZLEVBREgsQ0FDTUMsS0FETixDQUNZLHdCQURaO0FBRUQsS0FKQyxDQUFGO0FBS0F4QixJQUFBQSxFQUFFLENBQUMseUNBQUQsRUFBNEMsWUFBWTtBQUN4RCxZQUFNQyxLQUFLLEdBQUcsSUFBSUMsWUFBT0MsS0FBWCxFQUFkO0FBQ0FGLE1BQUFBLEtBQUssQ0FBQ3dCLFVBQU4sR0FBbUIsS0FBbkI7QUFDQTFDLE1BQUFBLE1BQU0sQ0FBQyxNQUFNa0IsS0FBSyxDQUFDVSxXQUFOLEVBQVAsQ0FBTixDQUNHWSxFQURILENBQ01DLEtBRE4sQ0FDWSx3QkFEWjtBQUVELEtBTEMsQ0FBRjtBQU1ELEdBOURPLENBQVI7QUErREQsQ0FySU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgdGltaW5nIH0gZnJvbSAnLi4vbGliJztcblxuXG5jb25zdCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxuZGVzY3JpYmUoJ3RpbWluZycsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHByb2Nlc3NNb2NrO1xuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIHByb2Nlc3NNb2NrLnZlcmlmeSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnbm8gYmlnaW50JywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGJpZ2ludEZuID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50O1xuICAgIGJlZm9yZShmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBpZiB0aGUgc3lzdGVtIGhhcyBCaWdJbnQgc3VwcG9ydCwgcmVtb3ZlIGl0XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGJpZ2ludEZuKSkge1xuICAgICAgICBkZWxldGUgcHJvY2Vzcy5ocnRpbWUuYmlnaW50O1xuICAgICAgfVxuICAgIH0pO1xuICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgcHJvY2Vzc01vY2sgPSBzaW5vbi5tb2NrKHByb2Nlc3MpO1xuICAgIH0pO1xuICAgIGFmdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oYmlnaW50Rm4pKSB7XG4gICAgICAgIHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCA9IGJpZ2ludEZuO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGEgc3RhcnQgdGltZSBhcyBhcnJheScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgICBfLmlzQXJyYXkodGltZXIuc3RhcnRUaW1lKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBhIGR1cmF0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIuZ2V0RHVyYXRpb24oKTtcbiAgICAgIF8uaXNOdW1iZXIoZHVyYXRpb24ubmFub3MpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGNvcnJlY3Qgc2Vjb25kcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHByb2Nlc3NNb2NrLmV4cGVjdHMoJ2hydGltZScpLnR3aWNlKClcbiAgICAgICAgLm9uRmlyc3RDYWxsKCkucmV0dXJucyhbMTIsIDEyMzQ1XSlcbiAgICAgICAgLm9uU2Vjb25kQ2FsbCgpLnJldHVybnMoWzEzLCA1NDMyMV0pO1xuXG4gICAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSB0aW1lci5nZXREdXJhdGlvbigpO1xuICAgICAgZHVyYXRpb24uYXNTZWNvbmRzLnNob3VsZC5lcWwoMTMuMDAwMDU0MzIxKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBjb3JyZWN0IG1pbGxpc2Vjb25kcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHByb2Nlc3NNb2NrLmV4cGVjdHMoJ2hydGltZScpLnR3aWNlKClcbiAgICAgICAgLm9uRmlyc3RDYWxsKCkucmV0dXJucyhbMTIsIDEyMzQ1XSlcbiAgICAgICAgLm9uU2Vjb25kQ2FsbCgpLnJldHVybnMoWzEzLCA1NDMyMV0pO1xuXG4gICAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSB0aW1lci5nZXREdXJhdGlvbigpO1xuICAgICAgZHVyYXRpb24uYXNNaWxsaVNlY29uZHMuc2hvdWxkLmVxbCgxMzAwMC4wNTQzMjEpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGNvcnJlY3QgbmFub3NlY29uZHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBwcm9jZXNzTW9jay5leHBlY3RzKCdocnRpbWUnKS50d2ljZSgpXG4gICAgICAgIC5vbkZpcnN0Q2FsbCgpLnJldHVybnMoWzEyLCAxMjM0NV0pXG4gICAgICAgIC5vblNlY29uZENhbGwoKS5yZXR1cm5zKFsxMywgNTQzMjFdKTtcblxuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIuZ2V0RHVyYXRpb24oKTtcbiAgICAgIGR1cmF0aW9uLmFzTmFub1NlY29uZHMuc2hvdWxkLmVxbCgxMzAwMDA1NDMyMSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlcnJvciBpZiB0aGUgdGltZXIgd2FzIG5vdCBzdGFydGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCk7XG4gICAgICBleHBlY3QoKCkgPT4gdGltZXIuZ2V0RHVyYXRpb24oKSlcbiAgICAgICAgLnRvLnRocm93KCdVbmFibGUgdG8gZ2V0IGR1cmF0aW9uJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlcnJvciBpZiBzdGFydCB0aW1lIGlzIGEgbnVtYmVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCk7XG4gICAgICB0aW1lci5fc3RhcnRUaW1lID0gMTIzNDU7XG4gICAgICBleHBlY3QoKCkgPT4gdGltZXIuZ2V0RHVyYXRpb24oKSlcbiAgICAgICAgLnRvLnRocm93KCdVbmFibGUgdG8gZ2V0IGR1cmF0aW9uJyk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnYmlnaW50JywgZnVuY3Rpb24gKCkge1xuICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgLy8gdGhlIG5vbi1tb2NrZWQgdGVzdCBjYW5ub3QgcnVuIGlmIEJpZ0ludCBkb2VzIG5vdCBleGlzdCxcbiAgICAgIC8vIGFuZCBpdCBjYW5ub3QgYmUgbW9ja2VkLiBMdWNraWx5IHN1cHBvcnQgd2FzIGFkZGVkIGluIE5vZGUgMTAuNC4wLFxuICAgICAgLy8gc28gaXQgc2hvdWxkIG5vdCBiZSBhIGNhc2Ugd2hlcmUgd2UgYXJlIHRlc3Rpbmcgd2l0aG91dCB0aGlzLFxuICAgICAgLy8gdGhvdWdoIGl0IHN0aWxsIGNhbiBiZSBhIHRlc3QgdGhhdCBBcHBpdW0gaXMgX3VzZWRfIHdpdGhvdXQgaXQuXG4gICAgICBpZiAoIV8uaXNGdW5jdGlvbihwcm9jZXNzLmhydGltZS5iaWdpbnQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNraXAoKTtcbiAgICAgIH1cbiAgICAgIHByb2Nlc3NNb2NrID0gc2lub24ubW9jayhwcm9jZXNzLmhydGltZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBzZXR1cE1vY2tzIChvbmNlID0gZmFsc2UpIHtcbiAgICAgIGlmIChvbmNlKSB7XG4gICAgICAgIHByb2Nlc3NNb2NrLmV4cGVjdHMoJ2JpZ2ludCcpLm9uY2UoKVxuICAgICAgICAgIC5vbkZpcnN0Q2FsbCgpLnJldHVybnMoQmlnSW50KDExNzI5NDExNTM0MDQwMzApKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByb2Nlc3NNb2NrLmV4cGVjdHMoJ2JpZ2ludCcpLnR3aWNlKClcbiAgICAgICAgICAub25GaXJzdENhbGwoKS5yZXR1cm5zKEJpZ0ludCgxMTcyOTQxMTUzNDA0MDMwKSlcbiAgICAgICAgICAub25TZWNvbmRDYWxsKCkucmV0dXJucyhCaWdJbnQoMTE3Mjk1MTE2NDg4NzEzMikpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGl0KCdzaG91bGQgZ2V0IGEgZHVyYXRpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZXR1cE1vY2tzKCk7XG5cbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHRpbWVyLmdldER1cmF0aW9uKCk7XG4gICAgICBfLmlzTnVtYmVyKGR1cmF0aW9uLm5hbm9zKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBjb3JyZWN0IHNlY29uZHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZXR1cE1vY2tzKCk7XG5cbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHRpbWVyLmdldER1cmF0aW9uKCk7XG4gICAgICBkdXJhdGlvbi5hc1NlY29uZHMuc2hvdWxkLmJlLmVxbCgxMC4wMTE0ODMxMDIpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGNvcnJlY3QgbWlsbGlzZWNvbmRzJywgZnVuY3Rpb24gKCkge1xuICAgICAgc2V0dXBNb2NrcygpO1xuXG4gICAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSB0aW1lci5nZXREdXJhdGlvbigpO1xuICAgICAgZHVyYXRpb24uYXNNaWxsaVNlY29uZHMuc2hvdWxkLmJlLmVxbCgxMDAxMS40ODMxMDIpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IGNvcnJlY3QgbmFub3NlY29uZHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBzZXR1cE1vY2tzKCk7XG5cbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHRpbWVyLmdldER1cmF0aW9uKCk7XG4gICAgICBkdXJhdGlvbi5hc05hbm9TZWNvbmRzLnNob3VsZC5iZS5lcWwoMTAwMTE0ODMxMDIpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZXJyb3IgaWYgdGhlIHRpbWVyIHdhcyBub3Qgc3RhcnRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpO1xuICAgICAgZXhwZWN0KCgpID0+IHRpbWVyLmdldER1cmF0aW9uKCkpXG4gICAgICAgIC50by50aHJvdygnVW5hYmxlIHRvIGdldCBkdXJhdGlvbicpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZXJyb3IgaWYgcGFzc2luZyBpbiBhIG5vbi1iaWdpbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKTtcbiAgICAgIHRpbWVyLl9zdGFydFRpbWUgPSAxMjM0NTtcbiAgICAgIGV4cGVjdCgoKSA9PiB0aW1lci5nZXREdXJhdGlvbigpKVxuICAgICAgICAudG8udGhyb3coJ1VuYWJsZSB0byBnZXQgZHVyYXRpb24nKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJmaWxlIjoidGVzdC90aW1pbmctc3BlY3MuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
