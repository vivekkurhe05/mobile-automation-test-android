"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lib = require("../../lib");

var _server2 = require("../../lib/express/server");

var _sinon = _interopRequireDefault(require("sinon"));

var _helpers = require("../helpers");

function fakeApp() {
  const app = {
    use: _sinon.default.spy(),
    all: _sinon.default.spy(),
    get: _sinon.default.spy(),
    post: _sinon.default.spy(),
    delete: _sinon.default.spy(),
    totalCount: () => app.use.callCount + app.all.callCount + app.get.callCount + app.post.callCount + app.delete.callCount
  };
  return app;
}

const newMethodMap = {
  '/session/:sessionId/fake': {
    GET: {
      command: 'fakeGet'
    },
    POST: {
      command: 'fakePost',
      payloadParams: {
        required: ['fakeParam']
      }
    }
  }
};

const updateServer = (app, httpServer) => {
  app.updated = true;
  httpServer.updated = true;
};

function fakeDriver() {
  return {
    sessionExists: () => {},
    executeCommand: () => {}
  };
}

describe('server configuration', function () {
  let port;
  before(async function () {
    port = await (0, _helpers.getTestPort)(true);
  });
  it('should actually use the middleware', function () {
    const app = fakeApp();

    const configureRoutes = () => {};

    (0, _server2.configureServer)({
      app,
      addRoutes: configureRoutes
    });
    app.use.callCount.should.equal(14);
    app.all.callCount.should.equal(4);
  });
  it('should apply new methods in plugins to the standard method map', function () {
    const app1 = fakeApp();
    const app2 = fakeApp();
    const driver = fakeDriver();
    const addRoutes = (0, _lib.routeConfiguringFunction)(driver);
    (0, _server2.configureServer)({
      app: app1,
      addRoutes
    });
    (0, _server2.configureServer)({
      app: app2,
      addRoutes,
      extraMethodMap: newMethodMap
    });
    app2.totalCount().should.eql(app1.totalCount() + 2);
  });
  it('should silently reject new methods in plugins if not plain objects', function () {
    const app1 = fakeApp();
    const app2 = fakeApp();
    const driver = fakeDriver();
    const addRoutes = (0, _lib.routeConfiguringFunction)(driver);
    (0, _server2.configureServer)({
      app: app1,
      addRoutes
    });
    (0, _server2.configureServer)({
      app: app2,
      addRoutes,
      extraMethodMap: []
    });
    app2.totalCount().should.eql(app1.totalCount());
  });
  it('should allow plugins to update the server', async function () {
    const driver = fakeDriver();

    const _server = await (0, _lib.server)({
      routeConfiguringFunction: (0, _lib.routeConfiguringFunction)(driver),
      port,
      extraMethodMap: newMethodMap,
      serverUpdaters: [updateServer]
    });

    try {
      _server.updated.should.be.true;
    } finally {
      await _server.close();
    }
  });
  it('should reject if error thrown in configureRoutes parameter', async function () {
    const configureRoutes = () => {
      throw new Error('I am Mr. MeeSeeks look at me!');
    };

    await (0, _lib.server)({
      routeConfiguringFunction: configureRoutes,
      port
    }).should.be.rejectedWith('MeeSeeks');
  });
  describe('#normalizeBasePath', function () {
    it('should throw an error for paths of the wrong type', function () {
      should.throw(() => {
        (0, _server2.normalizeBasePath)(null);
      });
      should.throw(() => {
        (0, _server2.normalizeBasePath)(1);
      });
    });
    it('should remove trailing slashes', function () {
      (0, _server2.normalizeBasePath)('/wd/hub/').should.eql('/wd/hub');
      (0, _server2.normalizeBasePath)('/foo/').should.eql('/foo');
      (0, _server2.normalizeBasePath)('/').should.eql('');
    });
    it('should ensure a leading slash is present', function () {
      (0, _server2.normalizeBasePath)('foo').should.eql('/foo');
      (0, _server2.normalizeBasePath)('wd/hub').should.eql('/wd/hub');
      (0, _server2.normalizeBasePath)('wd/hub/').should.eql('/wd/hub');
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZXhwcmVzcy9zZXJ2ZXItc3BlY3MuanMiXSwibmFtZXMiOlsiZmFrZUFwcCIsImFwcCIsInVzZSIsInNpbm9uIiwic3B5IiwiYWxsIiwiZ2V0IiwicG9zdCIsImRlbGV0ZSIsInRvdGFsQ291bnQiLCJjYWxsQ291bnQiLCJuZXdNZXRob2RNYXAiLCJHRVQiLCJjb21tYW5kIiwiUE9TVCIsInBheWxvYWRQYXJhbXMiLCJyZXF1aXJlZCIsInVwZGF0ZVNlcnZlciIsImh0dHBTZXJ2ZXIiLCJ1cGRhdGVkIiwiZmFrZURyaXZlciIsInNlc3Npb25FeGlzdHMiLCJleGVjdXRlQ29tbWFuZCIsImRlc2NyaWJlIiwicG9ydCIsImJlZm9yZSIsIml0IiwiY29uZmlndXJlUm91dGVzIiwiYWRkUm91dGVzIiwic2hvdWxkIiwiZXF1YWwiLCJhcHAxIiwiYXBwMiIsImRyaXZlciIsImV4dHJhTWV0aG9kTWFwIiwiZXFsIiwiX3NlcnZlciIsInJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbiIsInNlcnZlclVwZGF0ZXJzIiwiYmUiLCJ0cnVlIiwiY2xvc2UiLCJFcnJvciIsInJlamVjdGVkV2l0aCIsInRocm93Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxTQUFTQSxPQUFULEdBQW9CO0FBQ2xCLFFBQU1DLEdBQUcsR0FBRztBQUNWQyxJQUFBQSxHQUFHLEVBQUVDLGVBQU1DLEdBQU4sRUFESztBQUVWQyxJQUFBQSxHQUFHLEVBQUVGLGVBQU1DLEdBQU4sRUFGSztBQUdWRSxJQUFBQSxHQUFHLEVBQUVILGVBQU1DLEdBQU4sRUFISztBQUlWRyxJQUFBQSxJQUFJLEVBQUVKLGVBQU1DLEdBQU4sRUFKSTtBQUtWSSxJQUFBQSxNQUFNLEVBQUVMLGVBQU1DLEdBQU4sRUFMRTtBQU1WSyxJQUFBQSxVQUFVLEVBQUUsTUFDVlIsR0FBRyxDQUFDQyxHQUFKLENBQVFRLFNBQVIsR0FBb0JULEdBQUcsQ0FBQ0ksR0FBSixDQUFRSyxT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QUFZO0FBQ3pDRyxJQUFBQSxFQUFFLENBQUMsbURBQUQsRUFBc0QsWUFBWTtBQUNsRUcsTUFBQUEsTUFBTSxDQUFDZSxLQUFQLENBQWEsTUFBTTtBQUNqQix3Q0FBa0IsSUFBbEI7QUFDRCxPQUZEO0FBR0FmLE1BQUFBLE1BQU0sQ0FBQ2UsS0FBUCxDQUFhLE1BQU07QUFDakIsd0NBQWtCLENBQWxCO0FBQ0QsT0FGRDtBQUdELEtBUEMsQ0FBRjtBQVFBbEIsSUFBQUEsRUFBRSxDQUFDLGdDQUFELEVBQW1DLFlBQVk7QUFDL0Msc0NBQWtCLFVBQWxCLEVBQThCRyxNQUE5QixDQUFxQ00sR0FBckMsQ0FBeUMsU0FBekM7QUFDQSxzQ0FBa0IsT0FBbEIsRUFBMkJOLE1BQTNCLENBQWtDTSxHQUFsQyxDQUFzQyxNQUF0QztBQUNBLHNDQUFrQixHQUFsQixFQUF1Qk4sTUFBdkIsQ0FBOEJNLEdBQTlCLENBQWtDLEVBQWxDO0FBQ0QsS0FKQyxDQUFGO0FBS0FULElBQUFBLEVBQUUsQ0FBQywwQ0FBRCxFQUE2QyxZQUFZO0FBQ3pELHNDQUFrQixLQUFsQixFQUF5QkcsTUFBekIsQ0FBZ0NNLEdBQWhDLENBQW9DLE1BQXBDO0FBQ0Esc0NBQWtCLFFBQWxCLEVBQTRCTixNQUE1QixDQUFtQ00sR0FBbkMsQ0FBdUMsU0FBdkM7QUFDQSxzQ0FBa0IsU0FBbEIsRUFBNkJOLE1BQTdCLENBQW9DTSxHQUFwQyxDQUF3QyxTQUF4QztBQUNELEtBSkMsQ0FBRjtBQUtELEdBbkJPLENBQVI7QUFvQkQsQ0FoRk8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgeyBzZXJ2ZXIsIHJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbiB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBjb25maWd1cmVTZXJ2ZXIsIG5vcm1hbGl6ZUJhc2VQYXRoIH0gZnJvbSAnLi4vLi4vbGliL2V4cHJlc3Mvc2VydmVyJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQge2dldFRlc3RQb3J0fSBmcm9tICcuLi9oZWxwZXJzJztcblxuZnVuY3Rpb24gZmFrZUFwcCAoKSB7XG4gIGNvbnN0IGFwcCA9IHtcbiAgICB1c2U6IHNpbm9uLnNweSgpLFxuICAgIGFsbDogc2lub24uc3B5KCksXG4gICAgZ2V0OiBzaW5vbi5zcHkoKSxcbiAgICBwb3N0OiBzaW5vbi5zcHkoKSxcbiAgICBkZWxldGU6IHNpbm9uLnNweSgpLFxuICAgIHRvdGFsQ291bnQ6ICgpID0+IChcbiAgICAgIGFwcC51c2UuY2FsbENvdW50ICsgYXBwLmFsbC5jYWxsQ291bnQgKyBhcHAuZ2V0LmNhbGxDb3VudCArIGFwcC5wb3N0LmNhbGxDb3VudCArXG4gICAgICBhcHAuZGVsZXRlLmNhbGxDb3VudFxuICAgIClcbiAgfTtcbiAgcmV0dXJuIGFwcDtcbn1cblxuY29uc3QgbmV3TWV0aG9kTWFwID0ge1xuICAnL3Nlc3Npb24vOnNlc3Npb25JZC9mYWtlJzoge1xuICAgIEdFVDoge2NvbW1hbmQ6ICdmYWtlR2V0J30sXG4gICAgUE9TVDoge2NvbW1hbmQ6ICdmYWtlUG9zdCcsIHBheWxvYWRQYXJhbXM6IHtyZXF1aXJlZDogWydmYWtlUGFyYW0nXX19XG4gIH0sXG59O1xuXG5jb25zdCB1cGRhdGVTZXJ2ZXIgPSAoYXBwLCBodHRwU2VydmVyKSA9PiB7XG4gIGFwcC51cGRhdGVkID0gdHJ1ZTtcbiAgaHR0cFNlcnZlci51cGRhdGVkID0gdHJ1ZTtcbn07XG5cbmZ1bmN0aW9uIGZha2VEcml2ZXIgKCkge1xuICByZXR1cm4ge3Nlc3Npb25FeGlzdHM6ICgpID0+IHt9LCBleGVjdXRlQ29tbWFuZDogKCkgPT4ge319O1xufVxuXG5kZXNjcmliZSgnc2VydmVyIGNvbmZpZ3VyYXRpb24nLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBwb3J0O1xuXG4gIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgcG9ydCA9IGF3YWl0IGdldFRlc3RQb3J0KHRydWUpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGFjdHVhbGx5IHVzZSB0aGUgbWlkZGxld2FyZScsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhcHAgPSBmYWtlQXBwKCk7XG4gICAgY29uc3QgY29uZmlndXJlUm91dGVzID0gKCkgPT4ge307XG4gICAgY29uZmlndXJlU2VydmVyKHthcHAsIGFkZFJvdXRlczogY29uZmlndXJlUm91dGVzfSk7XG4gICAgYXBwLnVzZS5jYWxsQ291bnQuc2hvdWxkLmVxdWFsKDE0KTtcbiAgICBhcHAuYWxsLmNhbGxDb3VudC5zaG91bGQuZXF1YWwoNCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYXBwbHkgbmV3IG1ldGhvZHMgaW4gcGx1Z2lucyB0byB0aGUgc3RhbmRhcmQgbWV0aG9kIG1hcCcsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhcHAxID0gZmFrZUFwcCgpO1xuICAgIGNvbnN0IGFwcDIgPSBmYWtlQXBwKCk7XG4gICAgY29uc3QgZHJpdmVyID0gZmFrZURyaXZlcigpO1xuICAgIGNvbnN0IGFkZFJvdXRlcyA9IHJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbihkcml2ZXIpO1xuICAgIGNvbmZpZ3VyZVNlcnZlcih7YXBwOiBhcHAxLCBhZGRSb3V0ZXN9KTtcbiAgICBjb25maWd1cmVTZXJ2ZXIoe2FwcDogYXBwMiwgYWRkUm91dGVzLCBleHRyYU1ldGhvZE1hcDogbmV3TWV0aG9kTWFwfSk7XG4gICAgYXBwMi50b3RhbENvdW50KCkuc2hvdWxkLmVxbChhcHAxLnRvdGFsQ291bnQoKSArIDIpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNpbGVudGx5IHJlamVjdCBuZXcgbWV0aG9kcyBpbiBwbHVnaW5zIGlmIG5vdCBwbGFpbiBvYmplY3RzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGFwcDEgPSBmYWtlQXBwKCk7XG4gICAgY29uc3QgYXBwMiA9IGZha2VBcHAoKTtcbiAgICBjb25zdCBkcml2ZXIgPSBmYWtlRHJpdmVyKCk7XG4gICAgY29uc3QgYWRkUm91dGVzID0gcm91dGVDb25maWd1cmluZ0Z1bmN0aW9uKGRyaXZlcik7XG4gICAgY29uZmlndXJlU2VydmVyKHthcHA6IGFwcDEsIGFkZFJvdXRlc30pO1xuICAgIGNvbmZpZ3VyZVNlcnZlcih7YXBwOiBhcHAyLCBhZGRSb3V0ZXMsIGV4dHJhTWV0aG9kTWFwOiBbXX0pO1xuICAgIGFwcDIudG90YWxDb3VudCgpLnNob3VsZC5lcWwoYXBwMS50b3RhbENvdW50KCkpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGFsbG93IHBsdWdpbnMgdG8gdXBkYXRlIHRoZSBzZXJ2ZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgZHJpdmVyID0gZmFrZURyaXZlcigpO1xuICAgIGNvbnN0IF9zZXJ2ZXIgPSBhd2FpdCBzZXJ2ZXIoe1xuICAgICAgcm91dGVDb25maWd1cmluZ0Z1bmN0aW9uOiByb3V0ZUNvbmZpZ3VyaW5nRnVuY3Rpb24oZHJpdmVyKSxcbiAgICAgIHBvcnQsXG4gICAgICBleHRyYU1ldGhvZE1hcDogbmV3TWV0aG9kTWFwLFxuICAgICAgc2VydmVyVXBkYXRlcnM6IFt1cGRhdGVTZXJ2ZXJdXG4gICAgfSk7XG4gICAgdHJ5IHtcbiAgICAgIF9zZXJ2ZXIudXBkYXRlZC5zaG91bGQuYmUudHJ1ZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgX3NlcnZlci5jbG9zZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZWplY3QgaWYgZXJyb3IgdGhyb3duIGluIGNvbmZpZ3VyZVJvdXRlcyBwYXJhbWV0ZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgY29uZmlndXJlUm91dGVzID0gKCkgPT4ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJIGFtIE1yLiBNZWVTZWVrcyBsb29rIGF0IG1lIScpO1xuICAgIH07XG4gICAgYXdhaXQgc2VydmVyKHtcbiAgICAgIHJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbjogY29uZmlndXJlUm91dGVzLFxuICAgICAgcG9ydCxcbiAgICB9KS5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKCdNZWVTZWVrcycpO1xuICB9KTtcblxuICBkZXNjcmliZSgnI25vcm1hbGl6ZUJhc2VQYXRoJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgZm9yIHBhdGhzIG9mIHRoZSB3cm9uZyB0eXBlJywgZnVuY3Rpb24gKCkge1xuICAgICAgc2hvdWxkLnRocm93KCgpID0+IHtcbiAgICAgICAgbm9ybWFsaXplQmFzZVBhdGgobnVsbCk7XG4gICAgICB9KTtcbiAgICAgIHNob3VsZC50aHJvdygoKSA9PiB7XG4gICAgICAgIG5vcm1hbGl6ZUJhc2VQYXRoKDEpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgdHJhaWxpbmcgc2xhc2hlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIG5vcm1hbGl6ZUJhc2VQYXRoKCcvd2QvaHViLycpLnNob3VsZC5lcWwoJy93ZC9odWInKTtcbiAgICAgIG5vcm1hbGl6ZUJhc2VQYXRoKCcvZm9vLycpLnNob3VsZC5lcWwoJy9mb28nKTtcbiAgICAgIG5vcm1hbGl6ZUJhc2VQYXRoKCcvJykuc2hvdWxkLmVxbCgnJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlbnN1cmUgYSBsZWFkaW5nIHNsYXNoIGlzIHByZXNlbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBub3JtYWxpemVCYXNlUGF0aCgnZm9vJykuc2hvdWxkLmVxbCgnL2ZvbycpO1xuICAgICAgbm9ybWFsaXplQmFzZVBhdGgoJ3dkL2h1YicpLnNob3VsZC5lcWwoJy93ZC9odWInKTtcbiAgICAgIG5vcm1hbGl6ZUJhc2VQYXRoKCd3ZC9odWIvJykuc2hvdWxkLmVxbCgnL3dkL2h1YicpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L2V4cHJlc3Mvc2VydmVyLXNwZWNzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
