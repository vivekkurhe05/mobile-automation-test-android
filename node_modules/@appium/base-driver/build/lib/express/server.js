"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configureServer = configureServer;
exports.normalizeBasePath = normalizeBasePath;
exports.server = server;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _express = _interopRequireDefault(require("express"));

var _http = _interopRequireDefault(require("http"));

var _serveFavicon = _interopRequireDefault(require("serve-favicon"));

var _bodyParser = _interopRequireDefault(require("body-parser"));

var _methodOverride = _interopRequireDefault(require("method-override"));

var _logger = _interopRequireDefault(require("./logger"));

var _expressLogging = require("./express-logging");

var _middleware = require("./middleware");

var _static = require("./static");

var _crash = require("./crash");

var _websocket = require("./websocket");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _constants = require("../constants");

var _events = require("events");

const KEEP_ALIVE_TIMEOUT_MS = 10 * 60 * 1000;

async function server(opts = {}) {
  const {
    routeConfiguringFunction,
    port,
    hostname = null,
    allowCors = true,
    basePath = _constants.DEFAULT_BASE_PATH,
    extraMethodMap = {},
    serverUpdaters = [],
    keepAliveTimeout = KEEP_ALIVE_TIMEOUT_MS
  } = opts;
  const app = (0, _express.default)();

  const httpServer = _http.default.createServer(app);

  return await new _bluebird.default(async (resolve, reject) => {
    try {
      configureHttp({
        httpServer,
        reject,
        keepAliveTimeout
      });
      configureServer({
        app,
        addRoutes: routeConfiguringFunction,
        allowCors,
        basePath,
        extraMethodMap
      });

      for (const updater of serverUpdaters) {
        await updater(app, httpServer);
      }

      app.all('*', _middleware.catch404Handler);
      await startServer({
        httpServer,
        hostname,
        port,
        keepAliveTimeout
      });
      resolve(httpServer);
    } catch (err) {
      reject(err);
    }
  });
}

function configureServer({
  app,
  addRoutes,
  allowCors = true,
  basePath = _constants.DEFAULT_BASE_PATH,
  extraMethodMap = {}
}) {
  basePath = normalizeBasePath(basePath);
  app.use(_expressLogging.endLogFormatter);
  app.use((0, _serveFavicon.default)(_path.default.resolve(_static.STATIC_DIR, 'favicon.ico')));
  app.use(_express.default.static(_static.STATIC_DIR));
  app.use(`${basePath}/produce_error`, _crash.produceError);
  app.use(`${basePath}/crash`, _crash.produceCrash);

  if (allowCors) {
    app.use(_middleware.allowCrossDomain);
  } else {
    app.use((0, _middleware.allowCrossDomainAsyncExecute)(basePath));
  }

  app.use(_middleware.handleIdempotency);
  app.use((0, _middleware.fixPythonContentType)(basePath));
  app.use(_middleware.defaultToJSONContentType);
  app.use(_bodyParser.default.urlencoded({
    extended: true
  }));
  app.use((0, _methodOverride.default)());
  app.use(_middleware.catchAllHandler);
  app.use(_bodyParser.default.json({
    limit: '1gb'
  }));
  app.use(_expressLogging.startLogFormatter);
  addRoutes(app, {
    basePath,
    extraMethodMap
  });
  app.all('/welcome', _static.welcome);
  app.all('/test/guinea-pig', _static.guineaPig);
  app.all('/test/guinea-pig-scrollable', _static.guineaPigScrollable);
  app.all('/test/guinea-pig-app-banner', _static.guineaPigAppBanner);
}

function configureHttp({
  httpServer,
  reject,
  keepAliveTimeout
}) {
  const serverState = {
    notifier: new _events.EventEmitter(),
    closed: false
  };
  httpServer.addWebSocketHandler = _websocket.addWebSocketHandler;
  httpServer.removeWebSocketHandler = _websocket.removeWebSocketHandler;
  httpServer.removeAllWebSocketHandlers = _websocket.removeAllWebSocketHandlers;
  httpServer.getWebSocketHandlers = _websocket.getWebSocketHandlers;
  const close = httpServer.close.bind(httpServer);

  httpServer.close = async () => await new _bluebird.default((resolve, reject) => {
    serverState.closed = true;
    serverState.notifier.emit('shutdown');

    _logger.default.info('Waiting until the server is closed');

    httpServer.on('close', () => {
      _logger.default.info('Received server close event');

      resolve();
    });
    close(err => {
      if (err) reject(err);
    });
  });

  httpServer.on('error', err => {
    if (err.code === 'EADDRNOTAVAIL') {
      _logger.default.error('Could not start REST http interface listener. ' + 'Requested address is not available.');
    } else {
      _logger.default.error('Could not start REST http interface listener. The requested ' + 'port may already be in use. Please make sure there is no ' + 'other instance of this server running already.');
    }

    reject(err);
  });
  httpServer.on('connection', socket => {
    socket.setTimeout(keepAliveTimeout);
    socket.on('error', reject);

    function destroy() {
      socket.destroy();
    }

    socket._openReqCount = 0;
    socket.once('close', () => serverState.notifier.removeListener('shutdown', destroy));
    serverState.notifier.once('shutdown', destroy);
  });
  httpServer.on('request', function (req, res) {
    const socket = req.connection || req.socket;
    socket._openReqCount++;
    res.on('finish', function () {
      socket._openReqCount--;

      if (serverState.closed && socket._openReqCount === 0) {
        socket.destroy();
      }
    });
  });
}

async function startServer({
  httpServer,
  port,
  hostname,
  keepAliveTimeout
}) {
  const serverArgs = [port];

  if (hostname) {
    serverArgs.push(hostname);
  }

  const startPromise = _bluebird.default.promisify(httpServer.listen, {
    context: httpServer
  })(...serverArgs);

  httpServer.keepAliveTimeout = keepAliveTimeout;
  httpServer.headersTimeout = keepAliveTimeout + 5 * 1000;
  await startPromise;
}

function normalizeBasePath(basePath) {
  if (!_lodash.default.isString(basePath)) {
    throw new Error(`Invalid path prefix ${basePath}`);
  }

  basePath = basePath.replace(/\/$/, '');

  if (basePath !== '' && basePath[0] !== '/') {
    basePath = `/${basePath}`;
  }

  return basePath;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9leHByZXNzL3NlcnZlci5qcyJdLCJuYW1lcyI6WyJLRUVQX0FMSVZFX1RJTUVPVVRfTVMiLCJzZXJ2ZXIiLCJvcHRzIiwicm91dGVDb25maWd1cmluZ0Z1bmN0aW9uIiwicG9ydCIsImhvc3RuYW1lIiwiYWxsb3dDb3JzIiwiYmFzZVBhdGgiLCJERUZBVUxUX0JBU0VfUEFUSCIsImV4dHJhTWV0aG9kTWFwIiwic2VydmVyVXBkYXRlcnMiLCJrZWVwQWxpdmVUaW1lb3V0IiwiYXBwIiwiaHR0cFNlcnZlciIsImh0dHAiLCJjcmVhdGVTZXJ2ZXIiLCJCIiwicmVzb2x2ZSIsInJlamVjdCIsImNvbmZpZ3VyZUh0dHAiLCJjb25maWd1cmVTZXJ2ZXIiLCJhZGRSb3V0ZXMiLCJ1cGRhdGVyIiwiYWxsIiwiY2F0Y2g0MDRIYW5kbGVyIiwic3RhcnRTZXJ2ZXIiLCJlcnIiLCJub3JtYWxpemVCYXNlUGF0aCIsInVzZSIsImVuZExvZ0Zvcm1hdHRlciIsInBhdGgiLCJTVEFUSUNfRElSIiwiZXhwcmVzcyIsInN0YXRpYyIsInByb2R1Y2VFcnJvciIsInByb2R1Y2VDcmFzaCIsImFsbG93Q3Jvc3NEb21haW4iLCJoYW5kbGVJZGVtcG90ZW5jeSIsImRlZmF1bHRUb0pTT05Db250ZW50VHlwZSIsImJvZHlQYXJzZXIiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJjYXRjaEFsbEhhbmRsZXIiLCJqc29uIiwibGltaXQiLCJzdGFydExvZ0Zvcm1hdHRlciIsIndlbGNvbWUiLCJndWluZWFQaWciLCJndWluZWFQaWdTY3JvbGxhYmxlIiwiZ3VpbmVhUGlnQXBwQmFubmVyIiwic2VydmVyU3RhdGUiLCJub3RpZmllciIsIkV2ZW50RW1pdHRlciIsImNsb3NlZCIsImFkZFdlYlNvY2tldEhhbmRsZXIiLCJyZW1vdmVXZWJTb2NrZXRIYW5kbGVyIiwicmVtb3ZlQWxsV2ViU29ja2V0SGFuZGxlcnMiLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImNsb3NlIiwiYmluZCIsImVtaXQiLCJsb2ciLCJpbmZvIiwib24iLCJjb2RlIiwiZXJyb3IiLCJzb2NrZXQiLCJzZXRUaW1lb3V0IiwiZGVzdHJveSIsIl9vcGVuUmVxQ291bnQiLCJvbmNlIiwicmVtb3ZlTGlzdGVuZXIiLCJyZXEiLCJyZXMiLCJjb25uZWN0aW9uIiwic2VydmVyQXJncyIsInB1c2giLCJzdGFydFByb21pc2UiLCJwcm9taXNpZnkiLCJsaXN0ZW4iLCJjb250ZXh0IiwiaGVhZGVyc1RpbWVvdXQiLCJfIiwiaXNTdHJpbmciLCJFcnJvciIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFLQTs7QUFDQTs7QUFDQTs7QUFJQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxxQkFBcUIsR0FBRyxLQUFLLEVBQUwsR0FBVSxJQUF4Qzs7QUFHQSxlQUFlQyxNQUFmLENBQXVCQyxJQUFJLEdBQUcsRUFBOUIsRUFBa0M7QUFDaEMsUUFBTTtBQUNKQyxJQUFBQSx3QkFESTtBQUVKQyxJQUFBQSxJQUZJO0FBR0pDLElBQUFBLFFBQVEsR0FBRyxJQUhQO0FBSUpDLElBQUFBLFNBQVMsR0FBRyxJQUpSO0FBS0pDLElBQUFBLFFBQVEsR0FBR0MsNEJBTFA7QUFNSkMsSUFBQUEsY0FBYyxHQUFHLEVBTmI7QUFPSkMsSUFBQUEsY0FBYyxHQUFHLEVBUGI7QUFRSkMsSUFBQUEsZ0JBQWdCLEdBQUdYO0FBUmYsTUFTRkUsSUFUSjtBQVlBLFFBQU1VLEdBQUcsR0FBRyx1QkFBWjs7QUFDQSxRQUFNQyxVQUFVLEdBQUdDLGNBQUtDLFlBQUwsQ0FBa0JILEdBQWxCLENBQW5COztBQUNBLFNBQU8sTUFBTSxJQUFJSSxpQkFBSixDQUFNLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEtBQTJCO0FBTTVDLFFBQUk7QUFDRkMsTUFBQUEsYUFBYSxDQUFDO0FBQUNOLFFBQUFBLFVBQUQ7QUFBYUssUUFBQUEsTUFBYjtB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N0UsUUFBUyxFQUExQyxDQUFOO0FBQ0Q7O0FBSURBLEVBQUFBLFFBQVEsR0FBR0EsUUFBUSxDQUFDOEUsT0FBVCxDQUFpQixLQUFqQixFQUF3QixFQUF4QixDQUFYOztBQUlBLE1BQUk5RSxRQUFRLEtBQUssRUFBYixJQUFtQkEsUUFBUSxDQUFDLENBQUQsQ0FBUixLQUFnQixHQUF2QyxFQUE0QztBQUMxQ0EsSUFBQUEsUUFBUSxHQUFJLElBQUdBLFFBQVMsRUFBeEI7QUFDRDs7QUFFRCxTQUFPQSxRQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBodHRwIGZyb20gJ2h0dHAnO1xuaW1wb3J0IGZhdmljb24gZnJvbSAnc2VydmUtZmF2aWNvbic7XG5pbXBvcnQgYm9keVBhcnNlciBmcm9tICdib2R5LXBhcnNlcic7XG5pbXBvcnQgbWV0aG9kT3ZlcnJpZGUgZnJvbSAnbWV0aG9kLW92ZXJyaWRlJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgc3RhcnRMb2dGb3JtYXR0ZXIsIGVuZExvZ0Zvcm1hdHRlciB9IGZyb20gJy4vZXhwcmVzcy1sb2dnaW5nJztcbmltcG9ydCB7XG4gIGFsbG93Q3Jvc3NEb21haW4sIGZpeFB5dGhvbkNvbnRlbnRUeXBlLCBkZWZhdWx0VG9KU09OQ29udGVudFR5cGUsXG4gIGNhdGNoQWxsSGFuZGxlciwgYWxsb3dDcm9zc0RvbWFpbkFzeW5jRXhlY3V0ZSwgaGFuZGxlSWRlbXBvdGVuY3ksXG4gIGNhdGNoNDA0SGFuZGxlcixcbn0gZnJvbSAnLi9taWRkbGV3YXJlJztcbmltcG9ydCB7IGd1aW5lYVBpZywgZ3VpbmVhUGlnU2Nyb2xsYWJsZSwgZ3VpbmVhUGlnQXBwQmFubmVyLCB3ZWxjb21lLCBTVEFUSUNfRElSIH0gZnJvbSAnLi9zdGF0aWMnO1xuaW1wb3J0IHsgcHJvZHVjZUVycm9yLCBwcm9kdWNlQ3Jhc2ggfSBmcm9tICcuL2NyYXNoJztcbmltcG9ydCB7XG4gIGFkZFdlYlNvY2tldEhhbmRsZXIsIHJlbW92ZVdlYlNvY2tldEhhbmRsZXIsIHJlbW92ZUFsbFdlYlNvY2tldEhhbmRsZXJzLFxuICBnZXRXZWJTb2NrZXRIYW5kbGVyc1xufSBmcm9tICcuL3dlYnNvY2tldCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBERUZBVUxUX0JBU0VfUEFUSCB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuXG5cbmNvbnN0IEtFRVBfQUxJVkVfVElNRU9VVF9NUyA9IDEwICogNjAgKiAxMDAwOyAvLyAxMCBtaW51dGVzXG5cblxuYXN5bmMgZnVuY3Rpb24gc2VydmVyIChvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbixcbiAgICBwb3J0LFxuICAgIGhvc3RuYW1lID0gbnVsbCxcbiAgICBhbGxvd0NvcnMgPSB0cnVlLFxuICAgIGJhc2VQYXRoID0gREVGQVVMVF9CQVNFX1BBVEgsXG4gICAgZXh0cmFNZXRob2RNYXAgPSB7fSxcbiAgICBzZXJ2ZXJVcGRhdGVycyA9IFtdLFxuICAgIGtlZXBBbGl2ZVRpbWVvdXQgPSBLRUVQX0FMSVZFX1RJTUVPVVRfTVMsXG4gIH0gPSBvcHRzO1xuXG4gIC8vIGNyZWF0ZSB0aGUgYWN0dWFsIGh0dHAgc2VydmVyXG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgY29uc3QgaHR0cFNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGFwcCk7XG4gIHJldHVybiBhd2FpdCBuZXcgQihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgLy8gd2UgcHV0IGFuIGFzeW5jIGZ1bmN0aW9uIGFzIHRoZSBwcm9taXNlIGNvbnN0cnVjdG9yIGJlY2F1c2Ugd2Ugd2FudCBzb21lIHRoaW5ncyB0byBoYXBwZW4gaW5cbiAgICAvLyBzZXJpYWwgKGFwcGxpY2F0aW9uIG9mIHBsdWdpbiB1cGRhdGVzLCBmb3IgZXhhbXBsZSkuIEJ1dCB3ZSBzdGlsbCBuZWVkIHRvIHVzZSBhIHByb21pc2UgaGVyZVxuICAgIC8vIGJlY2F1c2Ugc29tZSBlbGVtZW50cyBvZiBzZXJ2ZXIgc3RhcnQgZmFpbHVyZSBvbmx5IGhhcHBlbiBpbiBodHRwU2VydmVyIGxpc3RlbmVycy4gU28gdGhlXG4gICAgLy8gd2F5IHdlIHJlc29sdmUgaXQgaXMgdG8gdXNlIGFuIGFzeW5jIGZ1bmN0aW9uIGhlcmUgYnV0IHRvIHdyYXAgYWxsIHRoZSBpbm5lciBsb2dpYyBpblxuICAgIC8vIHRyeS9jYXRjaCBzbyBhbnkgZXJyb3JzIGNhbiBiZSBwYXNzZWQgdG8gcmVqZWN0LlxuICAgIHRyeSB7XG4gICAgICBjb25maWd1cmVIdHRwKHtodHRwU2VydmVyLCByZWplY3QsIGtlZXBBbGl2ZVRpbWVvdXR9KTtcbiAgICAgIGNvbmZpZ3VyZVNlcnZlcih7YXBwLCBhZGRSb3V0ZXM6IHJvdXRlQ29uZmlndXJpbmdGdW5jdGlvbiwgYWxsb3dDb3JzLCBiYXNlUGF0aCwgZXh0cmFNZXRob2RNYXB9KTtcbiAgICAgIC8vIGFsbG93IGV4dGVuc2lvbnMgdG8gdXBkYXRlIHRoZSBhcHAgYW5kIGh0dHAgc2VydmVyIG9iamVjdHNcbiAgICAgIGZvciAoY29uc3QgdXBkYXRlciBvZiBzZXJ2ZXJVcGRhdGVycykge1xuICAgICAgICBhd2FpdCB1cGRhdGVyKGFwcCwgaHR0cFNlcnZlcik7XG4gICAgICB9XG5cbiAgICAgIC8vIG9uY2UgYWxsIGNvbmZpZ3VyYXRpb25zIGFuZCB1cGRhdGVycyBoYXZlIGJlZW4gYXBwbGllZCwgbWFrZSBzdXJlIHRvIHNldCB1cCBhIGNhdGNoYWxsXG4gICAgICAvLyBoYW5kbGVyIHNvIHRoYXQgYW55dGhpbmcgdW5rbm93biA0MDRzLiBCdXQgZG8gdGhpcyBhZnRlciBldmVyeXRoaW5nIGVsc2Ugc2luY2Ugd2UgZG9uJ3RcbiAgICAgIC8vIHdhbnQgdG8gYmxvY2sgZXh0ZW5zaW9ucycgYWJpbGl0eSB0byBhZGQgcm91dGVzIGlmIHRoZXkgd2FudC5cbiAgICAgIGFwcC5hbGwoJyonLCBjYXRjaDQwNEhhbmRsZXIpO1xuXG4gICAgICBhd2FpdCBzdGFydFNlcnZlcih7aHR0cFNlcnZlciwgaG9zdG5hbWUsIHBvcnQsIGtlZXBBbGl2ZVRpbWVvdXR9KTtcbiAgICAgIHJlc29sdmUoaHR0cFNlcnZlcik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG4gIH0pO1xuXG59XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZVNlcnZlciAoe1xuICBhcHAsXG4gIGFkZFJvdXRlcyxcbiAgYWxsb3dDb3JzID0gdHJ1ZSxcbiAgYmFzZVBhdGggPSBERUZBVUxUX0JBU0VfUEFUSCxcbiAgZXh0cmFNZXRob2RNYXAgPSB7fSxcbn0pIHtcbiAgYmFzZVBhdGggPSBub3JtYWxpemVCYXNlUGF0aChiYXNlUGF0aCk7XG5cbiAgYXBwLnVzZShlbmRMb2dGb3JtYXR0ZXIpO1xuXG4gIC8vIHNldCB1cCBzdGF0aWMgYXNzZXRzXG4gIGFwcC51c2UoZmF2aWNvbihwYXRoLnJlc29sdmUoU1RBVElDX0RJUiwgJ2Zhdmljb24uaWNvJykpKTtcbiAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhTVEFUSUNfRElSKSk7XG5cbiAgLy8gY3Jhc2ggcm91dGVzLCBmb3IgdGVzdGluZ1xuICBhcHAudXNlKGAke2Jhc2VQYXRofS9wcm9kdWNlX2Vycm9yYCwgcHJvZHVjZUVycm9yKTtcbiAgYXBwLnVzZShgJHtiYXNlUGF0aH0vY3Jhc2hgLCBwcm9kdWNlQ3Jhc2gpO1xuXG4gIC8vIGFkZCBtaWRkbGV3YXJlc1xuICBpZiAoYWxsb3dDb3JzKSB7XG4gICAgYXBwLnVzZShhbGxvd0Nyb3NzRG9tYWluKTtcbiAgfSBlbHNlIHtcbiAgICBhcHAudXNlKGFsbG93Q3Jvc3NEb21haW5Bc3luY0V4ZWN1dGUoYmFzZVBhdGgpKTtcbiAgfVxuICBhcHAudXNlKGhhbmRsZUlkZW1wb3RlbmN5KTtcbiAgYXBwLnVzZShmaXhQeXRob25Db250ZW50VHlwZShiYXNlUGF0aCkpO1xuICBhcHAudXNlKGRlZmF1bHRUb0pTT05Db250ZW50VHlwZSk7XG4gIGFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHtleHRlbmRlZDogdHJ1ZX0pKTtcbiAgYXBwLnVzZShtZXRob2RPdmVycmlkZSgpKTtcbiAgYXBwLnVzZShjYXRjaEFsbEhhbmRsZXIpO1xuXG4gIC8vIG1ha2Ugc3VyZSBhcHBpdW0gbmV2ZXIgZmFpbHMgYmVjYXVzZSBvZiBhIGZpbGUgc2l6ZSB1cGxvYWQgbGltaXRcbiAgYXBwLnVzZShib2R5UGFyc2VyLmpzb24oe2xpbWl0OiAnMWdiJ30pKTtcblxuICAvLyBzZXQgdXAgc3RhcnQgbG9nZ2luZyAod2hpY2ggZGVwZW5kcyBvbiBib2R5UGFyc2VyIGRvaW5nIGl0cyB0aGluZylcbiAgYXBwLnVzZShzdGFydExvZ0Zvcm1hdHRlcik7XG5cbiAgYWRkUm91dGVzKGFwcCwge2Jhc2VQYXRoLCBleHRyYU1ldGhvZE1hcH0pO1xuXG4gIC8vIGR5bmFtaWMgcm91dGVzIGZvciB0ZXN0aW5nLCBldGMuXG4gIGFwcC5hbGwoJy93ZWxjb21lJywgd2VsY29tZSk7XG4gIGFwcC5hbGwoJy90ZXN0L2d1aW5lYS1waWcnLCBndWluZWFQaWcpO1xuICBhcHAuYWxsKCcvdGVzdC9ndWluZWEtcGlnLXNjcm9sbGFibGUnLCBndWluZWFQaWdTY3JvbGxhYmxlKTtcbiAgYXBwLmFsbCgnL3Rlc3QvZ3VpbmVhLXBpZy1hcHAtYmFubmVyJywgZ3VpbmVhUGlnQXBwQmFubmVyKTtcbn1cblxuZnVuY3Rpb24gY29uZmlndXJlSHR0cCAoe2h0dHBTZXJ2ZXIsIHJlamVjdCwga2VlcEFsaXZlVGltZW91dH0pIHtcbiAgY29uc3Qgc2VydmVyU3RhdGUgPSB7XG4gICAgbm90aWZpZXI6IG5ldyBFdmVudEVtaXR0ZXIoKSxcbiAgICBjbG9zZWQ6IGZhbHNlLFxuICB9O1xuICBodHRwU2VydmVyLmFkZFdlYlNvY2tldEhhbmRsZXIgPSBhZGRXZWJTb2NrZXRIYW5kbGVyO1xuICBodHRwU2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIgPSByZW1vdmVXZWJTb2NrZXRIYW5kbGVyO1xuICBodHRwU2VydmVyLnJlbW92ZUFsbFdlYlNvY2tldEhhbmRsZXJzID0gcmVtb3ZlQWxsV2ViU29ja2V0SGFuZGxlcnM7XG4gIGh0dHBTZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMgPSBnZXRXZWJTb2NrZXRIYW5kbGVycztcblxuICAvLyBodHRwLlNlcnZlci5jbG9zZSgpIG9ubHkgc3RvcHMgbmV3IGNvbm5lY3Rpb25zLCBidXQgd2UgbmVlZCB0byB3YWl0IHVudGlsXG4gIC8vIGFsbCBjb25uZWN0aW9ucyBhcmUgY2xvc2VkIGFuZCB0aGUgYGNsb3NlYCBldmVudCBpcyBlbWl0dGVkXG4gIGNvbnN0IGNsb3NlID0gaHR0cFNlcnZlci5jbG9zZS5iaW5kKGh0dHBTZXJ2ZXIpO1xuICBodHRwU2VydmVyLmNsb3NlID0gYXN5bmMgKCkgPT4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS12MC54LWFyY2hpdmUvaXNzdWVzLzkwNjYjaXNzdWVjb21tZW50LTEyNDIxMDU3NlxuICAgIHNlcnZlclN0YXRlLmNsb3NlZCA9IHRydWU7XG4gICAgc2VydmVyU3RhdGUubm90aWZpZXIuZW1pdCgnc2h1dGRvd24nKTtcbiAgICBsb2cuaW5mbygnV2FpdGluZyB1bnRpbCB0aGUgc2VydmVyIGlzIGNsb3NlZCcpO1xuICAgIGh0dHBTZXJ2ZXIub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgbG9nLmluZm8oJ1JlY2VpdmVkIHNlcnZlciBjbG9zZSBldmVudCcpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICAgIGNsb3NlKChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHJlamVjdChlcnIpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgfSk7XG4gIH0pO1xuXG4gIGh0dHBTZXJ2ZXIub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgIGlmIChlcnIuY29kZSA9PT0gJ0VBRERSTk9UQVZBSUwnKSB7XG4gICAgICBsb2cuZXJyb3IoJ0NvdWxkIG5vdCBzdGFydCBSRVNUIGh0dHAgaW50ZXJmYWNlIGxpc3RlbmVyLiAnICtcbiAgICAgICAgICAgICAgICAnUmVxdWVzdGVkIGFkZHJlc3MgaXMgbm90IGF2YWlsYWJsZS4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLmVycm9yKCdDb3VsZCBub3Qgc3RhcnQgUkVTVCBodHRwIGludGVyZmFjZSBsaXN0ZW5lci4gVGhlIHJlcXVlc3RlZCAnICtcbiAgICAgICAgICAgICAgICAncG9ydCBtYXkgYWxyZWFkeSBiZSBpbiB1c2UuIFBsZWFzZSBtYWtlIHN1cmUgdGhlcmUgaXMgbm8gJyArXG4gICAgICAgICAgICAgICAgJ290aGVyIGluc3RhbmNlIG9mIHRoaXMgc2VydmVyIHJ1bm5pbmcgYWxyZWFkeS4nKTtcbiAgICB9XG4gICAgcmVqZWN0KGVycik7XG4gIH0pO1xuXG4gIGh0dHBTZXJ2ZXIub24oJ2Nvbm5lY3Rpb24nLCAoc29ja2V0KSA9PiB7XG4gICAgc29ja2V0LnNldFRpbWVvdXQoa2VlcEFsaXZlVGltZW91dCk7XG4gICAgc29ja2V0Lm9uKCdlcnJvcicsIHJlamVjdCk7XG5cbiAgICBmdW5jdGlvbiBkZXN0cm95ICgpIHtcbiAgICAgIHNvY2tldC5kZXN0cm95KCk7XG4gICAgfVxuICAgIHNvY2tldC5fb3BlblJlcUNvdW50ID0gMDtcbiAgICBzb2NrZXQub25jZSgnY2xvc2UnLCAoKSA9PiBzZXJ2ZXJTdGF0ZS5ub3RpZmllci5yZW1vdmVMaXN0ZW5lcignc2h1dGRvd24nLCBkZXN0cm95KSk7XG4gICAgc2VydmVyU3RhdGUubm90aWZpZXIub25jZSgnc2h1dGRvd24nLCBkZXN0cm95KTtcbiAgfSk7XG5cbiAgaHR0cFNlcnZlci5vbigncmVxdWVzdCcsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgIGNvbnN0IHNvY2tldCA9IHJlcS5jb25uZWN0aW9uIHx8IHJlcS5zb2NrZXQ7XG4gICAgc29ja2V0Ll9vcGVuUmVxQ291bnQrKztcbiAgICByZXMub24oJ2ZpbmlzaCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNvY2tldC5fb3BlblJlcUNvdW50LS07XG4gICAgICBpZiAoc2VydmVyU3RhdGUuY2xvc2VkICYmIHNvY2tldC5fb3BlblJlcUNvdW50ID09PSAwKSB7XG4gICAgICAgIHNvY2tldC5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFNlcnZlciAoe2h0dHBTZXJ2ZXIsIHBvcnQsIGhvc3RuYW1lLCBrZWVwQWxpdmVUaW1lb3V0fSkge1xuICBjb25zdCBzZXJ2ZXJBcmdzID0gW3BvcnRdO1xuICBpZiAoaG9zdG5hbWUpIHtcbiAgICAvLyBJZiB0aGUgaG9zdG5hbWUgaXMgb21pdHRlZCwgdGhlIHNlcnZlciB3aWxsIGFjY2VwdFxuICAgIC8vIGNvbm5lY3Rpb25zIG9uIGFueSBJUCBhZGRyZXNzXG4gICAgc2VydmVyQXJncy5wdXNoKGhvc3RuYW1lKTtcbiAgfVxuICBjb25zdCBzdGFydFByb21pc2UgPSBCLnByb21pc2lmeShodHRwU2VydmVyLmxpc3Rlbiwge2NvbnRleHQ6IGh0dHBTZXJ2ZXJ9KSguLi5zZXJ2ZXJBcmdzKTtcbiAgaHR0cFNlcnZlci5rZWVwQWxpdmVUaW1lb3V0ID0ga2VlcEFsaXZlVGltZW91dDtcbiAgLy8gaGVhZGVycyB0aW1lb3V0IG11c3QgYmUgZ3JlYXRlciB0aGFuIGtlZXBBbGl2ZVRpbWVvdXRcbiAgaHR0cFNlcnZlci5oZWFkZXJzVGltZW91dCA9IGtlZXBBbGl2ZVRpbWVvdXQgKyA1ICogMTAwMDtcbiAgYXdhaXQgc3RhcnRQcm9taXNlO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVCYXNlUGF0aCAoYmFzZVBhdGgpIHtcbiAgaWYgKCFfLmlzU3RyaW5nKGJhc2VQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBwYXRoIHByZWZpeCAke2Jhc2VQYXRofWApO1xuICB9XG5cbiAgLy8gZW5zdXJlIHRoZSBwYXRoIHByZWZpeCBkb2VzIG5vdCBlbmQgaW4gJy8nLCBzaW5jZSBvdXIgbWV0aG9kIG1hcFxuICAvLyBzdGFydHMgYWxsIHBhdGhzIHdpdGggJy8nXG4gIGJhc2VQYXRoID0gYmFzZVBhdGgucmVwbGFjZSgvXFwvJC8sICcnKTtcblxuICAvLyBsaWtld2lzZSwgZW5zdXJlIHRoZSBwYXRoIHByZWZpeCBkb2VzIGFsd2F5cyBTVEFSVCB3aXRoIC8sIHVubGVzcyB0aGUgcGF0aFxuICAvLyBpcyBlbXB0eSBtZWFuaW5nIG5vIGJhc2UgcGF0aCBhdCBhbGxcbiAgaWYgKGJhc2VQYXRoICE9PSAnJyAmJiBiYXNlUGF0aFswXSAhPT0gJy8nKSB7XG4gICAgYmFzZVBhdGggPSBgLyR7YmFzZVBhdGh9YDtcbiAgfVxuXG4gIHJldHVybiBiYXNlUGF0aDtcbn1cblxuZXhwb3J0IHsgc2VydmVyLCBjb25maWd1cmVTZXJ2ZXIsIG5vcm1hbGl6ZUJhc2VQYXRoIH07XG4iXSwiZmlsZSI6ImxpYi9leHByZXNzL3NlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
