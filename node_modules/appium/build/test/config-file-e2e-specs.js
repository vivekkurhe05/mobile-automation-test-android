"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _configFile = require("../lib/config-file");

var _schema = require("../lib/schema/schema");

var _driverSchema = _interopRequireDefault(require("./fixtures/driver.schema.js"));

var _helpers = require("./helpers");

describe('config file behavior', function () {
  const GOOD_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.good.json');
  const BAD_NODECONFIG_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.bad-nodeconfig.json');
  const BAD_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.bad.json');
  const INVALID_JSON_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.invalid.json');
  const SECURITY_ARRAY_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.security-array.json');
  const SECURITY_DELIMITED_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.security-delimited.json');
  const SECURITY_PATH_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.security-path.json');
  const UNKNOWN_PROPS_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.ext-unknown-props.json');
  const EXT_PROPS_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.ext-good.json');
  beforeEach(function () {
    (0, _schema.finalizeSchema)();
  });
  afterEach(function () {
    (0, _schema.resetSchema)();
  });
  describe('when provided a path to a config file', function () {
    describe('when the config file is valid per the schema', function () {
      it('should return a valid config object', async function () {
        const result = await (0, _configFile.readConfigFile)(GOOD_FILEPATH);
        result.should.deep.equal({
          config: require(GOOD_FILEPATH),
          filepath: GOOD_FILEPATH,
          errors: []
        });
      });
      describe('server.nodeconfig behavior', function () {
        describe('when a string', function () {
          it('should return errors', async function () {
            const result = await (0, _configFile.readConfigFile)(BAD_NODECONFIG_FILEPATH);
            result.should.have.nested.property('errors[0].instancePath', '/server/nodeconfig');
          });
        });
        describe('when an object', function () {
          it('should return a valid config object', async function () {
            const result = await (0, _configFile.readConfigFile)(GOOD_FILEPATH);
            result.should.have.property('errors').that.is.empty;
          });
        });
      });
      describe('server.allow-insecure behavior', function () {
        describe('when a string path', function () {
          it('should return errors', async function () {
            const result = await (0, _configFile.readConfigFile)(SECURITY_PATH_FILEPATH);
            result.should.have.nested.property('errors[0].instancePath', '/server/allow-insecure');
          });
        });
        describe('when a comma-delimited string', function () {
          it('should return errors', async function () {
            const result = await (0, _configFile.readConfigFile)(SECURITY_DELIMITED_FILEPATH);
            result.should.have.nested.property('errors[0].instancePath', '/server/allow-insecure');
          });
        });
        describe('when an array', function () {
          it('should return a valid config object', async function () {
            const result = await (0, _configFile.readConfigFile)(SECURITY_ARRAY_FILEPATH);
            result.should.deep.equal({
              config: require(SECURITY_ARRAY_FILEPATH),
              filepath: SECURITY_ARRAY_FILEPATH,
              errors: []
            });
          });
        });
      });
    });
    describe('when the config file is invalid per the schema', function () {
      describe('without extensions', function () {
        it('should return an object containing errors', async function () {
          const result = await (0, _configFile.readConfigFile)(BAD_FILEPATH);
          result.should.have.deep.property('config', (0, _configFile.normalizeConfig)(require(BAD_FILEPATH)));
          result.should.have.property('filepath', BAD_FILEPATH);
          result.should.have.deep.property('errors').that.contains.members([{
            instancePath: '',
            schemaPath: '#/additionalProperties',
            keyword: 'additionalProperties',
            params: {
              additionalProperty: 'appium-home'
            },
            message: 'must NOT have additional properties',
            isIdentifierLocation: true
          }, {
            instancePath: '/server/allow-cors',
            schemaPath: '#/properties/server/properties/allow-cors/type',
            keyword: 'type',
            params: {
              type: 'boolean'
            },
            message: 'must be boolean'
          }, {
            instancePath: '/server/allow-insecure',
            schemaPath: '#/properties/server/properties/allow-insecure/type',
            keyword: 'type',
            params: {
              type: 'array'
            },
            message: 'must be array'
          }, {
            instancePath: '/server/callback-port',
            schemaPath: '#/properties/server/properties/callback-port/maximum',
            keyword: 'maximum',
            params: {
              comparison: '<=',
              limit: 65535
            },
            message: 'must be <= 65535'
          }, {
            instancePath: '/server/log-level',
            schemaPath: '#/properties/server/properties/log-level/enum',
            keyword: 'enum',
            params: {
              allowedValues: ['info', 'info:debug', 'info:info', 'info:warn', 'info:error', 'warn', 'warn:debug', 'warn:info', 'warn:warn', 'warn:error', 'error', 'error:debug', 'error:info', 'error:warn', 'error:error', 'debug', 'debug:debug', 'debug:info', 'debug:warn', 'debug:error']
            },
            message: 'must be equal to one of the allowed values'
          }, {
            instancePath: '/server/log-no-colors',
            schemaPath: '#/properties/server/properties/log-no-colors/type',
            keyword: 'type',
            params: {
              type: 'boolean'
            },
            message: 'must be boolean'
          }, {
            instancePath: '/server/port',
            schemaPath: '#/properties/server/properties/port/type',
            keyword: 'type',
            params: {
              type: 'integer'
            },
            message: 'must be integer'
          }]).and.lengthOf(7);
          result.should.have.property('reason').that.is.a.string;
        });
      });
      describe('with extensions', function () {
        let result;
        beforeEach(function () {
          (0, _schema.resetSchema)();
          (0, _schema.registerSchema)('driver', 'fake', _driverSchema.default);
          (0, _schema.finalizeSchema)();
        });
        describe('when provided a config file with unknown properties', function () {
          beforeEach(async function () {
            result = await (0, _configFile.readConfigFile)(UNKNOWN_PROPS_FILEPATH);
          });
          it('should return an object containing errors', function () {
            result.should.have.deep.property('errors', [{
              instancePath: '/server/driver/fake',
              schemaPath: 'driver-fake.json/additionalProperties',
              keyword: 'additionalProperties',
              params: {
                additionalProperty: 'bubb'
              },
              message: 'must NOT have additional properties',
              isIdentifierLocation: true
            }]);
          });
        });
        describe('when provided a config file with valid properties', function () {
          beforeEach(async function () {
            result = await (0, _configFile.readConfigFile)(EXT_PROPS_FILEPATH);
          });
          it('should return an object containing no errors', function () {
            result.should.have.deep.property('errors', []);
          });
        });
      });
    });
    describe('when the config file is invalid JSON', function () {
      it('should reject with a user-friendly error message', async function () {
        await (0, _configFile.readConfigFile)(INVALID_JSON_FILEPATH).should.be.rejectedWith(new RegExp(`${INVALID_JSON_FILEPATH} is invalid`));
      });
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvY29uZmlnLWZpbGUtZTJlLXNwZWNzLmpzIl0sIm5hbWVzIjpbImRlc2NyaWJlIiwiR09PRF9GSUxFUEFUSCIsIkJBRF9OT0RFQ09ORklHX0ZJTEVQQVRIIiwiQkFEX0ZJTEVQQVRIIiwiSU5WQUxJRF9KU09OX0ZJTEVQQVRIIiwiU0VDVVJJVFlfQVJSQVlfRklMRVBBVEgiLCJTRUNVUklUWV9ERUxJTUlURURfRklMRVBBVEgiLCJTRUNVUklUWV9QQVRIX0ZJTEVQQVRIIiwiVU5LTk9XTl9QUk9QU19GSUxFUEFUSCIsIkVYVF9QUk9QU19GSUxFUEFUSCIsImJlZm9yZUVhY2giLCJhZnRlckVhY2giLCJpdCIsInJlc3VsdCIsInNob3VsZCIsImRlZXAiLCJlcXVhbCIsImNvbmZpZyIsInJlcXVpcmUiLCJmaWxlcGF0aCIsImVycm9ycyIsImhhdmUiLCJuZXN0ZWQiLCJwcm9wZXJ0eSIsInRoYXQiLCJpcyIsImVtcHR5IiwiY29udGFpbnMiLCJtZW1iZXJzIiwiaW5zdGFuY2VQYXRoIiwic2NoZW1hUGF0aCIsImtleXdvcmQiLCJwYXJhbXMiLCJhZGRpdGlvbmFsUHJvcGVydHkiLCJtZXNzYWdlIiwiaXNJZGVudGlmaWVyTG9jYXRpb24iLCJ0eXBlIiwiY29tcGFyaXNvbiIsImxpbWl0IiwiYWxsb3dlZFZhbHVlcyIsImFuZCIsImxlbmd0aE9mIiwiYSIsInN0cmluZyIsImV4dFNjaGVtYSIsImJlIiwicmVqZWN0ZWRXaXRoIiwiUmVnRXhwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQUEsUUFBUSxDQUFDLHNCQUFELEVBQXlCLFlBQVk7QUFDM0MsUUFBTUMsYUFBYSxHQUFHLDZCQUFlLFFBQWYsRUFBeUIseUJBQXpCLENBQXRCO0FBQ0EsUUFBTUMsdUJBQXVCLEdBQUcsNkJBQzlCLFFBRDhCLEVBRTlCLG1DQUY4QixDQUFoQztBQUlBLFFBQU1DLFlBQVksR0FBRyw2QkFBZSxRQUFmLEVBQXlCLHdCQUF6QixD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TyxDQUFSO0FBc0NELEtBMUlPLENBQVI7QUE0SUF2QixJQUFBQSxRQUFRLENBQUMsc0NBQUQsRUFBeUMsWUFBWTtBQUMzRFksTUFBQUEsRUFBRSxDQUFDLGtEQUFELEVBQXFELGtCQUFrQjtBQUN2RSxjQUFNLGdDQUFlUixxQkFBZixFQUFzQ1UsTUFBdEMsQ0FBNkMrQixFQUE3QyxDQUFnREMsWUFBaEQsQ0FDSixJQUFJQyxNQUFKLENBQVksR0FBRTNDLHFCQUFzQixhQUFwQyxDQURJLENBQU47QUFHRCxPQUpDLENBQUY7QUFLRCxLQU5PLENBQVI7QUFPRCxHQW5OTyxDQUFSO0FBb05ELENBN1BPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcblxuaW1wb3J0IHsgcmVhZENvbmZpZ0ZpbGUsIG5vcm1hbGl6ZUNvbmZpZyB9IGZyb20gJy4uL2xpYi9jb25maWctZmlsZSc7XG5pbXBvcnQgeyBmaW5hbGl6ZVNjaGVtYSwgcmVnaXN0ZXJTY2hlbWEsIHJlc2V0U2NoZW1hIH0gZnJvbSAnLi4vbGliL3NjaGVtYS9zY2hlbWEnO1xuaW1wb3J0IGV4dFNjaGVtYSBmcm9tICcuL2ZpeHR1cmVzL2RyaXZlci5zY2hlbWEuanMnO1xuaW1wb3J0IHsgcmVzb2x2ZUZpeHR1cmUgfSBmcm9tICcuL2hlbHBlcnMnO1xuXG5kZXNjcmliZSgnY29uZmlnIGZpbGUgYmVoYXZpb3InLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IEdPT0RfRklMRVBBVEggPSByZXNvbHZlRml4dHVyZSgnY29uZmlnJywgJ2FwcGl1bS5jb25maWcuZ29vZC5qc29uJyk7XG4gIGNvbnN0IEJBRF9OT0RFQ09ORklHX0ZJTEVQQVRIID0gcmVzb2x2ZUZpeHR1cmUoXG4gICAgJ2NvbmZpZycsXG4gICAgJ2FwcGl1bS5jb25maWcuYmFkLW5vZGVjb25maWcuanNvbicsXG4gICk7XG4gIGNvbnN0IEJBRF9GSUxFUEFUSCA9IHJlc29sdmVGaXh0dXJlKCdjb25maWcnLCAnYXBwaXVtLmNvbmZpZy5iYWQuanNvbicpO1xuICBjb25zdCBJTlZBTElEX0pTT05fRklMRVBBVEggPSByZXNvbHZlRml4dHVyZShcbiAgICAnY29uZmlnJyxcbiAgICAnYXBwaXVtLmNvbmZpZy5pbnZhbGlkLmpzb24nLFxuICApO1xuICBjb25zdCBTRUNVUklUWV9BUlJBWV9GSUxFUEFUSCA9IHJlc29sdmVGaXh0dXJlKFxuICAgICdjb25maWcnLFxuICAgICdhcHBpdW0uY29uZmlnLnNlY3VyaXR5LWFycmF5Lmpzb24nLFxuICApO1xuICBjb25zdCBTRUNVUklUWV9ERUxJTUlURURfRklMRVBBVEggPSByZXNvbHZlRml4dHVyZShcbiAgICAnY29uZmlnJyxcbiAgICAnYXBwaXVtLmNvbmZpZy5zZWN1cml0eS1kZWxpbWl0ZWQuanNvbicsXG4gICk7XG4gIGNvbnN0IFNFQ1VSSVRZX1BBVEhfRklMRVBBVEggPSByZXNvbHZlRml4dHVyZShcbiAgICAnY29uZmlnJyxcbiAgICAnYXBwaXVtLmNvbmZpZy5zZWN1cml0eS1wYXRoLmpzb24nLFxuICApO1xuICBjb25zdCBVTktOT1dOX1BST1BTX0ZJTEVQQVRIID0gcmVzb2x2ZUZpeHR1cmUoXG4gICAgJ2NvbmZpZycsXG4gICAgJ2FwcGl1bS5jb25maWcuZXh0LXVua25vd24tcHJvcHMuanNvbicsXG4gICk7XG4gIGNvbnN0IEVYVF9QUk9QU19GSUxFUEFUSCA9IHJlc29sdmVGaXh0dXJlKFxuICAgICdjb25maWcnLFxuICAgICdhcHBpdW0uY29uZmlnLmV4dC1nb29kLmpzb24nLFxuICApO1xuXG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIGZpbmFsaXplU2NoZW1hKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgcmVzZXRTY2hlbWEoKTtcbiAgfSk7XG5cblxuICBkZXNjcmliZSgnd2hlbiBwcm92aWRlZCBhIHBhdGggdG8gYSBjb25maWcgZmlsZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkZXNjcmliZSgnd2hlbiB0aGUgY29uZmlnIGZpbGUgaXMgdmFsaWQgcGVyIHRoZSBzY2hlbWEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBhIHZhbGlkIGNvbmZpZyBvYmplY3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlYWRDb25maWdGaWxlKEdPT0RfRklMRVBBVEgpO1xuICAgICAgICByZXN1bHQuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAgIGNvbmZpZzogcmVxdWlyZShHT09EX0ZJTEVQQVRIKSxcbiAgICAgICAgICBmaWxlcGF0aDogR09PRF9GSUxFUEFUSCxcbiAgICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnc2VydmVyLm5vZGVjb25maWcgYmVoYXZpb3InLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlc2NyaWJlKCd3aGVuIGEgc3RyaW5nJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVycm9ycycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlYWRDb25maWdGaWxlKEJBRF9OT0RFQ09ORklHX0ZJTEVQQVRIKTtcbiAgICAgICAgICAgIHJlc3VsdC5zaG91bGQuaGF2ZS5uZXN0ZWQucHJvcGVydHkoXG4gICAgICAgICAgICAgICdlcnJvcnNbMF0uaW5zdGFuY2VQYXRoJyxcbiAgICAgICAgICAgICAgJy9zZXJ2ZXIvbm9kZWNvbmZpZycsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnd2hlbiBhbiBvYmplY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSB2YWxpZCBjb25maWcgb2JqZWN0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoR09PRF9GSUxFUEFUSCk7XG4gICAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUucHJvcGVydHkoJ2Vycm9ycycpLnRoYXQuaXMuZW1wdHk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdzZXJ2ZXIuYWxsb3ctaW5zZWN1cmUgYmVoYXZpb3InLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlc2NyaWJlKCd3aGVuIGEgc3RyaW5nIHBhdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3JzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoU0VDVVJJVFlfUEFUSF9GSUxFUEFUSCk7XG4gICAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUubmVzdGVkLnByb3BlcnR5KFxuICAgICAgICAgICAgICAnZXJyb3JzWzBdLmluc3RhbmNlUGF0aCcsXG4gICAgICAgICAgICAgICcvc2VydmVyL2FsbG93LWluc2VjdXJlJyxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd3aGVuIGEgY29tbWEtZGVsaW1pdGVkIHN0cmluZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlcnJvcnMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZShTRUNVUklUWV9ERUxJTUlURURfRklMRVBBVEgpO1xuICAgICAgICAgICAgcmVzdWx0LnNob3VsZC5oYXZlLm5lc3RlZC5wcm9wZXJ0eShcbiAgICAgICAgICAgICAgJ2Vycm9yc1swXS5pbnN0YW5jZVBhdGgnLFxuICAgICAgICAgICAgICAnL3NlcnZlci9hbGxvdy1pbnNlY3VyZScsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnd2hlbiBhbiBhcnJheScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhIHZhbGlkIGNvbmZpZyBvYmplY3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZShTRUNVUklUWV9BUlJBWV9GSUxFUEFUSCk7XG4gICAgICAgICAgICByZXN1bHQuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAgICAgICBjb25maWc6IHJlcXVpcmUoU0VDVVJJVFlfQVJSQVlfRklMRVBBVEgpLFxuICAgICAgICAgICAgICBmaWxlcGF0aDogU0VDVVJJVFlfQVJSQVlfRklMRVBBVEgsXG4gICAgICAgICAgICAgIGVycm9yczogW10sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3aGVuIHRoZSBjb25maWcgZmlsZSBpcyBpbnZhbGlkIHBlciB0aGUgc2NoZW1hJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGVzY3JpYmUoJ3dpdGhvdXQgZXh0ZW5zaW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgZXJyb3JzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlYWRDb25maWdGaWxlKEJBRF9GSUxFUEFUSCk7XG4gICAgICAgICAgcmVzdWx0LnNob3VsZC5oYXZlLmRlZXAucHJvcGVydHkoJ2NvbmZpZycsIG5vcm1hbGl6ZUNvbmZpZyhyZXF1aXJlKEJBRF9GSUxFUEFUSCkpKTtcbiAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUucHJvcGVydHkoJ2ZpbGVwYXRoJywgQkFEX0ZJTEVQQVRIKTtcbiAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUuZGVlcC5wcm9wZXJ0eSgnZXJyb3JzJykudGhhdC5jb250YWlucy5tZW1iZXJzKFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaW5zdGFuY2VQYXRoOiAnJyxcbiAgICAgICAgICAgICAgc2NoZW1hUGF0aDogJyMvYWRkaXRpb25hbFByb3BlcnRpZXMnLFxuICAgICAgICAgICAgICBrZXl3b3JkOiAnYWRkaXRpb25hbFByb3BlcnRpZXMnLFxuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsUHJvcGVydHk6ICdhcHBpdW0taG9tZScsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IE5PVCBoYXZlIGFkZGl0aW9uYWwgcHJvcGVydGllcycsXG4gICAgICAgICAgICAgIGlzSWRlbnRpZmllckxvY2F0aW9uOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaW5zdGFuY2VQYXRoOiAnL3NlcnZlci9hbGxvdy1jb3JzJyxcbiAgICAgICAgICAgICAgc2NoZW1hUGF0aDogJyMvcHJvcGVydGllcy9zZXJ2ZXIvcHJvcGVydGllcy9hbGxvdy1jb3JzL3R5cGUnLFxuICAgICAgICAgICAgICBrZXl3b3JkOiAndHlwZScsXG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ211c3QgYmUgYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvc2VydmVyL2FsbG93LWluc2VjdXJlJyxcbiAgICAgICAgICAgICAgc2NoZW1hUGF0aDogJyMvcHJvcGVydGllcy9zZXJ2ZXIvcHJvcGVydGllcy9hbGxvdy1pbnNlY3VyZS90eXBlJyxcbiAgICAgICAgICAgICAga2V5d29yZDogJ3R5cGUnLFxuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IGJlIGFycmF5JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGluc3RhbmNlUGF0aDogJy9zZXJ2ZXIvY2FsbGJhY2stcG9ydCcsXG4gICAgICAgICAgICAgIHNjaGVtYVBhdGg6XG4gICAgICAgICAgICAgICAgJyMvcHJvcGVydGllcy9zZXJ2ZXIvcHJvcGVydGllcy9jYWxsYmFjay1wb3J0L21heGltdW0nLFxuICAgICAgICAgICAgICBrZXl3b3JkOiAnbWF4aW11bScsXG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIGNvbXBhcmlzb246ICc8PScsXG4gICAgICAgICAgICAgICAgbGltaXQ6IDY1NTM1LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnbXVzdCBiZSA8PSA2NTUzNScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvc2VydmVyL2xvZy1sZXZlbCcsXG4gICAgICAgICAgICAgIHNjaGVtYVBhdGg6ICcjL3Byb3BlcnRpZXMvc2VydmVyL3Byb3BlcnRpZXMvbG9nLWxldmVsL2VudW0nLFxuICAgICAgICAgICAgICBrZXl3b3JkOiAnZW51bScsXG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIGFsbG93ZWRWYWx1ZXM6IFtcbiAgICAgICAgICAgICAgICAgICdpbmZvJyxcbiAgICAgICAgICAgICAgICAgICdpbmZvOmRlYnVnJyxcbiAgICAgICAgICAgICAgICAgICdpbmZvOmluZm8nLFxuICAgICAgICAgICAgICAgICAgJ2luZm86d2FybicsXG4gICAgICAgICAgICAgICAgICAnaW5mbzplcnJvcicsXG4gICAgICAgICAgICAgICAgICAnd2FybicsXG4gICAgICAgICAgICAgICAgICAnd2FybjpkZWJ1ZycsXG4gICAgICAgICAgICAgICAgICAnd2FybjppbmZvJyxcbiAgICAgICAgICAgICAgICAgICd3YXJuOndhcm4nLFxuICAgICAgICAgICAgICAgICAgJ3dhcm46ZXJyb3InLFxuICAgICAgICAgICAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICdlcnJvcjpkZWJ1ZycsXG4gICAgICAgICAgICAgICAgICAnZXJyb3I6aW5mbycsXG4gICAgICAgICAgICAgICAgICAnZXJyb3I6d2FybicsXG4gICAgICAgICAgICAgICAgICAnZXJyb3I6ZXJyb3InLFxuICAgICAgICAgICAgICAgICAgJ2RlYnVnJyxcbiAgICAgICAgICAgICAgICAgICdkZWJ1ZzpkZWJ1ZycsXG4gICAgICAgICAgICAgICAgICAnZGVidWc6aW5mbycsXG4gICAgICAgICAgICAgICAgICAnZGVidWc6d2FybicsXG4gICAgICAgICAgICAgICAgICAnZGVidWc6ZXJyb3InLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IGJlIGVxdWFsIHRvIG9uZSBvZiB0aGUgYWxsb3dlZCB2YWx1ZXMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaW5zdGFuY2VQYXRoOiAnL3NlcnZlci9sb2ctbm8tY29sb3JzJyxcbiAgICAgICAgICAgICAgc2NoZW1hUGF0aDogJyMvcHJvcGVydGllcy9zZXJ2ZXIvcHJvcGVydGllcy9sb2ctbm8tY29sb3JzL3R5cGUnLFxuICAgICAgICAgICAgICBrZXl3b3JkOiAndHlwZScsXG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ211c3QgYmUgYm9vbGVhbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvc2VydmVyL3BvcnQnLFxuICAgICAgICAgICAgICBzY2hlbWFQYXRoOiAnIy9wcm9wZXJ0aWVzL3NlcnZlci9wcm9wZXJ0aWVzL3BvcnQvdHlwZScsXG4gICAgICAgICAgICAgIGtleXdvcmQ6ICd0eXBlJyxcbiAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2ludGVnZXInLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnbXVzdCBiZSBpbnRlZ2VyJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSkuYW5kLmxlbmd0aE9mKDcpO1xuXG4gICAgICAgICAgcmVzdWx0LnNob3VsZC5oYXZlLnByb3BlcnR5KCdyZWFzb24nKS50aGF0LmlzLmEuc3RyaW5nO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnd2l0aCBleHRlbnNpb25zJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAvKiogQHR5cGUge2ltcG9ydCgnLi4vbGliL2NvbmZpZy1maWxlJykuUmVhZENvbmZpZ0ZpbGVSZXN1bHR9ICovXG4gICAgICAgIGxldCByZXN1bHQ7XG5cbiAgICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVzZXRTY2hlbWEoKTtcbiAgICAgICAgICByZWdpc3RlclNjaGVtYSgnZHJpdmVyJywgJ2Zha2UnLCBleHRTY2hlbWEpO1xuICAgICAgICAgIGZpbmFsaXplU2NoZW1hKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd3aGVuIHByb3ZpZGVkIGEgY29uZmlnIGZpbGUgd2l0aCB1bmtub3duIHByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZShVTktOT1dOX1BST1BTX0ZJTEVQQVRIKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyBlcnJvcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUuZGVlcC5wcm9wZXJ0eSgnZXJyb3JzJywgW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2VQYXRoOiAnL3NlcnZlci9kcml2ZXIvZmFrZScsXG4gICAgICAgICAgICAgICAgc2NoZW1hUGF0aDpcbiAgICAgICAgICAgICAgICAgICdkcml2ZXItZmFrZS5qc29uL2FkZGl0aW9uYWxQcm9wZXJ0aWVzJyxcbiAgICAgICAgICAgICAgICBrZXl3b3JkOiAnYWRkaXRpb25hbFByb3BlcnRpZXMnLFxuICAgICAgICAgICAgICAgIHBhcmFtczoge2FkZGl0aW9uYWxQcm9wZXJ0eTogJ2J1YmInfSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnbXVzdCBOT1QgaGF2ZSBhZGRpdGlvbmFsIHByb3BlcnRpZXMnLFxuICAgICAgICAgICAgICAgIGlzSWRlbnRpZmllckxvY2F0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCd3aGVuIHByb3ZpZGVkIGEgY29uZmlnIGZpbGUgd2l0aCB2YWxpZCBwcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoRVhUX1BST1BTX0ZJTEVQQVRIKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyBubyBlcnJvcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXN1bHQuc2hvdWxkLmhhdmUuZGVlcC5wcm9wZXJ0eSgnZXJyb3JzJywgW10pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3doZW4gdGhlIGNvbmZpZyBmaWxlIGlzIGludmFsaWQgSlNPTicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggYSB1c2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2UnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGF3YWl0IHJlYWRDb25maWdGaWxlKElOVkFMSURfSlNPTl9GSUxFUEFUSCkuc2hvdWxkLmJlLnJlamVjdGVkV2l0aChcbiAgICAgICAgICBuZXcgUmVnRXhwKGAke0lOVkFMSURfSlNPTl9GSUxFUEFUSH0gaXMgaW52YWxpZGApLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwiZmlsZSI6InRlc3QvY29uZmlnLWZpbGUtZTJlLXNwZWNzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
