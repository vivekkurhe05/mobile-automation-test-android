"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _fs = _interopRequireDefault(require("fs"));

var _sinon = _interopRequireDefault(require("sinon"));

var _yaml = _interopRequireDefault(require("yaml"));

var schema = _interopRequireWildcard(require("../lib/schema/schema"));

var _helpers = require("./helpers");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const expect = chai.expect;
describe('config-file', function () {
  const GOOD_YAML_CONFIG_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.good.yaml');
  const GOOD_JSON_CONFIG_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.good.json');
  const GOOD_JS_CONFIG_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.good.js');

  const GOOD_YAML_CONFIG = _yaml.default.parse(_fs.default.readFileSync(GOOD_YAML_CONFIG_FILEPATH, 'utf8'));

  const GOOD_JSON_CONFIG = require(GOOD_JSON_CONFIG_FILEPATH);

  const BAD_JSON_CONFIG_FILEPATH = (0, _helpers.resolveFixture)('config', 'appium.config.bad.json');

  const BAD_JSON_CONFIG = require(BAD_JSON_CONFIG_FILEPATH);

  let sandbox;
  let readConfigFile;
  let lc;
  let configFileModule;
  let mocks;
  before(function () {
    schema.finalizeSchema();
  });
  beforeEach(function () {
    sandbox = _sinon.default.createSandbox();
    const load = sandbox.stub().resolves({
      config: GOOD_JSON_CONFIG,
      filepath: GOOD_JSON_CONFIG_FILEPATH
    });
    load.withArgs(GOOD_YAML_CONFIG_FILEPATH).resolves({
      config: GOOD_YAML_CONFIG,
      filepath: GOOD_YAML_CONFIG_FILEPATH
    });
    load.withArgs(BAD_JSON_CONFIG_FILEPATH).resolves({
      config: BAD_JSON_CONFIG,
      filepath: BAD_JSON_CONFIG_FILEPATH
    });
    const search = sandbox.stub().resolves({
      config: GOOD_JSON_CONFIG,
      filepath: GOOD_JSON_CONFIG_FILEPATH
    });
    lc = {
      load,
      search
    };
    mocks = {
      lilconfig: {
        lilconfig: sandbox.stub().returns(lc)
      },
      '@sidvind/better-ajv-errors': sandbox.stub().returns('')
    };
    configFileModule = _helpers.rewiremock.proxy(() => require('../lib/config-file'), mocks);
    readConfigFile = configFileModule.readConfigFile;
    sandbox.spy(schema, 'validate');
  });
  afterEach(function () {
    sandbox.restore();
  });
  describe('readConfigFile()', function () {
    let result;
    it('should support yaml', async function () {
      const {
        config
      } = await readConfigFile(GOOD_YAML_CONFIG_FILEPATH);
      expect(config).to.eql(GOOD_JSON_CONFIG);
      expect(schema.validate).to.have.been.calledOnce;
    });
    it('should support json', async function () {
      const {
        config
      } = await readConfigFile(GOOD_JSON_CONFIG_FILEPATH);
      expect(config).to.eql(GOOD_JSON_CONFIG);
      expect(schema.validate).to.have.been.calledOnce;
    });
    it('should support js', async function () {
      const {
        config
      } = await readConfigFile(GOOD_JS_CONFIG_FILEPATH);
      expect(config).to.eql(GOOD_JSON_CONFIG);
      expect(schema.validate).to.have.been.calledOnce;
    });
    describe('when no filepath provided', function () {
      beforeEach(async function () {
        result = await readConfigFile();
      });
      it('should search for a config file', function () {
        expect(lc.search).to.have.been.calledOnce;
        expect(schema.validate).to.have.been.calledOnce;
      });
      it('should not try to load a config file directly', function () {
        expect(lc.load).to.not.have.been.called;
      });
      describe('when no config file is found', function () {
        beforeEach(async function () {
          lc.search.resolves();
          schema.validate.resetHistory();
          result = await readConfigFile();
        });
        it('should resolve with an empty object', function () {
          expect(result).to.be.an('object').that.is.empty;
          expect(schema.validate).not.to.have.been.called;
        });
      });
      describe('when a config file is found', function () {
        describe('when the config file is empty', function () {
          beforeEach(async function () {
            lc.search.resolves({
              isEmpty: true,
              filepath: '/path/to/file.json',
              config: {}
            });
            result = await readConfigFile();
          });
          it('should resolve with an object with an `isEmpty` property', function () {
            expect(result).to.have.property('isEmpty', true);
          });
        });
        describe('when the config file is not empty', function () {
          it('should validate the config against a schema', function () {
            expect(schema.validate).to.have.been.calledOnceWith(GOOD_JSON_CONFIG);
          });
          describe('when the config file is valid', function () {
            beforeEach(async function () {
              result = await readConfigFile();
            });
            it('should resolve with an object having `config` property and empty array of errors', function () {
              expect(result).to.deep.equal({
                config: GOOD_JSON_CONFIG,
                errors: [],
                filepath: GOOD_JSON_CONFIG_FILEPATH
              });
            });
          });
          describe('when the config file is invalid', function () {
            beforeEach(function () {
              lc.search.resolves({
                config: {
                  foo: 'bar'
                },
                filepath: '/path/to/file.json'
              });
            });
            beforeEach(async function () {
              result = await readConfigFile();
            });
            it('should resolve with an object having a nonempty array of errors', function () {
              expect(result).to.have.property('errors').that.is.not.empty;
            });
          });
        });
      });
    });
    describe('when filepath provided', function () {
      beforeEach(async function () {
        result = await readConfigFile('appium.json');
      });
      it('should not attempt to find a config file', function () {
        expect(lc.search).to.not.have.been.called;
      });
      it('should try to load a config file directly', function () {
        expect(lc.load).to.have.been.calledOnce;
      });
      describe('when no config file exists at path', function () {
        beforeEach(function () {
          lc.load.rejects(Object.assign(new Error(), {
            code: 'ENOENT'
          }));
        });
        it('should reject with user-friendly message', async function () {
          await expect(readConfigFile('appium.json')).to.be.rejectedWith(/not found at user-provided path/);
        });
      });
      describe('when the config file is invalid JSON', function () {
        beforeEach(function () {
          lc.load.rejects(new SyntaxError());
        });
        it('should reject with user-friendly message', async function () {
          await expect(readConfigFile('appium.json')).to.be.rejectedWith(/Config file at user-provided path appium.json is invalid/);
        });
      });
      describe('when something else is wrong with loading the config file', function () {
        beforeEach(function () {
          lc.load.rejects(new Error('guru meditation'));
        });
        it('should pass error through', async function () {
          await expect(readConfigFile('appium.json')).to.be.rejectedWith(/guru meditation/);
        });
      });
      describe('when a config file is found', function () {
        describe('when the config file is empty', function () {
          beforeEach(async function () {
            lc.search.resolves({
              isEmpty: true,
              filepath: '/path/to/file.json',
              config: {}
            });
            result = await readConfigFile();
          });
          it('should resolve with an object with an `isEmpty` property', function () {
            expect(result).to.have.property('isEmpty', true);
          });
        });
        describe('when the config file is not empty', function () {
          it('should validate the config against a schema', function () {
            expect(schema.validate).to.have.been.calledOnceWith(GOOD_JSON_CONFIG);
          });
          describe('when the config file is valid', function () {
            beforeEach(async function () {
              result = await readConfigFile();
            });
            it('should resolve with an object having `config` property and empty array of errors', function () {
              expect(result).to.deep.equal({
                errors: [],
                config: GOOD_JSON_CONFIG,
                filepath: GOOD_JSON_CONFIG_FILEPATH
              });
            });
          });
          describe('when the config file is invalid', function () {
            beforeEach(async function () {
              result = await readConfigFile(BAD_JSON_CONFIG_FILEPATH);
            });
            it('should resolve with an object having a nonempty array of errors', function () {
              expect(result).to.have.property('errors').that.is.not.empty;
            });
          });
        });
      });
    });
  });
  describe('formatErrors()', function () {
    describe('when provided `errors` as an empty array', function () {
      it('should throw', function () {
        expect(() => configFileModule.formatErrors([])).to.throw(TypeError, 'Array of errors must be non-empty');
      });
    });
    describe('when provided `errors` as `undefined`', function () {
      it('should throw', function () {
        expect(() => configFileModule.formatErrors()).to.throw(TypeError, 'Array of errors must be non-empty');
      });
    });
    describe('when provided `errors` as a non-empty array', function () {
      it('should return a string', function () {
        expect(configFileModule.formatErrors([{}])).to.be.a('string');
      });
    });
    describe('when `opts.json` is a string', function () {
      it('should call `betterAjvErrors()` with option `json: opts.json`', function () {
        configFileModule.formatErrors([{}], {}, {
          json: '{"foo": "bar"}'
        });
        expect(mocks['@sidvind/better-ajv-errors']).to.have.been.calledWith(schema.getSchema(), {}, [{}], {
          format: 'cli',
          json: '{"foo": "bar"}'
        });
      });
    });
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvY29uZmlnLWZpbGUtc3BlY3MuanMiXSwibmFtZXMiOlsiZXhwZWN0IiwiY2hhaSIsImRlc2NyaWJlIiwiR09PRF9ZQU1MX0NPTkZJR19GSUxFUEFUSCIsIkdPT0RfSlNPTl9DT05GSUdfRklMRVBBVEgiLCJHT09EX0pTX0NPTkZJR19GSUxFUEFUSCIsIkdPT0RfWUFNTF9DT05GSUciLCJZQU1MIiwicGFyc2UiLCJmcyIsInJlYWRGaWxlU3luYyIsIkdPT0RfSlNPTl9DT05GSUciLCJyZXF1aXJlIiwiQkFEX0pTT05fQ09ORklHX0ZJTEVQQVRIIiwiQkFEX0pTT05fQ09ORklHIiwic2FuZGJveCIsInJlYWRDb25maWdGaWxlIiwibGMiLCJjb25maWdGaWxlTW9kdWxlIiwibW9ja3MiLCJiZWZvcmUiLCJzY2hlbWEiLCJmaW5hbGl6ZVNjaGVtYSIsImJlZm9yZUVhY2giLCJzaW5vbiIsImNyZWF0ZVNhbmRib3giLCJsb2FkIiwic3R1YiIsInJlc29sdmVzIiwiY29uZmlnIiwiZmlsZXBhdGgiLCJ3aXRoQXJncyIsInNlYXJjaCIsImxpbGNvbmZpZyIsInJldHVybnMiLCJyZXdpcmVtb2NrIiwicHJveHkiLCJzcHkiLCJhZnRlckVhY2giLCJyZXN0b3JlIiwicmVzdWx0IiwiaXQiLCJ0byIsImVxbCIsInZhbGlkYXRlIiwiaGF2ZSIsImJlZW4iLCJjYWxsZWRPbmNlIiwibm90IiwiY2FsbGVkIiwicmVzZXRIaXN0b3J5IiwiYmUiLCJhbiIsInRoYXQiLCJpcyIsImVtcHR5IiwiaXNFbXB0eSIsInByb3BlcnR5IiwiY2FsbGVkT25jZVdpdGgiLCJkZWVwIiwiZXF1YWwiLCJlcnJvcnMiLCJmb28iLCJyZWplY3RzIiwiT2JqZWN0IiwiYXNzaWduIiwiRXJyb3IiLCJjb2RlIiwicmVqZWN0ZWRXaXRoIiwiU3ludGF4RXJyb3IiLCJmb3JtYXRFcnJvcnMiLCJ0aHJvdyIsIlR5cGVFcnJvciIsImEiLCJqc29uIiwiY2FsbGVkV2l0aCIsImdldFNjaGVtYSIs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QUFBQSxNQUFNLENBQUNrQixnQkFBZ0IsQ0FBQ29ELFlBQWpCLENBQThCLENBQUMsRUFBRCxDQUE5QixDQUFELENBQU4sQ0FBNEM1QixFQUE1QyxDQUErQ1MsRUFBL0MsQ0FBa0RzQixDQUFsRCxDQUFvRCxRQUFwRDtBQUNELE9BSEMsQ0FBRjtBQUlELEtBTE8sQ0FBUjtBQU9BdkUsSUFBQUEsUUFBUSxDQUFDLDhCQUFELEVBQWlDLFlBQVk7QUFDbkR1QyxNQUFBQSxFQUFFLENBQUMsK0RBQUQsRUFBa0UsWUFBWTtBQUU5RXZCLFFBQUFBLGdCQUFnQixDQUFDb0QsWUFBakIsQ0FBOEIsQ0FBQyxFQUFELENBQTlCLEVBQW9DLEVBQXBDLEVBQXdDO0FBQUNJLFVBQUFBLElBQUksRUFBRTtBQUFQLFNBQXhDO0FBQ0ExRSxRQUFBQSxNQUFNLENBQUNtQixLQUFLLENBQUMsNEJBQUQsQ0FBTixDQUFOLENBQTRDdUIsRUFBNUMsQ0FBK0NHLElBQS9DLENBQW9EQyxJQUFwRCxDQUF5RDZCLFVBQXpELENBQ0V0RCxNQUFNLENBQUN1RCxTQUFQLEVBREYsRUFFRSxFQUZGLEVBR0UsQ0FBQyxFQUFELENBSEYsRUFJRTtBQUFDQyxVQUFBQSxNQUFNLEVBQUUsS0FBVDtBQUFnQkgsVUFBQUEsSUFBSSxFQUFFO0FBQXRCLFNBSkY7QUFNRCxPQVRDLENBQUY7QUFVRCxLQVhPLENBQVI7QUFZRCxHQXZDTyxDQUFSO0FBd0NELENBbldPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcblxuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgWUFNTCBmcm9tICd5YW1sJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICcuLi9saWIvc2NoZW1hL3NjaGVtYSc7XG5pbXBvcnQgeyByZXNvbHZlRml4dHVyZSwgcmV3aXJlbW9jayB9IGZyb20gJy4vaGVscGVycyc7XG5cbmNvbnN0IGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuXG5kZXNjcmliZSgnY29uZmlnLWZpbGUnLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IEdPT0RfWUFNTF9DT05GSUdfRklMRVBBVEggPSByZXNvbHZlRml4dHVyZShcbiAgICAnY29uZmlnJyxcbiAgICAnYXBwaXVtLmNvbmZpZy5nb29kLnlhbWwnLFxuICApO1xuICBjb25zdCBHT09EX0pTT05fQ09ORklHX0ZJTEVQQVRIID0gcmVzb2x2ZUZpeHR1cmUoXG4gICAgJ2NvbmZpZycsXG4gICAgJ2FwcGl1bS5jb25maWcuZ29vZC5qc29uJyxcbiAgKTtcbiAgY29uc3QgR09PRF9KU19DT05GSUdfRklMRVBBVEggPSByZXNvbHZlRml4dHVyZSgnY29uZmlnJywgJ2FwcGl1bS5jb25maWcuZ29vZC5qcycpO1xuICBjb25zdCBHT09EX1lBTUxfQ09ORklHID0gWUFNTC5wYXJzZShcbiAgICBmcy5yZWFkRmlsZVN5bmMoR09PRF9ZQU1MX0NPTkZJR19GSUxFUEFUSCwgJ3V0ZjgnKSxcbiAgKTtcbiAgY29uc3QgR09PRF9KU09OX0NPTkZJRyA9IHJlcXVpcmUoR09PRF9KU09OX0NPTkZJR19GSUxFUEFUSCk7XG4gIGNvbnN0IEJBRF9KU09OX0NPTkZJR19GSUxFUEFUSCA9IHJlc29sdmVGaXh0dXJlKFxuICAgICdjb25maWcnLFxuICAgICdhcHBpdW0uY29uZmlnLmJhZC5qc29uJyxcbiAgKTtcbiAgY29uc3QgQkFEX0pTT05fQ09ORklHID0gcmVxdWlyZShCQURfSlNPTl9DT05GSUdfRklMRVBBVEgpO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7aW1wb3J0KCdzaW5vbicpLlNpbm9uU2FuZGJveH1cbiAgICovXG4gIGxldCBzYW5kYm94O1xuXG4gIC8qKlxuICAgKiBgcmVhZENvbmZpZ0ZpbGUoKWAgZnJvbSBhbiBpc29sYXRlZCBgY29uZmlnLWZpbGVgIG1vZHVsZVxuICAgKiBAdHlwZSB7dHlwZW9mIGltcG9ydCgnLi4vbGliL2NvbmZpZy1maWxlJykucmVhZENvbmZpZ0ZpbGV9XG4gICAqL1xuICBsZXQgcmVhZENvbmZpZ0ZpbGU7XG4gIC8qKlxuICAgKiBNb2NrIGluc3RhbmNlIG9mIGBsaWxjb25maWdgIGNvbnRhaW5pbmcgc3R1YnMgZm9yXG4gICAqIGBsaWxjb25maWcjc2VhcmNoKClgIGFuZCBgbGlsY29uZmlnI2xvYWRgLlxuICAgKiBOb3QgX2FjdHVhbGx5XyBhIGBTaW5vblN0dWJiZWRJbnN0YW5jZWAsIGJ1dCBkdWNrLXR5cGVkLlxuICAgKiBAdHlwZSB7aW1wb3J0KCdzaW5vbicpLlNpbm9uU3R1YmJlZEluc3RhbmNlPFJldHVyblR5cGU8aW1wb3J0KCdsaWxjb25maWcnKS5saWxjb25maWc+Pn1cbiAgICovXG4gIGxldCBsYztcblxuICAvKipcbiAgICogQHR5cGUge3R5cGVvZiBpbXBvcnQoJy4uL2xpYi9jb25maWctZmlsZScpfVxuICAgKi9cbiAgbGV0IGNvbmZpZ0ZpbGVNb2R1bGU7XG5cbiAgbGV0IG1vY2tzO1xuXG4gIGJlZm9yZShmdW5jdGlvbiAoKSB7XG4gICAgLy8gZ2VuZXJhbGx5IGNhbGxlZCB2aWEgdGhlIENMSSBwYXJzZXIsIHRoaXMgbmVlZHMgdG8gYmUgZG9uZSBtYW51YWxseSBpbiB0ZXN0cy5cbiAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIGRvIHRoaXMgYmVmb3JlIF9lYWNoXyB0ZXN0LCBiZWNhdXNlIHdlJ3JlIG5vdCBjaGFuZ2luZyB0aGUgc2NoZW1hLlxuICAgIC8vIGlmIHdlIGRpZCBjaGFuZ2UgdGhlIHNjaGVtYSwgdGhpcyB3b3VsZCBuZWVkIHRvIGJlIGluIGBiZWZvcmVFYWNoKClgIGFuZCBgYWZ0ZXJFYWNoKClgXG4gICAgLy8gd291bGQgbmVlZCB0byBjYWxsIGBzY2hlbWEucmVzZXQoKWAuXG4gICAgc2NoZW1hLmZpbmFsaXplU2NoZW1hKCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KCk7XG5cbiAgICAvLyB3ZSBoYXZlIHRvIG1hbnVhbGx5IHR5cGUgdGhpcyAoYW5kIGBzZWFyY2goKWApIGJlY2F1c2Ugd2UnZCBvbmx5IGdldCB0aGUgcmVhbCB0eXBlXG4gICAgLy8gd2hlbiBzdHViYmluZyBhbiBvYmplY3QgcHJvcDsgZS5nLiwgYHN0dWIobGlsY29uZmlnLCAnbG9hZCcpYFxuICAgIGNvbnN0IGxvYWQgPSAvKiogQHR5cGUge0FzeW5jU2VhcmNoZXJMb2FkU3R1Yn0gKi8gKFxuICAgICAgc2FuZGJveC5zdHViKCkucmVzb2x2ZXMoe1xuICAgICAgICBjb25maWc6IEdPT0RfSlNPTl9DT05GSUcsXG4gICAgICAgIGZpbGVwYXRoOiBHT09EX0pTT05fQ09ORklHX0ZJTEVQQVRILFxuICAgICAgfSlcbiAgICApO1xuICAgIGxvYWQud2l0aEFyZ3MoR09PRF9ZQU1MX0NPTkZJR19GSUxFUEFUSCkucmVzb2x2ZXMoe1xuICAgICAgY29uZmlnOiBHT09EX1lBTUxfQ09ORklHLFxuICAgICAgZmlsZXBhdGg6IEdPT0RfWUFNTF9DT05GSUdfRklMRVBBVEgsXG4gICAgfSk7XG4gICAgbG9hZC53aXRoQXJncyhCQURfSlNPTl9DT05GSUdfRklMRVBBVEgpLnJlc29sdmVzKHtcbiAgICAgIGNvbmZpZzogQkFEX0pTT05fQ09ORklHLFxuICAgICAgZmlsZXBhdGg6IEJBRF9KU09OX0NPTkZJR19GSUxFUEFUSCxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlYXJjaCA9IC8qKiBAdHlwZSB7QXN5bmNTZWFyY2hlckxvYWRTdHVifSAqLyAoXG4gICAgICBzYW5kYm94LnN0dWIoKS5yZXNvbHZlcyh7XG4gICAgICAgIGNvbmZpZzogR09PRF9KU09OX0NPTkZJRyxcbiAgICAgICAgZmlsZXBhdGg6IEdPT0RfSlNPTl9DT05GSUdfRklMRVBBVEgsXG4gICAgICB9KVxuICAgICk7XG5cbiAgICBsYyA9IHtcbiAgICAgIGxvYWQsXG4gICAgICBzZWFyY2gsXG4gICAgfTtcblxuICAgIG1vY2tzID0ge1xuICAgICAgbGlsY29uZmlnOiB7XG4gICAgICAgIGxpbGNvbmZpZzogc2FuZGJveC5zdHViKCkucmV0dXJucyhsYyksXG4gICAgICB9LFxuICAgICAgJ0BzaWR2aW5kL2JldHRlci1hanYtZXJyb3JzJzogc2FuZGJveC5zdHViKCkucmV0dXJucygnJyksXG4gICAgfTtcblxuICAgIC8vIGxvYWRzIHRoZSBgY29uZmlnLWZpbGVgIG1vZHVsZSB1c2luZyB0aGUgbGlsY29uZmlnIG1vY2suXG4gICAgLy8gd2Ugb25seSBtb2NrIGxpbGNvbmZpZyBiZWNhdXNlIGl0J2Qgb3RoZXJ3aXNlIGJlIGEgcGFpbiBpbiB0aGUgcmVhciB0byB0ZXN0XG4gICAgLy8gc2VhcmNoaW5nIGZvciBjb25maWcgZmlsZXMsIGFuZCBpdCBpbmNyZWFzZXMgdGhlIGxpa2VsaWhvb2QgdGhhdCB3ZSdkIGxvYWQgdGhlIHdyb25nIGZpbGUuXG4gICAgY29uZmlnRmlsZU1vZHVsZSA9IHJld2lyZW1vY2sucHJveHkoKCkgPT4gcmVxdWlyZSgnLi4vbGliL2NvbmZpZy1maWxlJyksIG1vY2tzKTtcbiAgICByZWFkQ29uZmlnRmlsZSA9IGNvbmZpZ0ZpbGVNb2R1bGUucmVhZENvbmZpZ0ZpbGU7XG5cbiAgICAvLyBqdXN0IHdhbnQgdG8gYmUgZXh0cmEtc3VyZSBgdmFsaWRhdGUoKWAgaGFwcGVuc1xuICAgIHNhbmRib3guc3B5KHNjaGVtYSwgJ3ZhbGlkYXRlJyk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWFkQ29uZmlnRmlsZSgpJywgZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4uL2xpYi9jb25maWctZmlsZScpLlJlYWRDb25maWdGaWxlUmVzdWx0fVxuICAgICAqL1xuICAgIGxldCByZXN1bHQ7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgeWFtbCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHtjb25maWd9ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoR09PRF9ZQU1MX0NPTkZJR19GSUxFUEFUSCk7XG4gICAgICBleHBlY3QoY29uZmlnKS50by5lcWwoR09PRF9KU09OX0NPTkZJRyk7XG4gICAgICBleHBlY3Qoc2NoZW1hLnZhbGlkYXRlKS50by5oYXZlLmJlZW4uY2FsbGVkT25jZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3VwcG9ydCBqc29uJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3Qge2NvbmZpZ30gPSBhd2FpdCByZWFkQ29uZmlnRmlsZShHT09EX0pTT05fQ09ORklHX0ZJTEVQQVRIKTtcbiAgICAgIGV4cGVjdChjb25maWcpLnRvLmVxbChHT09EX0pTT05fQ09ORklHKTtcbiAgICAgIGV4cGVjdChzY2hlbWEudmFsaWRhdGUpLnRvLmhhdmUuYmVlbi5jYWxsZWRPbmNlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdXBwb3J0IGpzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3Qge2NvbmZpZ30gPSBhd2FpdCByZWFkQ29uZmlnRmlsZShHT09EX0pTX0NPTkZJR19GSUxFUEFUSCk7XG4gICAgICBleHBlY3QoY29uZmlnKS50by5lcWwoR09PRF9KU09OX0NPTkZJRyk7XG4gICAgICBleHBlY3Qoc2NoZW1hLnZhbGlkYXRlKS50by5oYXZlLmJlZW4uY2FsbGVkT25jZTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3aGVuIG5vIGZpbGVwYXRoIHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IHJlYWRDb25maWdGaWxlKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBzZWFyY2ggZm9yIGEgY29uZmlnIGZpbGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGV4cGVjdChsYy5zZWFyY2gpLnRvLmhhdmUuYmVlbi5jYWxsZWRPbmNlO1xuICAgICAgICBleHBlY3Qoc2NoZW1hLnZhbGlkYXRlKS50by5oYXZlLmJlZW4uY2FsbGVkT25jZTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG5vdCB0cnkgdG8gbG9hZCBhIGNvbmZpZyBmaWxlIGRpcmVjdGx5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBlY3QobGMubG9hZCkudG8ubm90LmhhdmUuYmVlbi5jYWxsZWQ7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gbm8gY29uZmlnIGZpbGUgaXMgZm91bmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxjLnNlYXJjaC5yZXNvbHZlcygpO1xuICAgICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCdzaW5vbicpLlNpbm9uU3BpZWRNZW1iZXI8dHlwZW9mIHNjaGVtYS52YWxpZGF0ZT59ICovKHNjaGVtYS52YWxpZGF0ZSkucmVzZXRIaXN0b3J5KCk7XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXNvbHZlIHdpdGggYW4gZW1wdHkgb2JqZWN0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmFuKCdvYmplY3QnKS50aGF0LmlzLmVtcHR5O1xuICAgICAgICAgIGV4cGVjdChzY2hlbWEudmFsaWRhdGUpLm5vdC50by5oYXZlLmJlZW4uY2FsbGVkO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnd2hlbiBhIGNvbmZpZyBmaWxlIGlzIGZvdW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgY29uZmlnIGZpbGUgaXMgZW1wdHknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsYy5zZWFyY2gucmVzb2x2ZXMoe1xuICAgICAgICAgICAgICBpc0VtcHR5OiB0cnVlLFxuICAgICAgICAgICAgICBmaWxlcGF0aDogJy9wYXRoL3RvL2ZpbGUuanNvbicsXG4gICAgICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdzaG91bGQgcmVzb2x2ZSB3aXRoIGFuIG9iamVjdCB3aXRoIGFuIGBpc0VtcHR5YCBwcm9wZXJ0eScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmhhdmUucHJvcGVydHkoJ2lzRW1wdHknLCB0cnVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIGNvbmZpZyBmaWxlIGlzIG5vdCBlbXB0eScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHRoZSBjb25maWcgYWdhaW5zdCBhIHNjaGVtYScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGV4cGVjdChzY2hlbWEudmFsaWRhdGUpLnRvLmhhdmUuYmVlbi5jYWxsZWRPbmNlV2l0aChcbiAgICAgICAgICAgICAgR09PRF9KU09OX0NPTkZJRyxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgY29uZmlnIGZpbGUgaXMgdmFsaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBiZWZvcmVFYWNoKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgcmVhZENvbmZpZ0ZpbGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIHJlc29sdmUgd2l0aCBhbiBvYmplY3QgaGF2aW5nIGBjb25maWdgIHByb3BlcnR5IGFuZCBlbXB0eSBhcnJheSBvZiBlcnJvcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICAgICAgICAgIGNvbmZpZzogR09PRF9KU09OX0NPTkZJRyxcbiAgICAgICAgICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICAgICAgICAgIGZpbGVwYXRoOiBHT09EX0pTT05fQ09ORklHX0ZJTEVQQVRILFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIGNvbmZpZyBmaWxlIGlzIGludmFsaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgbGMuc2VhcmNoLnJlc29sdmVzKHtcbiAgICAgICAgICAgICAgICBjb25maWc6IHtmb286ICdiYXInfSxcbiAgICAgICAgICAgICAgICBmaWxlcGF0aDogJy9wYXRoL3RvL2ZpbGUuanNvbicsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgcmVzb2x2ZSB3aXRoIGFuIG9iamVjdCBoYXZpbmcgYSBub25lbXB0eSBhcnJheSBvZiBlcnJvcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmhhdmUucHJvcGVydHkoJ2Vycm9ycycpLnRoYXQuaXMubm90LmVtcHR5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnd2hlbiBmaWxlcGF0aCBwcm92aWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZSgnYXBwaXVtLmpzb24nKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG5vdCBhdHRlbXB0IHRvIGZpbmQgYSBjb25maWcgZmlsZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZXhwZWN0KGxjLnNlYXJjaCkudG8ubm90LmhhdmUuYmVlbi5jYWxsZWQ7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0cnkgdG8gbG9hZCBhIGNvbmZpZyBmaWxlIGRpcmVjdGx5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBlY3QobGMubG9hZCkudG8uaGF2ZS5iZWVuLmNhbGxlZE9uY2U7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gbm8gY29uZmlnIGZpbGUgZXhpc3RzIGF0IHBhdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxjLmxvYWQucmVqZWN0cyhPYmplY3QuYXNzaWduKG5ldyBFcnJvcigpLCB7Y29kZTogJ0VOT0VOVCd9KSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggdXNlci1mcmllbmRseSBtZXNzYWdlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGF3YWl0IGV4cGVjdChyZWFkQ29uZmlnRmlsZSgnYXBwaXVtLmpzb24nKSkudG8uYmUucmVqZWN0ZWRXaXRoKFxuICAgICAgICAgICAgL25vdCBmb3VuZCBhdCB1c2VyLXByb3ZpZGVkIHBhdGgvLFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCd3aGVuIHRoZSBjb25maWcgZmlsZSBpcyBpbnZhbGlkIEpTT04nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxjLmxvYWQucmVqZWN0cyhuZXcgU3ludGF4RXJyb3IoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggdXNlci1mcmllbmRseSBtZXNzYWdlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGF3YWl0IGV4cGVjdChyZWFkQ29uZmlnRmlsZSgnYXBwaXVtLmpzb24nKSkudG8uYmUucmVqZWN0ZWRXaXRoKFxuICAgICAgICAgICAgL0NvbmZpZyBmaWxlIGF0IHVzZXItcHJvdmlkZWQgcGF0aCBhcHBpdW0uanNvbiBpcyBpbnZhbGlkLyxcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnd2hlbiBzb21ldGhpbmcgZWxzZSBpcyB3cm9uZyB3aXRoIGxvYWRpbmcgdGhlIGNvbmZpZyBmaWxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBsYy5sb2FkLnJlamVjdHMobmV3IEVycm9yKCdndXJ1IG1lZGl0YXRpb24nKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcGFzcyBlcnJvciB0aHJvdWdoJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGF3YWl0IGV4cGVjdChyZWFkQ29uZmlnRmlsZSgnYXBwaXVtLmpzb24nKSkudG8uYmUucmVqZWN0ZWRXaXRoKFxuICAgICAgICAgICAgL2d1cnUgbWVkaXRhdGlvbi8sXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gYSBjb25maWcgZmlsZSBpcyBmb3VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIGNvbmZpZyBmaWxlIGlzIGVtcHR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGMuc2VhcmNoLnJlc29sdmVzKHtcbiAgICAgICAgICAgICAgaXNFbXB0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlsZXBhdGg6ICcvcGF0aC90by9maWxlLmpzb24nLFxuICAgICAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaXQoJ3Nob3VsZCByZXNvbHZlIHdpdGggYW4gb2JqZWN0IHdpdGggYW4gYGlzRW1wdHlgIHByb3BlcnR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG8uaGF2ZS5wcm9wZXJ0eSgnaXNFbXB0eScsIHRydWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgY29uZmlnIGZpbGUgaXMgbm90IGVtcHR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdGhlIGNvbmZpZyBhZ2FpbnN0IGEgc2NoZW1hJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYS52YWxpZGF0ZSkudG8uaGF2ZS5iZWVuLmNhbGxlZE9uY2VXaXRoKFxuICAgICAgICAgICAgICBHT09EX0pTT05fQ09ORklHLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGRlc2NyaWJlKCd3aGVuIHRoZSBjb25maWcgZmlsZSBpcyB2YWxpZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgcmVzb2x2ZSB3aXRoIGFuIG9iamVjdCBoYXZpbmcgYGNvbmZpZ2AgcHJvcGVydHkgYW5kIGVtcHR5IGFycmF5IG9mIGVycm9ycycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG8uZGVlcC5lcXVhbCh7XG4gICAgICAgICAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgICAgICAgICBjb25maWc6IEdPT0RfSlNPTl9DT05GSUcsXG4gICAgICAgICAgICAgICAgZmlsZXBhdGg6IEdPT0RfSlNPTl9DT05GSUdfRklMRVBBVEgsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgY29uZmlnIGZpbGUgaXMgaW52YWxpZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZWFkQ29uZmlnRmlsZShCQURfSlNPTl9DT05GSUdfRklMRVBBVEgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgcmVzb2x2ZSB3aXRoIGFuIG9iamVjdCBoYXZpbmcgYSBub25lbXB0eSBhcnJheSBvZiBlcnJvcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmhhdmUucHJvcGVydHkoJ2Vycm9ycycpLnRoYXQuaXMubm90LmVtcHR5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb3JtYXRFcnJvcnMoKScsIGZ1bmN0aW9uICgpIHtcbiAgICBkZXNjcmliZSgnd2hlbiBwcm92aWRlZCBgZXJyb3JzYCBhcyBhbiBlbXB0eSBhcnJheScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgdGhyb3cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGV4cGVjdCgoKSA9PiBjb25maWdGaWxlTW9kdWxlLmZvcm1hdEVycm9ycyhbXSkpLnRvLnRocm93KFxuICAgICAgICAgIFR5cGVFcnJvcixcbiAgICAgICAgICAnQXJyYXkgb2YgZXJyb3JzIG11c3QgYmUgbm9uLWVtcHR5JyxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3doZW4gcHJvdmlkZWQgYGVycm9yc2AgYXMgYHVuZGVmaW5lZGAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIHRocm93JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGV4cGVjdCgoKSA9PiBjb25maWdGaWxlTW9kdWxlLmZvcm1hdEVycm9ycygpKS50by50aHJvdyhcbiAgICAgICAgICBUeXBlRXJyb3IsXG4gICAgICAgICAgJ0FycmF5IG9mIGVycm9ycyBtdXN0IGJlIG5vbi1lbXB0eScsXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3aGVuIHByb3ZpZGVkIGBlcnJvcnNgIGFzIGEgbm9uLWVtcHR5IGFycmF5JywgZnVuY3Rpb24gKCkge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBzdHJpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgZXhwZWN0KGNvbmZpZ0ZpbGVNb2R1bGUuZm9ybWF0RXJyb3JzKFt7fV0pKS50by5iZS5hKCdzdHJpbmcnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3doZW4gYG9wdHMuanNvbmAgaXMgYSBzdHJpbmcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIGNhbGwgYGJldHRlckFqdkVycm9ycygpYCB3aXRoIG9wdGlvbiBganNvbjogb3B0cy5qc29uYCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBjb25maWdGaWxlTW9kdWxlLmZvcm1hdEVycm9ycyhbe31dLCB7fSwge2pzb246ICd7XCJmb29cIjogXCJiYXJcIn0nfSk7XG4gICAgICAgIGV4cGVjdChtb2Nrc1snQHNpZHZpbmQvYmV0dGVyLWFqdi1lcnJvcnMnXSkudG8uaGF2ZS5iZWVuLmNhbGxlZFdpdGgoXG4gICAgICAgICAgc2NoZW1hLmdldFNjaGVtYSgpLFxuICAgICAgICAgIHt9LFxuICAgICAgICAgIFt7fV0sXG4gICAgICAgICAge2Zvcm1hdDogJ2NsaScsIGpzb246ICd7XCJmb29cIjogXCJiYXJcIn0nfSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG4vLyB0aGUgZm9sbG93aW5nIGFyZSBqdXN0IGFsaWFzZXNcblxuLyoqXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdhanYnKS5FcnJvck9iamVjdH0gRXJyb3JPYmplY3RcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ2FqdicpLlZhbGlkYXRlRnVuY3Rpb259IFZhbGlkYXRlRnVuY3Rpb25cbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ3Npbm9uJykuU2lub25TdHViYmVkTWVtYmVyPFJldHVyblR5cGU8aW1wb3J0KCdsaWxjb25maWcnKS5saWxjb25maWc+Wydsb2FkJ10+fSBBc3luY1NlYXJjaGVyTG9hZFN0dWJcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ3Npbm9uJykuU2lub25TdHViYmVkTWVtYmVyPFJldHVyblR5cGU8aW1wb3J0KCdsaWxjb25maWcnKS5saWxjb25maWc+WydzZWFyY2gnXT59IEFzeW5jU2VhcmNoZXJTZWFyY2hTdHViXG4gKi9cbiJdLCJmaWxlIjoidGVzdC9jb25maWctZmlsZS1zcGVjcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
