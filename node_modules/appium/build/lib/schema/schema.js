"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validate = exports.resetSchema = exports.registerSchema = exports.isFinalized = exports.isAllowedSchemaFileExtension = exports.hasArgSpec = exports.getSchema = exports.getDefaultsForSchema = exports.getDefaultsForExtension = exports.getArgSpec = exports.getAllArgSpecs = exports.flattenSchema = exports.finalizeSchema = exports.SchemaUnsupportedSchemaError = exports.SchemaUnknownSchemaError = exports.SchemaNameConflictError = exports.SchemaFinalizationError = exports.ALLOWED_SCHEMA_EXTENSIONS = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

require("source-map-support/register");

var _ajv = _interopRequireDefault(require("ajv"));

var _ajvFormats = _interopRequireDefault(require("ajv-formats"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _extensionConfig = require("../extension-config");

var _utils = require("../utils");

var _appiumConfigSchema = _interopRequireDefault(require("./appium-config-schema"));

var _argSpec = require("./arg-spec");

var _keywords = require("./keywords");

const ALLOWED_SCHEMA_EXTENSIONS = new Set(['.json', '.js', '.cjs']);
exports.ALLOWED_SCHEMA_EXTENSIONS = ALLOWED_SCHEMA_EXTENSIONS;

class AppiumSchema {
  constructor() {
    (0, _defineProperty2.default)(this, "_argSpecs", new _utils.ReadonlyMap());
    (0, _defineProperty2.default)(this, "_registeredSchemas", {
      [_extensionConfig.DRIVER_TYPE]: new Map(),
      [_extensionConfig.PLUGIN_TYPE]: new Map()
    });
    (0, _defineProperty2.default)(this, "_ajv", void 0);
    (0, _defineProperty2.default)(this, "_finalizedSchemas", null);
    this._ajv = AppiumSchema._instantiateAjv();
  }

  static create() {
    var _AppiumSchema$_instan;

    const instance = (_AppiumSchema$_instan = AppiumSchema._instance) !== null && _AppiumSchema$_instan !== void 0 ? _AppiumSchema$_instan : new AppiumSchema();
    AppiumSchema._instance = instance;

    _lodash.default.bindAll(instance, ['finalize', 'flatten', 'getAllArgSpecs', 'getArgSpec', 'getDefaults', 'getDefaultsForExtension', 'getSchema', 'hasArgSpec', 'isFinalized', 'registerSchema', 'reset', 'validate']);

    return instance;
  }

  hasRegisteredSchema(extType, extName) {
    return this._registeredSchemas[extType].has(extName);
  }

  isFinalized() {
    return Boolean(this._finalizedSchemas);
  }

  getAllArgSpecs() {
    return this._argSpecs;
  }

  finalize() {
    if (this.isFinalized()) {
      return this._finalizedSchemas;
    }

    const ajv = this._ajv;

    const baseSchema = _lodash.default.cloneDeep(_appiumConfigSchema.default);

    const addArgSpecs = (schema, extType, extName) => {
      for (let [propName, propSchema] of Object.entries(schema)) {
        const argSpec = _argSpec.ArgSpec.create(propName, {
          dest: propSchema.appiumCliDest,
          defaultValue: propSchema.default,
          extType,
          extName
        });

        const {
          arg
        } = argSpec;

        this._argSpecs.set(arg, argSpec);
      }
    };

    addArgSpecs(_lodash.default.omit(baseSchema.properties.server.properties, [_extensionConfig.DRIVER_TYPE, _extensionConfig.PLUGIN_TYPE]));
    const finalizedSchemas = {};

    const finalSchema = _lodash.default.reduce(this._registeredSchemas, (baseSchema, extensionSchemas, extType) => {
      extensionSchemas.forEach((schema, extName) => {
        const $ref = _argSpec.ArgSpec.toSchemaBaseRef(extType, extName);

        schema.$id = $ref;
        schema.additionalProperties = false;
        baseSchema.properties.server.properties[extType].properties[extName] = {
          $ref,
          $comment: extName
        };
        ajv.validateSchema(schema, true);
        addArgSpecs(schema.properties, extType, extName);
        ajv.addSchema(schema, $ref);
        finalizedSchemas[$ref] = schema;
      });
      return baseSchema;
    }, baseSchema);

    ajv.addSchema(finalSchema, _argSpec.APPIUM_CONFIG_SCHEMA_ID);
    finalizedSchemas[_argSpec.APPIUM_CONFIG_SCHEMA_ID] = finalSchema;
    ajv.validateSchema(finalSchema, true);
    this._finalizedSchemas = finalizedSchemas;
    return Object.freeze(finalizedSchemas);
  }

  static _instantiateAjv() {
    const ajv = (0, _ajvFormats.default)(new _ajv.default({
      allErrors: true
    }));

    _lodash.default.forEach(_keywords.keywords, keyword => {
      ajv.addKeyword(keyword);
    });

    return ajv;
  }

  reset() {
    for (const schemaId of Object.keys((_this$_finalizedSchem = this._finalizedSchemas) !== null && _this$_finalizedSchem !== void 0 ? _this$_finalizedSchem : {})) {
      var _this$_finalizedSchem;

      this._ajv.removeSchema(schemaId);
    }

    this._argSpecs = new _utils.ReadonlyMap();
    this._registeredSchemas = {
      [_extensionConfig.DRIVER_TYPE]: new Map(),
      [_extensionConfig.PLUGIN_TYPE]: new Map()
    };
    this._finalizedSchemas = null;
    this._ajv = AppiumSchema._instantiateAjv();
  }

  registerSchema(extType, extName, schema) {
    if (!(extType && extName) || _lodash.default.isUndefined(schema)) {
      throw new TypeError('Expected extension type, extension name, and a defined schema');
    }

    if (!AppiumSchema.isSupportedSchemaType(schema)) {
      throw new SchemaUnsupportedSchemaError(schema, extType, extName);
    }

    const normalizedExtName = _lodash.default.kebabCase(extName);

    if (this.hasRegisteredSchema(extType, normalizedExtName)) {
      if (this._registeredSchemas[extType].get(normalizedExtName) === schema) {
        return;
      }

      throw new SchemaNameConflictError(extType, extName);
    }

    this._ajv.validateSchema(schema, true);

    this._registeredSchemas[extType].set(normalizedExtName, schema);
  }

  getArgSpec(name, extType, extName) {
    return this._argSpecs.get(_argSpec.ArgSpec.toArg(name, extType, extName));
  }

  hasArgSpec(name, extType, extName) {
    return this._argSpecs.has(_argSpec.ArgSpec.toArg(name, extType, extName));
  }

  getDefaults(flatten = true) {
    if (!this.isFinalized()) {
      throw new SchemaFinalizationError();
    }

    const reducer = flatten ? (defaults, {
      defaultValue,
      dest
    }) => {
      if (!_lodash.default.isUndefined(defaultValue)) {
        defaults[dest] = defaultValue;
      }

      return defaults;
    } : (defaults, {
      defaultValue,
      dest
    }) => {
      if (!_lodash.default.isUndefined(defaultValue)) {
        _lodash.default.set(defaults, dest, defaultValue);
      }

      return defaults;
    };
    const retval = {};
    return [...this._argSpecs.values()].reduce(reducer, retval);
  }

  getDefaultsForExtension(extType, extName) {
    if (!this.isFinalized()) {
      throw new SchemaFinalizationError();
    }

    const specs = [...this._argSpecs.values()].filter(spec => spec.extType === extType && spec.extName === extName);
    return specs.reduce((defaults, {
      defaultValue,
      rawDest
    }) => {
      if (!_lodash.default.isUndefined(defaultValue)) {
        defaults[rawDest] = defaultValue;
      }

      return defaults;
    }, {});
  }

  flatten() {
    const schema = this.getSchema();
    const stack = [{
      properties: schema.properties,
      prefix: []
    }];
    const flattened = [];

    for (const {
      properties,
      prefix
    } of stack) {
      const pairs = _lodash.default.toPairs(properties);

      for (const [key, value] of pairs) {
        const {
          properties,
          $ref
        } = value;

        if (properties) {
          stack.push({
            properties,
            prefix: key === _argSpec.SERVER_PROP_NAME ? [] : [...prefix, key]
          });
        } else if ($ref) {
          let refSchema;

          try {
            refSchema = this.getSchema($ref);
          } catch (err) {
            throw new SchemaUnknownSchemaError($ref);
          }

          const {
            normalizedExtName
          } = _argSpec.ArgSpec.extensionInfoFromRootSchemaId($ref);

          if (!normalizedExtName) {
            throw new ReferenceError(`Could not determine extension name from schema ID ${$ref}. This is a bug.`);
          }

          stack.push({
            properties: refSchema.properties,
            prefix: [...prefix, key, normalizedExtName]
          });
        } else if (key !== _extensionConfig.DRIVER_TYPE && key !== _extensionConfig.PLUGIN_TYPE) {
          const [extType, extName] = prefix;
          const argSpec = this.getArgSpec(key, extType, extName);

          if (!argSpec) {
            throw new ReferenceError(`Unknown argument with key ${key}, extType ${extType} and extName ${extName}. This is a bug.`);
          }

          flattened.push({
            schema: _lodash.default.cloneDeep(value),
            argSpec
          });
        }
      }
    }

    return flattened;
  }

  getSchema(ref = _argSpec.APPIUM_CONFIG_SCHEMA_ID) {
    return this._getValidator(ref).schema;
  }

  _getValidator(id = _argSpec.APPIUM_CONFIG_SCHEMA_ID) {
    const validator = this._ajv.getSchema(id);

    if (!validator) {
      if (id === _argSpec.APPIUM_CONFIG_SCHEMA_ID) {
        throw new SchemaFinalizationError();
      } else {
        throw new SchemaUnknownSchemaError(id);
      }
    }

    return validator;
  }

  validate(value, ref = _argSpec.APPIUM_CONFIG_SCHEMA_ID) {
    const validator = this._getValidator(ref);

    return !validator(value) && _lodash.default.isArray(validator.errors) ? [...validator.errors] : [];
  }

  static isAllowedSchemaFileExtension(filename) {
    return ALLOWED_SCHEMA_EXTENSIONS.has(_path.default.extname(filename));
  }

  static isSupportedSchemaType(schema) {
    return _lodash.default.isPlainObject(schema) && schema.$async !== true;
  }

}

(0, _defineProperty2.default)(AppiumSchema, "_instance", void 0);

class SchemaFinalizationError extends Error {
  constructor() {
    super('Schema not yet finalized; `finalize()` must be called first.');
    (0, _defineProperty2.default)(this, "code", 'APPIUMERR_SCHEMA_FINALIZATION');
  }

}

exports.SchemaFinalizationError = SchemaFinalizationError;

class SchemaNameConflictError extends Error {
  constructor(extType, extName) {
    super(`Name for ${extType} schema "${extName}" conflicts with an existing schema`);
    (0, _defineProperty2.default)(this, "code", 'APPIUMERR_SCHEMA_NAME_CONFLICT');
    (0, _defineProperty2.default)(this, "data", void 0);
    this.data = {
      extType,
      extName
    };
  }

}

exports.SchemaNameConflictError = SchemaNameConflictError;

class SchemaUnknownSchemaError extends ReferenceError {
  constructor(schemaId) {
    super(`Unknown schema: "${schemaId}"`);
    (0, _defineProperty2.default)(this, "code", 'APPIUMERR_SCHEMA_UNKNOWN_SCHEMA');
    (0, _defineProperty2.default)(this, "data", void 0);
    this.data = {
      schemaId
    };
  }

}

exports.SchemaUnknownSchemaError = SchemaUnknownSchemaError;

class SchemaUnsupportedSchemaError extends TypeError {
  constructor(schema, extType, extName) {
    super((() => {
      let msg = `Unsupported schema from ${extType} "${extName}":`;

      if (_lodash.default.isBoolean(schema)) {
        return `${msg} schema cannot be a boolean`;
      }

      if (_lodash.default.isPlainObject(schema)) {
        if (schema.$async) {
          return `${msg} schema cannot be an async schema`;
        }

        throw new TypeError(`schema IS supported; this error should not be thrown (this is a bug). value of schema: ${JSON.stringify(schema)}`);
      }

      return `${msg} schema must be a plain object without a true "$async" property`;
    })());
    (0, _defineProperty2.default)(this, "code", 'APPIUMERR_SCHEMA_UNSUPPORTED_SCHEMA');
    (0, _defineProperty2.default)(this, "data", void 0);
    this.data = {
      schema,
      extType,
      extName
    };
  }

}

exports.SchemaUnsupportedSchemaError = SchemaUnsupportedSchemaError;
const appiumSchema = AppiumSchema.create();
const {
  registerSchema,
  getAllArgSpecs,
  getArgSpec,
  hasArgSpec,
  isFinalized,
  finalize: finalizeSchema,
  reset: resetSchema,
  validate,
  getSchema,
  flatten: flattenSchema,
  getDefaults: getDefaultsForSchema,
  getDefaultsForExtension
} = appiumSchema;
exports.getDefaultsForExtension = getDefaultsForExtension;
exports.getDefaultsForSchema = getDefaultsForSchema;
exports.flattenSchema = flattenSchema;
exports.getSchema = getSchema;
exports.validate = validate;
exports.resetSchema = resetSchema;
exports.finalizeSchema = finalizeSchema;
exports.isFinalized = isFinalized;
exports.hasArgSpec = hasArgSpec;
exports.getArgSpec = getArgSpec;
exports.getAllArgSpecs = getAllArgSpecs;
exports.registerSchema = registerSchema;
const {
  isAllowedSchemaFileExtension
} = AppiumSchema;
exports.isAllowedSchemaFileExtension = isAllowedSchemaFileExtension;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zY2hlbWEvc2NoZW1hLmpzIl0sIm5hbWVzIjpbIkFMTE9XRURfU0NIRU1BX0VYVEVOU0lPTlMiLCJTZXQiLCJBcHBpdW1TY2hlbWEiLCJjb25zdHJ1Y3RvciIsIlJlYWRvbmx5TWFwIiwiRFJJVkVSX1RZUEUiLCJNYXAiLCJQTFVHSU5fVFlQRSIsIl9hanYiLCJfaW5zdGFudGlhdGVBanYiLCJjcmVhdGUiLCJpbnN0YW5jZSIsIl9pbnN0YW5jZSIsIl8iLCJiaW5kQWxsIiwiaGFzUmVnaXN0ZXJlZFNjaGVtYSIsImV4dFR5cGUiLCJleHROYW1lIiwiX3JlZ2lzdGVyZWRTY2hlbWFzIiwiaGFzIiwiaXNGaW5hbGl6ZWQiLCJCb29sZWFuIiwiX2ZpbmFsaXplZFNjaGVtYXMiLCJnZXRBbGxBcmdTcGVjcyIsIl9hcmdTcGVjcyIsImZpbmFsaXplIiwiYWp2IiwiYmFzZVNjaGVtYSIsImNsb25lRGVlcCIsImFwcGl1bUNvbmZpZ1NjaGVtYSIsImFkZEFyZ1NwZWNzIiwic2NoZW1hIiwicHJvcE5hbWUiLCJwcm9wU2NoZW1hIiwiT2JqZWN0IiwiZW50cmllcyIsImFyZ1NwZWMiLCJBcmdTcGVjIiwiZGVzdCIsImFwcGl1bUNsaURlc3QiLCJkZWZhdWx0VmFsdWUiLCJkZWZhdWx0IiwiYXJnIiwic2V0Iiwib21pdCIsInByb3BlcnRpZXMiLCJzZXJ2ZXIiLCJmaW5hbGl6ZWRTY2hlbWFzIiwiZmluYWxTY2hlbWEiLCJyZWR1Y2UiLCJleHRlbnNpb25TY2hlbWFzIiwiZm9yRWFjaCIsIiRyZWYiLCJ0b1NjaGVtYUJhc2VSZWYiLCIkaWQiLCJhZGRpdGlvbmFsUHJvcGVydGllcyIsIiRjb21tZW50IiwidmFsaWRhdGVTY2hlbWEiLCJhZGRTY2hlbWEiLCJBUFBJVU1fQ09ORklHX1NDSEVNQV9JRCIsImZyZWV6ZSIsIkFqdiIsImFsbEVycm9ycyIsImtleXdvcmRzIiwia2V5d29yZCIsImFkZEtleXdvcmQiLCJyZXNldCIsInNjaGVtYUlkIiwia2V5cyIsInJlbW92ZVNjaGVtYSIsInJlZ2lzdGVyU2NoZW1hIiwiaXNVbmRlZmluZWQiLCJUeXBlRXJyb3IiLCJpc1N1cHBvcnRlZFNjaGVtYVR5cGUiLCJTY2hlbWFVbnN1cHBvcnRlZFNjaGVtYUVycm9yIiwibm9ybWFsaXplZEV4dE5hbWUiLCJrZWJhYkNhc2UiLCJnZXQiLCJTY2hlbWFOYW1lQ29uZmxpY3RFcnJvciIsImdldEFyZ1NwZWMiLCJuYW1lIiwidG9BcmciLCJoYXNBcmdTcGVjIiwiZ2V0RGVmYXVsdHMiLCJmbGF0dGVuIiwiU2NoZW1hRmluYWxpemF0aW9uRXJyb3IiLCJyZWR1Y2VyIiwiZGVmYXVsdHMiLCJyZXR2YWwiLCJ2YWx1ZXMiLCJnZXREZWZhdWx0c0ZvckV4dGVuc2lvbiIsInNwZWNzIiwiZmlsdGVyIiwic3BlYyIsInJhd0Rlc3QiLCJnZXRTY2hlbWEiLCJzdGFjayIsInByZWZpeCIsImZsYXR0ZW5lZCIsInBhaXJzIiwidG9QYWlycyIsImtleSIsInZhbHVlIiwicHVzaCIsIlNFUlZFUl9QUk9QX05BTUUiLCJyZWZTY2hlbWEiLCJlcnIiLCJTY2hlbWFVbmtub3duU2NoZW1hRXJyb3IiLCJleHRlbnNpb25JbmZvRnJvbVJvb3RTY2hlbWFJZCIsIlJlZmVyZW5jZUVycm9yIiwicmVmIiwiX2dldFZhbGlkYXRvciIsImlkIiwidmFsaWRhdG9yIiwidmFsaWRhdGUiLCJpc0FycmF5IiwiZXJyb3JzIiwiaXNBbGxvd2VkU2NoZW1hRmlsZUV4dGVuc2lvbiIsImZpbGVuYW1lIiwicGF0aCIsImV4dG5hbWUiLCJpc1BsYWluT2JqZWN0IiwiJGFzeW5jIiwiRXJyb3IiLCJkYXRhIiwibXNnIiwiaXNCb29sZWFuIiwiSlNPTiIsInN0cmluZ2lmeSIsImFwcGl1bVNjaGVtYSIsImZpbmFsaXplU2NoZW1hIiwicmVzZXRTY2hlbWEiLCJmbGF0dGVuU2NoZW1hIiwiZ2V0RGVmYXVsdHNGb3JTY2hlbWEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFD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Q0FBSixFQUE2QjtBQUMzQixZQUFJQSxNQUFNLENBQUMyRixNQUFYLEVBQW1CO0FBQ2pCLGlCQUFRLEdBQUVHLEdBQUksbUNBQWQ7QUFDRDs7QUFFRCxjQUFNLElBQUlyRCxTQUFKLENBQ0gsMEZBQXlGdUQsSUFBSSxDQUFDQyxTQUFMLENBQ3hGakcsTUFEd0YsQ0FFeEYsRUFIRSxDQUFOO0FBS0Q7O0FBQ0QsYUFBUSxHQUFFOEYsR0FBSSxpRUFBZDtBQUNELEtBakJELEdBREY7QUFGcUMsZ0RBWmhDLHFDQVlnQztBQUFBO0FBc0JyQyxTQUFLRCxJQUFMLEdBQVk7QUFBQzdGLE1BQUFBLE1BQUQ7QUFBU2YsTUFBQUEsT0FBVDtBQUFrQkMsTUFBQUE7QUFBbEIsS0FBWjtBQUNEOztBQXZDeUQ7OztBQTBDNUQsTUFBTWdILFlBQVksR0FBRy9ILFlBQVksQ0FBQ1EsTUFBYixFQUFyQjtBQUVPLE1BQU07QUFDWDRELEVBQUFBLGNBRFc7QUFFWC9DLEVBQUFBLGNBRlc7QUFHWHdELEVBQUFBLFVBSFc7QUFJWEcsRUFBQUEsVUFKVztBQUtYOUQsRUFBQUEsV0FMVztBQU1YSyxFQUFBQSxRQUFRLEVBQUV5RyxjQU5DO0FBT1hoRSxFQUFBQSxLQUFLLEVBQUVpRSxXQVBJO0FBUVhqQixFQUFBQSxRQVJXO0FBU1huQixFQUFBQSxTQVRXO0FBVVhYLEVBQUFBLE9BQU8sRUFBRWdELGFBVkU7QUFXWGpELEVBQUFBLFdBQVcsRUFBRWtELG9CQVhGO0FBWVgzQyxFQUFBQTtBQVpXLElBYVR1QyxZQWJHOzs7Ozs7Ozs7Ozs7O0FBY0EsTUFBTTtBQUFDWixFQUFBQTtBQUFELElBQWlDbkgsWUFBdkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtY2hlY2tcblxuaW1wb3J0IEFqdiBmcm9tICdhanYnO1xuaW1wb3J0IGFkZEZvcm1hdHMgZnJvbSAnYWp2LWZvcm1hdHMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRFJJVkVSX1RZUEUsIFBMVUdJTl9UWVBFIH0gZnJvbSAnLi4vZXh0ZW5zaW9uLWNvbmZpZyc7XG5pbXBvcnQgeyBSZWFkb25seU1hcCB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCBhcHBpdW1Db25maWdTY2hlbWEgZnJvbSAnLi9hcHBpdW0tY29uZmlnLXNjaGVtYSc7XG5pbXBvcnQgeyBBUFBJVU1fQ09ORklHX1NDSEVNQV9JRCwgQXJnU3BlYywgU0VSVkVSX1BST1BfTkFNRSB9IGZyb20gJy4vYXJnLXNwZWMnO1xuaW1wb3J0IHsga2V5d29yZHMgfSBmcm9tICcuL2tleXdvcmRzJztcblxuLyoqXG4gKiBFeHRlbnNpb25zIHRoYXQgYW4gZXh0ZW5zaW9uIHNjaGVtYSBmaWxlIGNhbiBoYXZlLlxuICovXG5leHBvcnQgY29uc3QgQUxMT1dFRF9TQ0hFTUFfRVhURU5TSU9OUyA9IG5ldyBTZXQoWycuanNvbicsICcuanMnLCAnLmNqcyddKTtcblxuLyoqXG4gKiBBIHdyYXBwZXIgYXJvdW5kIEFqdiBhbmQgc2NoZW1hLXJlbGF0ZWQgZnVuY3Rpb25zLlxuICpcbiAqIFNob3VsZCBoYXZlIGJlZW4gbmFtZWQgSGlnaGxhbmRlciwgYmVjYXVzZSBfdGhlcmUgY2FuIG9ubHkgYmUgb25lX1xuICovXG5jbGFzcyBBcHBpdW1TY2hlbWEge1xuICAvKipcbiAgICogQSBtYXBwaW5nIG9mIHVuaXF1ZSBhcmd1bWVudCBJRHMgdG8gdGhlaXIgY29ycmVzcG9uZGluZyB7QGxpbmsgQXJnU3BlY31zLlxuICAgKlxuICAgKiBBbiBcImFyZ3VtZW50XCIgaXMgYSBDTEkgYXJndW1lbnQgb3IgYSBjb25maWcgcHJvcGVydHkuXG4gICAqXG4gICAqIFVzZWQgdG8gcHJvdmlkZSBlYXN5IGxvb2t1cHMgb2YgYXJndW1lbnQgbWV0YWRhdGEgd2hlbiBjb252ZXJ0aW5nIGJldHdlZW4gZGlmZmVyZW50IHJlcHJlc2VudGF0aW9ucyBvZiB0aG9zZSBhcmd1bWVudHMuXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtSZWFkb25seU1hcDxzdHJpbmcsQXJnU3BlYz59XG4gICAqL1xuICBfYXJnU3BlY3MgPSBuZXcgUmVhZG9ubHlNYXAoKTtcblxuICAvKipcbiAgICogQSBtYXAgb2YgZXh0ZW5zaW9uIHR5cGVzIHRvIGV4dGVuc2lvbiBuYW1lcyB0byBzY2hlbWEgb2JqZWN0cy5cbiAgICpcbiAgICogVGhpcyBkYXRhIHN0cnVjdHVyZSBpcyB1c2VkIHRvIGVuc3VyZSB0aGVyZSBhcmUgbm8gbmFtaW5nIGNvbmZsaWN0cy4gVGhlIHNjaGVtYXNcbiAgICogYXJlIHN0b3JlZCBoZXJlIGluIG1lbW9yeSB1bnRpbCB0aGUgaW5zdGFuY2UgaXMgX2ZpbmFsaXplZF8uXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtSZWNvcmQ8RXh0ZW5zaW9uVHlwZSxNYXA8c3RyaW5nLFNjaGVtYU9iamVjdD4+fVxuICAgKi9cbiAgX3JlZ2lzdGVyZWRTY2hlbWFzID0ge1tEUklWRVJfVFlQRV06IG5ldyBNYXAoKSwgW1BMVUdJTl9UWVBFXTogbmV3IE1hcCgpfTtcblxuICAvKipcbiAgICogQWp2IGluc3RhbmNlXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtBanZ9XG4gICAqL1xuICBfYWp2O1xuXG4gIC8qKlxuICAgKiBTaW5nbGV0b24gaW5zdGFuY2UuXG4gICAqIEBwcml2YXRlXG4gICAqIEB0eXBlIHtBcHBpdW1TY2hlbWF9XG4gICAqL1xuICBzdGF0aWMgX2luc3RhbmNlO1xuXG4gIC8qKlxuICAgKiBMb29rdXAgb2Ygc2NoZW1hIElEcyB0byBmaW5hbGl6ZWQgc2NoZW1hcy5cbiAgICpcbiAgICogVGhpcyBkb2VzIG5vdCBpbmNsdWRlIHJlZmVyZW5jZXMsIGJ1dCByYXRoZXIgdGhlIHJvb3Qgc2NoZW1hcyB0aGVtc2VsdmVzLlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAdHlwZSB7UmVjb3JkPHN0cmluZyxTdHJpY3RTY2hlbWFPYmplY3Q+P31cbiAgICovXG4gIF9maW5hbGl6ZWRTY2hlbWFzID0gbnVsbDtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgQWp2LCBhZGRzIHN0YW5kYXJkIGZvcm1hdHMgYW5kIG91ciBjdXN0b20ga2V5d29yZHMuXG4gICAqIEBzZWUgaHR0cHM6Ly9ucG0uaW0vYWp2LWZvcm1hdHNcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLl9hanYgPSBBcHBpdW1TY2hlbWEuX2luc3RhbnRpYXRlQWp2KCk7XG4gIH1cblxuICAvKipcbiAgICogRmFjdG9yeSBmdW5jdGlvbiBmb3Ige0BsaW5rIEFwcGl1bVNjaGVtYX0gaW5zdGFuY2VzLlxuICAgKlxuICAgKiBSZXR1cm5zIGEgc2luZ2xldG9uIGluc3RhbmNlIGlmIG9uZSBleGlzdHMsIG90aGVyd2lzZSBjcmVhdGVzIGEgbmV3IG9uZS5cbiAgICogQmluZHMgcHVibGljIG1ldGhvZHMgdG8gdGhlIGluc3RhbmNlLlxuICAgKiBAcmV0dXJucyB7QXBwaXVtU2NoZW1hfVxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZSAoKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSBBcHBpdW1TY2hlbWEuX2luc3RhbmNlID8/IG5ldyBBcHBpdW1TY2hlbWEoKTtcbiAgICBBcHBpdW1TY2hlbWEuX2luc3RhbmNlID0gaW5zdGFuY2U7XG5cbiAgICBfLmJpbmRBbGwoaW5zdGFuY2UsIFtcbiAgICAgICdmaW5hbGl6ZScsXG4gICAgICAnZmxhdHRlbicsXG4gICAgICAnZ2V0QWxsQXJnU3BlY3MnLFxuICAgICAgJ2dldEFyZ1NwZWMnLFxuICAgICAgJ2dldERlZmF1bHRzJyxcbiAgICAgICdnZXREZWZhdWx0c0ZvckV4dGVuc2lvbicsXG4gICAgICAnZ2V0U2NoZW1hJyxcbiAgICAgICdoYXNBcmdTcGVjJyxcbiAgICAgICdpc0ZpbmFsaXplZCcsXG4gICAgICAncmVnaXN0ZXJTY2hlbWEnLFxuICAgICAgJ3Jlc2V0JyxcbiAgICAgICd2YWxpZGF0ZScsXG4gICAgXSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBgdHJ1ZWAgaWYgYSBzY2hlbWEgaGFzIGJlZW4gcmVnaXN0ZXJlZCB1c2luZyBnaXZlbiBleHRlbnNpb24gdHlwZSBhbmQgbmFtZS5cbiAgICpcbiAgICogVGhpcyBkb2VzIG5vdCBkZXBlbmQgb24gd2hldGhlciBvciBub3QgdGhlIGluc3RhbmNlIGhhcyBiZWVuIF9maW5hbGl6ZWRfLlxuICAgKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IGV4dFR5cGUgLSBFeHRlbnNpb24gdHlwZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0TmFtZSAtIE5hbWVcbiAgICogQHJldHVybnMge2Jvb2xlYW59IElmIHJlZ2lzdGVyZWRcbiAgICovXG4gIGhhc1JlZ2lzdGVyZWRTY2hlbWEgKGV4dFR5cGUsIGV4dE5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVnaXN0ZXJlZFNjaGVtYXNbZXh0VHlwZV0uaGFzKGV4dE5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBgdHJ1ZWAgaWYge0BsaW5rIEFwcGl1bVNjaGVtYS5maW5hbGl6ZSBmaW5hbGl6ZX0gaGFzIGJlZW4gY2FsbGVkXG4gICAqIHN1Y2Nlc3NmdWxseSBhbmQge0BsaW5rIEFwcGl1bVNjaGVtYS5yZXNldCByZXNldH0gaGFzIG5vdCBiZWVuIGNhbGxlZCBzaW5jZS5cbiAgICogQHJldHVybnMge2Jvb2xlYW59IElmIGZpbmFsaXplZFxuICAgKi9cbiAgaXNGaW5hbGl6ZWQgKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMuX2ZpbmFsaXplZFNjaGVtYXMpO1xuICB9XG5cbiAgZ2V0QWxsQXJnU3BlY3MgKCkge1xuICAgIHJldHVybiB0aGlzLl9hcmdTcGVjcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIHRoaXMgd2hlbiBubyBtb3JlIHNjaGVtYXMgd2lsbCBiZSByZWdpc3RlcmVkLlxuICAgKlxuICAgKiBUaGlzIGRvZXMgdGhyZWUgdGhpbmdzOlxuICAgKiAxLiBJdCBjb21iaW5lcyBhbGwgc2NoZW1hcyBmcm9tIGV4dGVuc2lvbnMgaW50byB0aGUgQXBwaXVtIGNvbmZpZyBzY2hlbWEsXG4gICAqICAgIHRoZW4gYWRkcyB0aGUgcmVzdWx0IHRvIHRoZSBgQWp2YCBpbnN0YW5jZS5cbiAgICogMi4gSXQgYWRkcyBzY2hlbWFzIGZvciBfZWFjaF8gYXJndW1lbnQvcHJvcGVydHkgZm9yIHZhbGlkYXRpb24gcHVycG9zZXMuXG4gICAqICAgIFRoZSBDTEkgdXNlcyB0aGVzZSBzY2hlbWFzIHRvIHZhbGlkYXRlIHNwZWNpZmljIGFyZ3VtZW50cy5cbiAgICogMy4gVGhlIHNjaGVtYXMgYXJlIHZhbGlkYXRlZCBhZ2FpbnN0IEpTT04gc2NoZW1hIGRyYWZ0LTA3ICh3aGljaCBpcyB0aGVcbiAgICogICAgb25seSBvbmUgc3VwcG9ydGVkIGF0IHRoaXMgdGltZSlcbiAgICpcbiAgICogQW55IG1ldGhvZCBpbiB0aGlzIGluc3RhbmNlIHRoYXQgbmVlZHMgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgYEFqdmAgaW5zdGFuY2VcbiAgICogd2lsbCB0aHJvdyBpZiB0aGlzIG1ldGhvZCBoYXMgbm90IGJlZW4gY2FsbGVkLlxuICAgKlxuICAgKiBJZiB0aGUgaW5zdGFuY2UgaGFzIGFscmVhZHkgYmVlbiBmaW5hbGl6ZWQsIHRoaXMgaXMgYSBuby1vcC5cbiAgICogQHB1YmxpY1xuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHNjaGVtYSBpcyBub3QgdmFsaWRcbiAgICogQHJldHVybnMge1JlYWRvbmx5PFJlY29yZDxzdHJpbmcsU3RyaWN0U2NoZW1hT2JqZWN0Pj59IFJlY29yZCBvZiBzY2hlbWEgSURzIHRvIGZ1bGwgc2NoZW1hIG9iamVjdHNcbiAgICovXG4gIGZpbmFsaXplICgpIHtcbiAgICBpZiAodGhpcy5pc0ZpbmFsaXplZCgpKSB7XG4gICAgICByZXR1cm4gLyoqIEB0eXBlIHtSZWNvcmQ8c3RyaW5nLFN0cmljdFNjaGVtYU9iamVjdD59ICovIChcbiAgICAgICAgdGhpcy5fZmluYWxpemVkU2NoZW1hc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBhanYgPSB0aGlzLl9hanY7XG5cbiAgICAvLyBBanYgd2lsbCBfbXV0YXRlXyB0aGUgc2NoZW1hLCBzbyB3ZSBuZWVkIHRvIGNsb25lIGl0LlxuICAgIGNvbnN0IGJhc2VTY2hlbWEgPSBfLmNsb25lRGVlcChhcHBpdW1Db25maWdTY2hlbWEpO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1NjaGVtYU9iamVjdH0gc2NoZW1hXG4gICAgICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSBbZXh0VHlwZV1cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2V4dE5hbWVdXG4gICAgICovXG4gICAgY29uc3QgYWRkQXJnU3BlY3MgPSAoc2NoZW1hLCBleHRUeXBlLCBleHROYW1lKSA9PiB7XG4gICAgICBmb3IgKGxldCBbcHJvcE5hbWUsIHByb3BTY2hlbWFdIG9mIE9iamVjdC5lbnRyaWVzKHNjaGVtYSkpIHtcbiAgICAgICAgY29uc3QgYXJnU3BlYyA9IEFyZ1NwZWMuY3JlYXRlKHByb3BOYW1lLCB7XG4gICAgICAgICAgZGVzdDogcHJvcFNjaGVtYS5hcHBpdW1DbGlEZXN0LFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogcHJvcFNjaGVtYS5kZWZhdWx0LFxuICAgICAgICAgIGV4dFR5cGUsXG4gICAgICAgICAgZXh0TmFtZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHthcmd9ID0gYXJnU3BlYztcbiAgICAgICAgdGhpcy5fYXJnU3BlY3Muc2V0KGFyZywgYXJnU3BlYyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGFkZEFyZ1NwZWNzKFxuICAgICAgXy5vbWl0KGJhc2VTY2hlbWEucHJvcGVydGllcy5zZXJ2ZXIucHJvcGVydGllcywgW1xuICAgICAgICBEUklWRVJfVFlQRSxcbiAgICAgICAgUExVR0lOX1RZUEUsXG4gICAgICBdKSxcbiAgICApO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1JlY29yZDxzdHJpbmcsU3RyaWN0U2NoZW1hT2JqZWN0Pn1cbiAgICAgKi9cbiAgICBjb25zdCBmaW5hbGl6ZWRTY2hlbWFzID0ge307XG5cbiAgICBjb25zdCBmaW5hbFNjaGVtYSA9IF8ucmVkdWNlKFxuICAgICAgdGhpcy5fcmVnaXN0ZXJlZFNjaGVtYXMsXG4gICAgICAvKipcbiAgICAgICAqIEBwYXJhbSB7dHlwZW9mIGJhc2VTY2hlbWF9IGJhc2VTY2hlbWFcbiAgICAgICAqIEBwYXJhbSB7TWFwPHN0cmluZyxTY2hlbWFPYmplY3Q+fSBleHRlbnNpb25TY2hlbWFzXG4gICAgICAgKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IGV4dFR5cGVcbiAgICAgICAqL1xuICAgICAgKGJhc2VTY2hlbWEsIGV4dGVuc2lvblNjaGVtYXMsIGV4dFR5cGUpID0+IHtcbiAgICAgICAgZXh0ZW5zaW9uU2NoZW1hcy5mb3JFYWNoKChzY2hlbWEsIGV4dE5hbWUpID0+IHtcbiAgICAgICAgICBjb25zdCAkcmVmID0gQXJnU3BlYy50b1NjaGVtYUJhc2VSZWYoZXh0VHlwZSwgZXh0TmFtZSk7XG4gICAgICAgICAgc2NoZW1hLiRpZCA9ICRyZWY7XG4gICAgICAgICAgc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzID0gZmFsc2U7IC8vIHRoaXMgbWFrZXMgYHNjaGVtYWAgYmVjb21lIGEgYFN0cmljdFNjaGVtYU9iamVjdGBcbiAgICAgICAgICBiYXNlU2NoZW1hLnByb3BlcnRpZXMuc2VydmVyLnByb3BlcnRpZXNbZXh0VHlwZV0ucHJvcGVydGllc1tleHROYW1lXSA9XG4gICAgICAgICAgICB7JHJlZiwgJGNvbW1lbnQ6IGV4dE5hbWV9O1xuICAgICAgICAgIGFqdi52YWxpZGF0ZVNjaGVtYShzY2hlbWEsIHRydWUpO1xuICAgICAgICAgIGFkZEFyZ1NwZWNzKHNjaGVtYS5wcm9wZXJ0aWVzLCBleHRUeXBlLCBleHROYW1lKTtcbiAgICAgICAgICBhanYuYWRkU2NoZW1hKHNjaGVtYSwgJHJlZik7XG4gICAgICAgICAgZmluYWxpemVkU2NoZW1hc1skcmVmXSA9IC8qKiBAdHlwZSB7U3RyaWN0U2NoZW1hT2JqZWN0fSAqLyAoc2NoZW1hKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBiYXNlU2NoZW1hO1xuICAgICAgfSxcbiAgICAgIGJhc2VTY2hlbWEsXG4gICAgKTtcblxuICAgIGFqdi5hZGRTY2hlbWEoZmluYWxTY2hlbWEsIEFQUElVTV9DT05GSUdfU0NIRU1BX0lEKTtcbiAgICBmaW5hbGl6ZWRTY2hlbWFzW0FQUElVTV9DT05GSUdfU0NIRU1BX0lEXSA9IGZpbmFsU2NoZW1hO1xuICAgIGFqdi52YWxpZGF0ZVNjaGVtYShmaW5hbFNjaGVtYSwgdHJ1ZSk7XG5cbiAgICB0aGlzLl9maW5hbGl6ZWRTY2hlbWFzID0gZmluYWxpemVkU2NoZW1hcztcbiAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZShmaW5hbGl6ZWRTY2hlbWFzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmVzIGFuZCBjcmVhdGVzIGFuIEFqdiBpbnN0YW5jZS5cbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMge0Fqdn1cbiAgICovXG4gIHN0YXRpYyBfaW5zdGFudGlhdGVBanYgKCkge1xuICAgIGNvbnN0IGFqdiA9IGFkZEZvcm1hdHMoXG4gICAgICBuZXcgQWp2KHtcbiAgICAgICAgLy8gd2l0aG91dCB0aGlzIG5vdCBtdWNoIHZhbGlkYXRpb24gYWN0dWFsbHkgaGFwcGVuc1xuICAgICAgICBhbGxFcnJvcnM6IHRydWUsXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgLy8gYWRkIGN1c3RvbSBrZXl3b3JkcyB0byBhanYuIHNlZSBzY2hlbWEta2V5d29yZHMuanNcbiAgICBfLmZvckVhY2goa2V5d29yZHMsIChrZXl3b3JkKSA9PiB7XG4gICAgICBhanYuYWRkS2V5d29yZChrZXl3b3JkKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBhanY7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRzIHRoaXMgaW5zdGFuY2UgdG8gaXRzIG9yaWdpbmFsIHN0YXRlLlxuICAgKlxuICAgKiAtIFJlbW92ZXMgYWxsIGFkZGVkIHNjaGVtYXMgZnJvbSB0aGUgYEFqdmAgaW5zdGFuY2VcbiAgICogLSBSZXNldHMgdGhlIG1hcCBvZiB7QGxpbmsgQXJnU3BlYyBBcmdTcGVjc31cbiAgICogLSBSZXNldHMgdGhlIG1hcCBvZiByZWdpc3RlcmVkIHNjaGVtYXNcbiAgICogLSBTZXRzIHRoZSB7QGxpbmsgQXBwaXVtU2NoZW1hLl9maW5hbGl6ZWQgX2ZpbmFsaXplZH0gZmxhZyB0byBgZmFsc2VgXG4gICAqXG4gICAqIElmIHlvdSBuZWVkIHRvIGNhbGwge0BsaW5rIEFwcGl1bVNjaGVtYS5maW5hbGl6ZX0gYWdhaW4sIHlvdSdsbCB3YW50IHRvIGNhbGwgdGhpcyBmaXJzdC5cbiAgICogQHJldHVybnMge3ZvaWR9XG4gICAqL1xuICByZXNldCAoKSB7XG4gICAgZm9yIChjb25zdCBzY2hlbWFJZCBvZiBPYmplY3Qua2V5cyh0aGlzLl9maW5hbGl6ZWRTY2hlbWFzID8/IHt9KSkge1xuICAgICAgdGhpcy5fYWp2LnJlbW92ZVNjaGVtYShzY2hlbWFJZCk7XG4gICAgfVxuICAgIHRoaXMuX2FyZ1NwZWNzID0gbmV3IFJlYWRvbmx5TWFwKCk7XG4gICAgdGhpcy5fcmVnaXN0ZXJlZFNjaGVtYXMgPSB7XG4gICAgICBbRFJJVkVSX1RZUEVdOiBuZXcgTWFwKCksXG4gICAgICBbUExVR0lOX1RZUEVdOiBuZXcgTWFwKCksXG4gICAgfTtcbiAgICB0aGlzLl9maW5hbGl6ZWRTY2hlbWFzID0gbnVsbDtcblxuICAgIC8vIEFqdiBzZWVtcyB0byBoYXZlIGFuIG92ZXItZWFnZXIgY2FjaGUsIHNvIHdlIGhhdmUgdG8gZHVtcCB0aGUgb2JqZWN0IGVudGlyZWx5LlxuICAgIHRoaXMuX2FqdiA9IEFwcGl1bVNjaGVtYS5faW5zdGFudGlhdGVBanYoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBzY2hlbWEgZnJvbSBhbiBleHRlbnNpb24uXG4gICAqXG4gICAqIFRoaXMgaXMgXCJmYWlsLWZhc3RcIiBpbiB0aGF0IHRoZSBzY2hlbWEgd2lsbCBpbW1lZGlhdGVseSBiZSB2YWxpZGF0ZWQgYWdhaW5zdCBKU09OIHNjaGVtYSBkcmFmdC0wNyBfb3JfIHdoYXRldmVyIHRoZSB2YWx1ZSBvZiB0aGUgc2NoZW1hJ3MgYCRzY2hlbWFgIHByb3AgaXMuXG4gICAqXG4gICAqIERvZXMgX25vdF8gYWRkIHRoZSBzY2hlbWEgdG8gdGhlIGBhanZgIGluc3RhbmNlICh0aGlzIGlzIGRvbmUgYnkge0BsaW5rIEFwcGl1bVNjaGVtYS5maW5hbGl6ZX0pLlxuICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vZXh0LWNvbmZpZy1pbycpLkV4dGVuc2lvblR5cGV9IGV4dFR5cGUgLSBFeHRlbnNpb24gdHlwZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0TmFtZSAtIFVuaXF1ZSBleHRlbnNpb24gbmFtZSBmb3IgYHR5cGVgXG4gICAqIEBwYXJhbSB7U2NoZW1hT2JqZWN0fSBzY2hlbWEgLSBTY2hlbWEgb2JqZWN0XG4gICAqIEB0aHJvd3Mge1NjaGVtYU5hbWVDb25mbGljdEVycm9yfSBJZiB0aGUgc2NoZW1hIGlzIGFuIGludmFsaWRcbiAgICogQHJldHVybnMge3ZvaWR9XG4gICAqL1xuICByZWdpc3RlclNjaGVtYSAoZXh0VHlwZSwgZXh0TmFtZSwgc2NoZW1hKSB7XG4gICAgaWYgKCEoZXh0VHlwZSAmJiBleHROYW1lKSB8fCBfLmlzVW5kZWZpbmVkKHNjaGVtYSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICAgICdFeHBlY3RlZCBleHRlbnNpb24gdHlwZSwgZXh0ZW5zaW9uIG5hbWUsIGFuZCBhIGRlZmluZWQgc2NoZW1hJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghQXBwaXVtU2NoZW1hLmlzU3VwcG9ydGVkU2NoZW1hVHlwZShzY2hlbWEpKSB7XG4gICAgICB0aHJvdyBuZXcgU2NoZW1hVW5zdXBwb3J0ZWRTY2hlbWFFcnJvcihzY2hlbWEsIGV4dFR5cGUsIGV4dE5hbWUpO1xuICAgIH1cbiAgICBjb25zdCBub3JtYWxpemVkRXh0TmFtZSA9IF8ua2ViYWJDYXNlKGV4dE5hbWUpO1xuICAgIGlmICh0aGlzLmhhc1JlZ2lzdGVyZWRTY2hlbWEoZXh0VHlwZSwgbm9ybWFsaXplZEV4dE5hbWUpKSB7XG4gICAgICBpZiAodGhpcy5fcmVnaXN0ZXJlZFNjaGVtYXNbZXh0VHlwZV0uZ2V0KG5vcm1hbGl6ZWRFeHROYW1lKSA9PT0gc2NoZW1hKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBTY2hlbWFOYW1lQ29uZmxpY3RFcnJvcihleHRUeXBlLCBleHROYW1lKTtcbiAgICB9XG4gICAgdGhpcy5fYWp2LnZhbGlkYXRlU2NoZW1hKHNjaGVtYSwgdHJ1ZSk7XG5cbiAgICB0aGlzLl9yZWdpc3RlcmVkU2NoZW1hc1tleHRUeXBlXS5zZXQobm9ybWFsaXplZEV4dE5hbWUsIHNjaGVtYSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIHtAbGluayBBcmdTcGVjfSBmb3IgdGhlIGdpdmVuIGFyZ3VtZW50IG5hbWUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gQ0xJIGFyZ3VtZW50IG5hbWVcbiAgICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSBbZXh0VHlwZV0gLSBFeHRlbnNpb24gdHlwZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gW2V4dE5hbWVdIC0gRXh0ZW5zaW9uIG5hbWVcbiAgICogQHJldHVybnMge0FyZ1NwZWN8dW5kZWZpbmVkfSBBcmdTcGVjIG9yIGB1bmRlZmluZWRgIGlmIG5vdCBmb3VuZFxuICAgKi9cbiAgZ2V0QXJnU3BlYyAobmFtZSwgZXh0VHlwZSwgZXh0TmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9hcmdTcGVjcy5nZXQoQXJnU3BlYy50b0FyZyhuYW1lLCBleHRUeXBlLCBleHROYW1lKSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGluc3RhbmNlIGtub3dzIGFib3V0IGFuIGFyZ3VtZW50IGJ5IHRoZSBnaXZlbiBgbmFtZWAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gQ0xJIGFyZ3VtZW50IG5hbWVcbiAgICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSBbZXh0VHlwZV0gLSBFeHRlbnNpb24gdHlwZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gW2V4dE5hbWVdIC0gRXh0ZW5zaW9uIG5hbWVcbiAgICogQHJldHVybnMge2Jvb2xlYW59IGB0cnVlYCBpZiBzdWNoIGFuIHtAbGluayBBcmdTcGVjfSBleGlzdHNcbiAgICovXG4gIGhhc0FyZ1NwZWMgKG5hbWUsIGV4dFR5cGUsIGV4dE5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5fYXJnU3BlY3MuaGFzKEFyZ1NwZWMudG9BcmcobmFtZSwgZXh0VHlwZSwgZXh0TmFtZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBgUmVjb3JkYCBvZiBhcmd1bWVudCBcImRlc3RcIiBzdHJpbmdzIHRvIGRlZmF1bHQgdmFsdWVzLlxuICAgKlxuICAgKiBUaGUgXCJkZXN0XCIgc3RyaW5nIGlzIHRoZSBwcm9wZXJ0eSBuYW1lIGluIG9iamVjdCByZXR1cm5lZCBieVxuICAgKiBgYXJncGFyc2UuQXJndW1lbnRQYXJzZXJbJ3BhcnNlX2FyZ3MnXWAuXG4gICAqIEB0ZW1wbGF0ZSB7Ym9vbGVhbnx1bmRlZmluZWR9IEZsYXR0ZW5lZFxuICAgKiBAcGFyYW0ge0ZsYXR0ZW5lZH0gW2ZsYXR0ZW49dHJ1ZV0gLSBJZiBgdHJ1ZWAsIGZsYXR0ZW5zIHRoZSByZXR1cm5lZCBvYmplY3RcbiAgICogdXNpbmcgXCJrZXlwYXRoXCItc3R5bGUga2V5cyBvZiB0aGUgZm9ybWF0IGA8ZXh0VHlwZT4uPGV4dE5hbWU+LjxhcmdOYW1lPmAuXG4gICAqIE90aGVyd2lzZSwgcmV0dXJucyBhIG5lc3RlZCBvYmplY3QgdXNpbmcgYGV4dFR5cGVgIGFuZCBgZXh0TmFtZWAgYXNcbiAgICogcHJvcGVydGllcy4gQmFzZSBhcmd1bWVudHMgKHNlcnZlciBhcmd1bWVudHMpIGFyZSBhbHdheXMgYXQgdGhlIHRvcCBsZXZlbC5cbiAgICogQHJldHVybnMge0RlZmF1bHRWYWx1ZXM8RmxhdHRlbmVkPn1cbiAgICovXG4gIGdldERlZmF1bHRzIChmbGF0dGVuID0gLyoqIEB0eXBlIHtGbGF0dGVuZWR9ICovICh0cnVlKSkge1xuICAgIGlmICghdGhpcy5pc0ZpbmFsaXplZCgpKSB7XG4gICAgICB0aHJvdyBuZXcgU2NoZW1hRmluYWxpemF0aW9uRXJyb3IoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBjYWxsYmFjayBEZWZhdWx0UmVkdWNlclxuICAgICAqIEBwYXJhbSB7RGVmYXVsdFZhbHVlczxGbGF0dGVuZWQ+fSBkZWZhdWx0c1xuICAgICAqIEBwYXJhbSB7QXJnU3BlY30gYXJnU3BlY1xuICAgICAqIEByZXR1cm5zIHtEZWZhdWx0VmFsdWVzPEZsYXR0ZW5lZD59XG4gICAgICovXG4gICAgLyoqIEB0eXBlIHtEZWZhdWx0UmVkdWNlcn0gKi9cbiAgICBjb25zdCByZWR1Y2VyID0gZmxhdHRlblxuICAgICAgPyAoZGVmYXVsdHMsIHtkZWZhdWx0VmFsdWUsIGRlc3R9KSA9PiB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkZWZhdWx0VmFsdWUpKSB7XG4gICAgICAgICAgZGVmYXVsdHNbZGVzdF0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRzO1xuICAgICAgfVxuICAgICAgOiAoZGVmYXVsdHMsIHtkZWZhdWx0VmFsdWUsIGRlc3R9KSA9PiB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkZWZhdWx0VmFsdWUpKSB7XG4gICAgICAgICAgXy5zZXQoZGVmYXVsdHMsIGRlc3QsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRzO1xuICAgICAgfTtcblxuICAgIC8qKiBAdHlwZSB7RGVmYXVsdFZhbHVlczxGbGF0dGVuZWQ+fSAqL1xuICAgIGNvbnN0IHJldHZhbCA9IHt9O1xuICAgIHJldHVybiBbLi4udGhpcy5fYXJnU3BlY3MudmFsdWVzKCldLnJlZHVjZShyZWR1Y2VyLCByZXR2YWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBmbGF0dGVuZWQgUmVjb3JkIG9mIGRlZmF1bHRzIGZvciBhIHNwZWNpZmljIGV4dGVuc2lvbi4gS2V5cyB3aWxsXG4gICAqIGJlIG9mIGZvcm1hdCBgPGFyZ05hbWU+YC5cbiAgICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSBleHRUeXBlIC0gRXh0ZW5zaW9uIHR5cGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dE5hbWUgLSBFeHRlbnNpb24gbmFtZVxuICAgKiBAcmV0dXJucyB7UmVjb3JkPHN0cmluZyxBcmdTcGVjRGVmYXVsdFZhbHVlPn1cbiAgICovXG4gIGdldERlZmF1bHRzRm9yRXh0ZW5zaW9uIChleHRUeXBlLCBleHROYW1lKSB7XG4gICAgaWYgKCF0aGlzLmlzRmluYWxpemVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBTY2hlbWFGaW5hbGl6YXRpb25FcnJvcigpO1xuICAgIH1cbiAgICBjb25zdCBzcGVjcyA9IFsuLi50aGlzLl9hcmdTcGVjcy52YWx1ZXMoKV0uZmlsdGVyKFxuICAgICAgKHNwZWMpID0+IHNwZWMuZXh0VHlwZSA9PT0gZXh0VHlwZSAmJiBzcGVjLmV4dE5hbWUgPT09IGV4dE5hbWUsXG4gICAgKTtcbiAgICByZXR1cm4gc3BlY3MucmVkdWNlKChkZWZhdWx0cywge2RlZmF1bHRWYWx1ZSwgcmF3RGVzdH0pID0+IHtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkZWZhdWx0VmFsdWUpKSB7XG4gICAgICAgIGRlZmF1bHRzW3Jhd0Rlc3RdID0gZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRlZmF1bHRzO1xuICAgIH0sIHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGbGF0dGVuIHNjaGVtYSBpbnRvIGFuIGFycmF5IG9mIGBTY2hlbWFPYmplY3RgcyBhbmQgYXNzb2NpYXRlZFxuICAgKiB7QGxpbmsgQXJnU3BlYyBBcmdTcGVjc30uXG4gICAqXG4gICAqIENvbnZlcnRzIG5lc3RlZCBleHRlbnNpb24gc2NoZW1hcyB0byBrZXlzIGJhc2VkIG9uIHRoZSBleHRlbnNpb24gdHlwZSBhbmRcbiAgICogbmFtZS4gVXNlZCB3aGVuIHRyYW5zbGF0aW5nIHRvIGBhcmdwYXJzZWAgb3B0aW9ucyBvciBnZXR0aW5nIHRoZSBsaXN0IG9mXG4gICAqIGRlZmF1bHQgdmFsdWVzIChzZWUge0BsaW5rIEFwcGl1bVNjaGVtYS5nZXREZWZhdWx0c30pIGZvciBDTEkgb3Igb3RoZXJ3aXNlLlxuICAgKlxuICAgKiBUaGUgcmV0dXJuIHZhbHVlIGlzIGFuIGludGVybWVkaWF0ZSByZXByc2VudGF0aW9uIHVzZWQgYnkgYGNsaS1hcmdzYFxuICAgKiBtb2R1bGUncyBgdG9QYXJzZXJBcmdzYCwgd2hpY2ggY29udmVydHMgdGhlIGZpbmFsaXplZCBzY2hlbWEgdG8gcGFyYW1ldGVyc1xuICAgKiB1c2VkIGJ5IGBhcmdwYXJzZWAuXG4gICAqIEB0aHJvd3MgSWYge0BsaW5rIEFwcGl1bVNjaGVtYS5maW5hbGl6ZX0gaGFzIG5vdCBiZWVuIGNhbGxlZCB5ZXQuXG4gICAqIEByZXR1cm5zIHtGbGF0dGVuZWRTY2hlbWF9XG4gICAqL1xuICBmbGF0dGVuICgpIHtcbiAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmdldFNjaGVtYSgpO1xuXG4gICAgLyoqIEB0eXBlIHsge3Byb3BlcnRpZXM6IFNjaGVtYU9iamVjdCwgcHJlZml4OiBzdHJpbmdbXX1bXSB9ICovXG4gICAgY29uc3Qgc3RhY2sgPSBbe3Byb3BlcnRpZXM6IHNjaGVtYS5wcm9wZXJ0aWVzLCBwcmVmaXg6IFtdfV07XG4gICAgLyoqIEB0eXBlIHtGbGF0dGVuZWRTY2hlbWF9ICovXG4gICAgY29uc3QgZmxhdHRlbmVkID0gW107XG5cbiAgICAvLyB0aGlzIGJpdCBpcyBhIHJlY3Vyc2l2ZSBhbGdvcml0aG0gcmV3cml0dGVuIGFzIGEgZm9yIGxvb3AuXG4gICAgLy8gd2hlbiB3ZSBmaW5kIHNvbWV0aGluZyB3ZSB3YW50IHRvIHRyYXZlcnNlLCB3ZSBhZGQgaXQgdG8gYHN0YWNrYFxuICAgIGZvciAoY29uc3Qge3Byb3BlcnRpZXMsIHByZWZpeH0gb2Ygc3RhY2spIHtcbiAgICAgIGNvbnN0IHBhaXJzID0gXy50b1BhaXJzKHByb3BlcnRpZXMpO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcGFpcnMpIHtcbiAgICAgICAgY29uc3Qge3Byb3BlcnRpZXMsICRyZWZ9ID0gdmFsdWU7XG4gICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgc3RhY2sucHVzaCh7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzLFxuICAgICAgICAgICAgcHJlZml4OiBrZXkgPT09IFNFUlZFUl9QUk9QX05BTUUgPyBbXSA6IFsuLi5wcmVmaXgsIGtleV0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoJHJlZikge1xuICAgICAgICAgIGxldCByZWZTY2hlbWE7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlZlNjaGVtYSA9IHRoaXMuZ2V0U2NoZW1hKCRyZWYpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gdGhpcyBjYW4gaGFwcGVuIGlmIGFuIGV4dGVuc2lvbiBzY2hlbWEgc3VwcGxpZXMgYSAkcmVmIHRvIGEgbm9uLWV4aXN0ZW50IHNjaGVtYVxuICAgICAgICAgICAgdGhyb3cgbmV3IFNjaGVtYVVua25vd25TY2hlbWFFcnJvcigkcmVmKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qge25vcm1hbGl6ZWRFeHROYW1lfSA9XG4gICAgICAgICAgICBBcmdTcGVjLmV4dGVuc2lvbkluZm9Gcm9tUm9vdFNjaGVtYUlkKCRyZWYpO1xuICAgICAgICAgIGlmICghbm9ybWFsaXplZEV4dE5hbWUpIHtcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXG4gICAgICAgICAgICAgIGBDb3VsZCBub3QgZGV0ZXJtaW5lIGV4dGVuc2lvbiBuYW1lIGZyb20gc2NoZW1hIElEICR7JHJlZn0uIFRoaXMgaXMgYSBidWcuYCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YWNrLnB1c2goe1xuICAgICAgICAgICAgcHJvcGVydGllczogcmVmU2NoZW1hLnByb3BlcnRpZXMsXG4gICAgICAgICAgICBwcmVmaXg6IFsuLi5wcmVmaXgsIGtleSwgbm9ybWFsaXplZEV4dE5hbWVdLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGtleSAhPT0gRFJJVkVSX1RZUEUgJiYga2V5ICE9PSBQTFVHSU5fVFlQRSkge1xuICAgICAgICAgIGNvbnN0IFtleHRUeXBlLCBleHROYW1lXSA9IHByZWZpeDtcbiAgICAgICAgICBjb25zdCBhcmdTcGVjID0gdGhpcy5nZXRBcmdTcGVjKFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgLyoqIEB0eXBlIHtFeHRlbnNpb25UeXBlfSAqLyAoZXh0VHlwZSksXG4gICAgICAgICAgICBleHROYW1lLFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFhcmdTcGVjKSB7XG4gICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFxuICAgICAgICAgICAgICBgVW5rbm93biBhcmd1bWVudCB3aXRoIGtleSAke2tleX0sIGV4dFR5cGUgJHtleHRUeXBlfSBhbmQgZXh0TmFtZSAke2V4dE5hbWV9LiBUaGlzIGlzIGEgYnVnLmAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmbGF0dGVuZWQucHVzaCh7c2NoZW1hOiBfLmNsb25lRGVlcCh2YWx1ZSksIGFyZ1NwZWN9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmbGF0dGVuZWQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBzY2hlbWEgaXRzZWxmXG4gICAqIEBwdWJsaWNcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtyZWZdIC0gU2NoZW1hIElEXG4gICAqIEB0aHJvd3MgSWYgdGhlIHNjaGVtYSBoYXMgbm90IHlldCBiZWVuIGZpbmFsaXplZFxuICAgKiBAcmV0dXJucyB7U2NoZW1hT2JqZWN0fVxuICAgKi9cbiAgZ2V0U2NoZW1hIChyZWYgPSBBUFBJVU1fQ09ORklHX1NDSEVNQV9JRCkge1xuICAgIHJldHVybiAvKiogQHR5cGUge1NjaGVtYU9iamVjdH0gKi8gKHRoaXMuX2dldFZhbGlkYXRvcihyZWYpLnNjaGVtYSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHNjaGVtYSB2YWxpZGF0b3IgZnVuY3Rpb24gZnJvbSBBanZcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtpZF0gLSBTY2hlbWEgSURcbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMge2ltcG9ydCgnYWp2JykuVmFsaWRhdGVGdW5jdGlvbn1cbiAgICovXG4gIF9nZXRWYWxpZGF0b3IgKGlkID0gQVBQSVVNX0NPTkZJR19TQ0hFTUFfSUQpIHtcbiAgICBjb25zdCB2YWxpZGF0b3IgPSB0aGlzLl9hanYuZ2V0U2NoZW1hKGlkKTtcbiAgICBpZiAoIXZhbGlkYXRvcikge1xuICAgICAgaWYgKGlkID09PSBBUFBJVU1fQ09ORklHX1NDSEVNQV9JRCkge1xuICAgICAgICB0aHJvdyBuZXcgU2NoZW1hRmluYWxpemF0aW9uRXJyb3IoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBTY2hlbWFVbmtub3duU2NoZW1hRXJyb3IoaWQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsaWRhdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGFuIG9iamVjdCwgdmFsaWRhdGVzIGl0IGFnYWluc3QgdGhlIEFwcGl1bSBjb25maWcgc2NoZW1hLlxuICAgKiBJZiBlcnJvcnMgb2NjdXIsIHRoZSByZXR1cm5lZCBhcnJheSB3aWxsIGJlIG5vbi1lbXB0eS5cbiAgICogQHBhcmFtIHthbnl9IHZhbHVlIC0gVGhlIHZhbHVlIChob3BlZnVsbHkgYW4gb2JqZWN0KSB0byB2YWxpZGF0ZSBhZ2FpbnN0IHRoZSBzY2hlbWFcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtyZWZdIC0gU2NoZW1hIElEIG9yIHJlZi5cbiAgICogQHB1YmxpY1xuICAgKiBAcmV0dXJucyB7aW1wb3J0KCdhanYnKS5FcnJvck9iamVjdFtdfSBBcnJheSBvZiBlcnJvcnMsIGlmIGFueS5cbiAgICovXG4gIHZhbGlkYXRlICh2YWx1ZSwgcmVmID0gQVBQSVVNX0NPTkZJR19TQ0hFTUFfSUQpIHtcbiAgICBjb25zdCB2YWxpZGF0b3IgPSB0aGlzLl9nZXRWYWxpZGF0b3IocmVmKTtcbiAgICByZXR1cm4gIXZhbGlkYXRvcih2YWx1ZSkgJiYgXy5pc0FycmF5KHZhbGlkYXRvci5lcnJvcnMpXG4gICAgICA/IFsuLi52YWxpZGF0b3IuZXJyb3JzXVxuICAgICAgOiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBgZmlsZW5hbWVgJ3MgZmlsZSBleHRlbnNpb24gaXMgYWxsb3dlZCAoaW4ge0BsaW5rIEFMTE9XRURfU0NIRU1BX0VYVEVOU0lPTlN9KS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVuYW1lXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgc3RhdGljIGlzQWxsb3dlZFNjaGVtYUZpbGVFeHRlbnNpb24gKGZpbGVuYW1lKSB7XG4gICAgcmV0dXJuIEFMTE9XRURfU0NIRU1BX0VYVEVOU0lPTlMuaGFzKHBhdGguZXh0bmFtZShmaWxlbmFtZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYHRydWVgIGlmIGBzY2hlbWFgIGlzIGEgcGxhaW4gb2JqZWN0IHdpdGggYSBub24tdHJ1ZSBgJGFzeW5jYCBwcm9wZXJ0eS5cbiAgICogQHBhcmFtIHthbnl9IHNjaGVtYSAtIFNjaGVtYSB0byBjaGVja1xuICAgKiBAcmV0dXJucyB7c2NoZW1hIGlzIFNjaGVtYU9iamVjdH1cbiAgICovXG4gIHN0YXRpYyBpc1N1cHBvcnRlZFNjaGVtYVR5cGUgKHNjaGVtYSkge1xuICAgIHJldHVybiBfLmlzUGxhaW5PYmplY3Qoc2NoZW1hKSAmJiBzY2hlbWEuJGFzeW5jICE9PSB0cnVlO1xuICB9XG59XG5cbi8qKlxuICogVGhyb3duIHdoZW4gdGhlIHtAbGluayBBcHBpdW1TY2hlbWF9IGluc3RhbmNlIGhhcyBub3QgeWV0IGJlZW4gZmluYWxpemVkLCBidXRcbiAqIHRoZSBtZXRob2QgY2FsbGVkIHJlcXVpcmVzIGl0LlxuICovXG5leHBvcnQgY2xhc3MgU2NoZW1hRmluYWxpemF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIC8qKlxuICAgKiBAdHlwZSB7UmVhZG9ubHk8c3RyaW5nPn1cbiAgICovXG4gIGNvZGUgPSAnQVBQSVVNRVJSX1NDSEVNQV9GSU5BTElaQVRJT04nO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcignU2NoZW1hIG5vdCB5ZXQgZmluYWxpemVkOyBgZmluYWxpemUoKWAgbXVzdCBiZSBjYWxsZWQgZmlyc3QuJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBUaHJvd24gd2hlbiBhIFwidW5pcXVlXCIgc2NoZW1hIElEIGNvbmZsaWN0cyB3aXRoIGFuIGV4aXN0aW5nIHNjaGVtYSBJRC5cbiAqXG4gKiBUaGlzIGlzIGxpa2VseSBnb2luZyB0byBiZSBjYXVzZWQgYnkgYXR0ZW1wdGluZyB0byByZWdpc3RlciB0aGUgc2FtZSBzY2hlbWEgdHdpY2UuXG4gKi9cbmV4cG9ydCBjbGFzcyBTY2hlbWFOYW1lQ29uZmxpY3RFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgLyoqXG4gICAqIEB0eXBlIHtSZWFkb25seTxzdHJpbmc+fVxuICAgKi9cbiAgY29kZSA9ICdBUFBJVU1FUlJfU0NIRU1BX05BTUVfQ09ORkxJQ1QnO1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7UmVhZG9ubHk8e2V4dFR5cGU6IEV4dGVuc2lvblR5cGUsIGV4dE5hbWU6IHN0cmluZ30+fVxuICAgKi9cbiAgZGF0YTtcblxuICAvKipcbiAgICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSBleHRUeXBlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBleHROYW1lXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoZXh0VHlwZSwgZXh0TmFtZSkge1xuICAgIHN1cGVyKFxuICAgICAgYE5hbWUgZm9yICR7ZXh0VHlwZX0gc2NoZW1hIFwiJHtleHROYW1lfVwiIGNvbmZsaWN0cyB3aXRoIGFuIGV4aXN0aW5nIHNjaGVtYWAsXG4gICAgKTtcbiAgICB0aGlzLmRhdGEgPSB7ZXh0VHlwZSwgZXh0TmFtZX07XG4gIH1cbn1cblxuLyoqXG4gKiBUaHJvd24gd2hlbiBhIHNjaGVtYSBJRCB3YXMgZXhwZWN0ZWQsIGJ1dCBpdCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB7QGxpbmsgQWp2fSBpbnN0YW5jZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFNjaGVtYVVua25vd25TY2hlbWFFcnJvciBleHRlbmRzIFJlZmVyZW5jZUVycm9yIHtcbiAgLyoqXG4gICAqIEB0eXBlIHtSZWFkb25seTxzdHJpbmc+fVxuICAgKi9cbiAgY29kZSA9ICdBUFBJVU1FUlJfU0NIRU1BX1VOS05PV05fU0NIRU1BJztcblxuICAvKipcbiAgICogQHR5cGUge1JlYWRvbmx5PHtzY2hlbWFJZDogc3RyaW5nfT59XG4gICAqL1xuICBkYXRhO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2NoZW1hSWRcbiAgICovXG4gIGNvbnN0cnVjdG9yIChzY2hlbWFJZCkge1xuICAgIHN1cGVyKGBVbmtub3duIHNjaGVtYTogXCIke3NjaGVtYUlkfVwiYCk7XG4gICAgdGhpcy5kYXRhID0ge3NjaGVtYUlkfTtcbiAgfVxufVxuXG4vKipcbiAqIFRocm93biB3aGVuIGEgc2NoZW1hIGlzIHByb3ZpZGVkLCBidXQgaXQncyBvZiBhbiB1bnN1cHBvcnRlZCB0eXBlLlxuICpcbiAqIFwiVmFsaWRcIiBzY2hlbWFzIHdoaWNoIGFyZSB1bnN1cHBvcnRlZCBpbmNsdWRlIGJvb2xlYW4gc2NoZW1hcyBhbmQgYXN5bmMgc2NoZW1hc1xuICogKGhhdmluZyBhIGB0cnVlYCBgJGFzeW5jYCBwcm9wZXJ0eSkuXG4gKi9cbmV4cG9ydCBjbGFzcyBTY2hlbWFVbnN1cHBvcnRlZFNjaGVtYUVycm9yIGV4dGVuZHMgVHlwZUVycm9yIHtcbiAgLyoqXG4gICAqIEB0eXBlIHtSZWFkb25seTxzdHJpbmc+fVxuICAgKi9cbiAgY29kZSA9ICdBUFBJVU1FUlJfU0NIRU1BX1VOU1VQUE9SVEVEX1NDSEVNQSc7XG5cbiAgLyoqXG4gICAqIEB0eXBlIHtSZWFkb25seTx7c2NoZW1hOiBhbnksIGV4dFR5cGU6IEV4dGVuc2lvblR5cGUsIGV4dE5hbWU6IHN0cmluZ30+fVxuICAgKi9cbiAgZGF0YTtcblxuICAvKipcbiAgICogQHBhcmFtIHthbnl9IHNjaGVtYVxuICAgKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IGV4dFR5cGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dE5hbWVcbiAgICovXG4gIGNvbnN0cnVjdG9yIChzY2hlbWEsIGV4dFR5cGUsIGV4dE5hbWUpIHtcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzgyNzdcbiAgICBzdXBlcihcbiAgICAgICgoKSA9PiB7XG4gICAgICAgIGxldCBtc2cgPSBgVW5zdXBwb3J0ZWQgc2NoZW1hIGZyb20gJHtleHRUeXBlfSBcIiR7ZXh0TmFtZX1cIjpgO1xuICAgICAgICBpZiAoXy5pc0Jvb2xlYW4oc2NoZW1hKSkge1xuICAgICAgICAgIHJldHVybiBgJHttc2d9IHNjaGVtYSBjYW5ub3QgYmUgYSBib29sZWFuYDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KHNjaGVtYSkpIHtcbiAgICAgICAgICBpZiAoc2NoZW1hLiRhc3luYykge1xuICAgICAgICAgICAgcmV0dXJuIGAke21zZ30gc2NoZW1hIGNhbm5vdCBiZSBhbiBhc3luYyBzY2hlbWFgO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICAgICAgICBgc2NoZW1hIElTIHN1cHBvcnRlZDsgdGhpcyBlcnJvciBzaG91bGQgbm90IGJlIHRocm93biAodGhpcyBpcyBhIGJ1ZykuIHZhbHVlIG9mIHNjaGVtYTogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgICAgKX1gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke21zZ30gc2NoZW1hIG11c3QgYmUgYSBwbGFpbiBvYmplY3Qgd2l0aG91dCBhIHRydWUgXCIkYXN5bmNcIiBwcm9wZXJ0eWA7XG4gICAgICB9KSgpLFxuICAgICk7XG4gICAgdGhpcy5kYXRhID0ge3NjaGVtYSwgZXh0VHlwZSwgZXh0TmFtZX07XG4gIH1cbn1cblxuY29uc3QgYXBwaXVtU2NoZW1hID0gQXBwaXVtU2NoZW1hLmNyZWF0ZSgpO1xuXG5leHBvcnQgY29uc3Qge1xuICByZWdpc3RlclNjaGVtYSxcbiAgZ2V0QWxsQXJnU3BlY3MsXG4gIGdldEFyZ1NwZWMsXG4gIGhhc0FyZ1NwZWMsXG4gIGlzRmluYWxpemVkLFxuICBmaW5hbGl6ZTogZmluYWxpemVTY2hlbWEsXG4gIHJlc2V0OiByZXNldFNjaGVtYSxcbiAgdmFsaWRhdGUsXG4gIGdldFNjaGVtYSxcbiAgZmxhdHRlbjogZmxhdHRlblNjaGVtYSxcbiAgZ2V0RGVmYXVsdHM6IGdldERlZmF1bHRzRm9yU2NoZW1hLFxuICBnZXREZWZhdWx0c0ZvckV4dGVuc2lvbixcbn0gPSBhcHBpdW1TY2hlbWE7XG5leHBvcnQgY29uc3Qge2lzQWxsb3dlZFNjaGVtYUZpbGVFeHRlbnNpb259ID0gQXBwaXVtU2NoZW1hO1xuXG4vKipcbiAqIEFwcGl1bSBvbmx5IHN1cHBvcnRzIHNjaGVtYXMgdGhhdCBhcmUgcGxhaW4gb2JqZWN0czsgbm90IGFycmF5cy5cbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ2FqdicpLlNjaGVtYU9iamVjdCAmIHtba2V5OiBudW1iZXJdOiBuZXZlcn19IFNjaGVtYU9iamVjdFxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vZXh0LWNvbmZpZy1pbycpLkV4dGVuc2lvblR5cGV9IEV4dGVuc2lvblR5cGVcbiAqL1xuXG4vKipcbiAqIEFuIG9iamVjdCBoYXZpbmcgcHJvcGVydHkgYGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiBmYWxzZWBcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0cmljdFByb3BcbiAqIEBwcm9wZXJ0eSB7ZmFsc2V9IGFkZGl0aW9uYWxQcm9wZXJ0aWVzXG4gKi9cblxuLyoqXG4gKiBBIHtAbGluayBTY2hlbWFPYmplY3R9IHdpdGggYGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiBmYWxzZWBcbiAqIEB0eXBlZGVmIHtTY2hlbWFPYmplY3QgJiBTdHJpY3RQcm9wfSBTdHJpY3RTY2hlbWFPYmplY3RcbiAqL1xuXG4vKipcbiAqIEEgbGlzdCBvZiBzY2hlbWFzIGFzc29jaWF0ZWQgd2l0aCBwcm9wZXJ0aWVzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIHtAbGluayBBcmdTcGVjfSBvYmplY3RzLlxuICpcbiAqIEludGVybWVkaWF0ZSBkYXRhIHN0cnVjdHVyZSB1c2VkIHdoZW4gY29udmVydGluZyB0aGUgZW50aXJlIHNjaGVtYSBkb3duIHRvIENMSSBhcmd1bWVudHMuXG4gKiBAdHlwZWRlZiB7IHtzY2hlbWE6IFNjaGVtYU9iamVjdCwgYXJnU3BlYzogQXJnU3BlY31bXSB9IEZsYXR0ZW5lZFNjaGVtYVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge0FyZ1NwZWNbJ2RlZmF1bHRWYWx1ZSddfSBBcmdTcGVjRGVmYXVsdFZhbHVlXG4gKi9cblxuLyoqXG4gKiBlLmcuIGB7ZHJpdmVyOiB7Zm9vOiAnYmFyJ319YCB3aGVyZSBgZm9vYCBpcyB0aGUgYXJnIG5hbWUgYW5kIGBiYXJgIGlzIHRoZSBkZWZhdWx0IHZhbHVlLlxuICogQHR5cGVkZWYge1JlY29yZDxzdHJpbmcsUmVjb3JkPHN0cmluZyxBcmdTcGVjRGVmYXVsdFZhbHVlPj59IE5lc3RlZEFyZ1NwZWNEZWZhdWx0VmFsdWVcbiAqL1xuXG4vKipcbiAqIEhlbHBlciB0eXBlIGZvciB0aGUgcmV0dXJuIHZhbHVlIG9mIHtAbGluayBBcHBpdW1TY2hlbWEuZ2V0RGVmYXVsdHN9XG4gKiBAdGVtcGxhdGUge2Jvb2xlYW58dW5kZWZpbmVkfSBGbGF0dGVuZWRcbiAqIEB0eXBlZGVmIHtSZWNvcmQ8c3RyaW5nLEZsYXR0ZW5lZCBleHRlbmRzIHRydWUgPyBBcmdTcGVjRGVmYXVsdFZhbHVlIDogQXJnU3BlY0RlZmF1bHRWYWx1ZSB8IE5lc3RlZEFyZ1NwZWNEZWZhdWx0VmFsdWU+fSBEZWZhdWx0VmFsdWVzXG4gKi9cbiJdLCJmaWxlIjoibGliL3NjaGVtYS9zY2hlbWEuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
