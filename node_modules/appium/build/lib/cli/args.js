"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "APPIUM_HOME", {
  enumerable: true,
  get: function () {
    return _extensionConfig.APPIUM_HOME;
  }
});
exports.getExtensionArgs = exports.driverConfig = exports.USE_ALL_PLUGINS = void 0;
exports.getServerArgs = getServerArgs;
exports.pluginConfig = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _driverConfig = _interopRequireDefault(require("../driver-config"));

var _extensionConfig = require("../extension-config");

var _pluginConfig = _interopRequireDefault(require("../plugin-config"));

var _cliArgs = require("../schema/cli-args");

const DRIVER_EXAMPLE = 'xcuitest';
const PLUGIN_EXAMPLE = 'find_by_image';
const USE_ALL_PLUGINS = 'all';
exports.USE_ALL_PLUGINS = USE_ALL_PLUGINS;
const EXTENSION_TYPES = new Set([_extensionConfig.DRIVER_TYPE, _extensionConfig.PLUGIN_TYPE]);

const driverConfig = _driverConfig.default.getInstance(_extensionConfig.APPIUM_HOME);

exports.driverConfig = driverConfig;

const pluginConfig = _pluginConfig.default.getInstance(_extensionConfig.APPIUM_HOME);

exports.pluginConfig = pluginConfig;
const globalExtensionArgs = new Map([[['--json'], {
  required: false,
  default: false,
  action: 'store_true',
  help: 'Use JSON for output format',
  dest: 'json'
}]]);

const getExtensionArgs = _lodash.default.once(function getExtensionArgs() {
  const extensionArgs = {};

  for (const type of EXTENSION_TYPES) {
    extensionArgs[type] = {
      list: makeListArgs(type),
      install: makeInstallArgs(type),
      uninstall: makeUninstallArgs(type),
      update: makeUpdateArgs(type),
      run: makeRunArgs(type)
    };
  }

  return extensionArgs;
});

exports.getExtensionArgs = getExtensionArgs;

function makeListArgs(type) {
  return new Map([...globalExtensionArgs, [['--installed'], {
    required: false,
    default: false,
    action: 'store_true',
    help: `List only installed ${type}s`,
    dest: 'showInstalled'
  }], [['--updates'], {
    required: false,
    default: false,
    action: 'store_true',
    help: 'Show information about newer versions',
    dest: 'showUpdates'
  }]]);
}

function makeInstallArgs(type) {
  return new Map([...globalExtensionArgs, [[type], {
    type: 'str',
    help: `Name of the ${type} to install, for example: ` + type === _extensionConfig.DRIVER_TYPE ? DRIVER_EXAMPLE : PLUGIN_EXAMPLE
  }], [['--source'], {
    required: false,
    default: null,
    choices: _extensionConfig.INSTALL_TYPES,
    help: `Where to look for the ${type} if it is not one of Appium's verified ` + `${type}s. Possible values: ${_extensionConfig.INSTALL_TYPES.join(', ')}`,
    dest: 'installType'
  }], [['--package'], {
    required: false,
    default: null,
    type: 'str',
    help: `If installing from Git or GitHub, the package name, as defined in the plugin's ` + `package.json file in the "name" field, cannot be determined automatically, and ` + `should be reported here, otherwise the install will probably fail.`,
    dest: 'packageName'
  }]]);
}

function makeUninstallArgs(type) {
  return new Map([...globalExtensionArgs, [[type], {
    type: 'str',
    help: 'Name of the driver to uninstall, for example: ' + type === _extensionConfig.DRIVER_TYPE ? DRIVER_EXAMPLE : PLUGIN_EXAMPLE
  }]]);
}

function makeUpdateArgs(type) {
  return new Map([...globalExtensionArgs, [[type], {
    type: 'str',
    help: `Name of the ${type} to update, or the word "installed" to update all installed ` + `${type}s. To see available updates, run "appium ${type} list --installed --updates". ` + 'For example: ' + type === _extensionConfig.DRIVER_TYPE ? DRIVER_EXAMPLE : PLUGIN_EXAMPLE
  }], [['--unsafe'], {
    required: false,
    default: false,
    action: 'store_true',
    help: `Include updates that might have a new major revision, and potentially include ` + `breaking changes`
  }]]);
}

function makeRunArgs(type) {
  return new Map([...globalExtensionArgs, [[type], {
    type: 'str',
    help: `Name of the ${type} to run a script from, for example: ` + type === _extensionConfig.DRIVER_TYPE ? DRIVER_EXAMPLE : PLUGIN_EXAMPLE
  }], [['scriptName'], {
    default: null,
    type: 'str',
    help: `Name of the script to run from the ${type}. The script name must be cached ` + `inside the "scripts" field under "appium" inside the ${type}'s "package.json" file`
  }]]);
}

function getServerArgs() {
  return new Map([...(0, _cliArgs.toParserArgs)(), ...serverArgsDisallowedInConfig]);
}

const serverArgsDisallowedInConfig = new Map([[['--shell'], {
  required: false,
  help: 'Enter REPL mode',
  action: 'store_const',
  const: true,
  dest: 'shell'
}], [['--show-build-info'], {
  dest: 'showBuildInfo',
  action: 'store_const',
  const: true,
  required: false,
  help: 'Show info about the Appium build and exit'
}], [['--show-config'], {
  dest: 'showConfig',
  action: 'store_const',
  const: true,
  required: false,
  help: 'Show the current Appium configuration and exit'
}], [['--config'], {
  dest: 'configFile',
  type: 'string',
  required: false,
  help: 'Explicit path to Appium configuration file'
}]]);require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jbGkvYXJncy5qcyJdLCJuYW1lcyI6WyJEUklWRVJfRVhBTVBMRSIsIlBMVUdJTl9FWEFNUExFIiwiVVNFX0FMTF9QTFVHSU5TIiwiRVhURU5TSU9OX1RZUEVTIiwiU2V0IiwiRFJJVkVSX1RZUEUiLCJQTFVHSU5fVFlQRSIsImRyaXZlckNvbmZpZyIsIkRyaXZlckNvbmZpZyIsImdldEluc3RhbmNlIiwiQVBQSVVNX0hPTUUiLCJwbHVnaW5Db25maWciLCJQbHVnaW5Db25maWciLCJnbG9iYWxFeHRlbnNpb25BcmdzIiwiTWFwIiwicmVxdWlyZWQiLCJkZWZhdWx0IiwiYWN0aW9uIiwiaGVscCIsImRlc3QiLCJnZXRFeHRlbnNpb25BcmdzIiwiXyIsIm9uY2UiLCJleHRlbnNpb25BcmdzIiwidHlwZSIsImxpc3QiLCJtYWtlTGlzdEFyZ3MiLCJpbnN0YWxsIiwibWFrZUluc3RhbGxBcmdzIiwidW5pbnN0YWxsIiwibWFrZVVuaW5zdGFsbEFyZ3MiLCJ1cGRhdGUiLCJtYWtlVXBkYXRlQXJncyIsInJ1biIsIm1ha2VSdW5BcmdzIiwiY2hvaWNlcyIsIklOU1RBTExfVFlQRVMiLCJqb2luIiwiZ2V0U2VydmVyQXJncyIsInNlcnZlckFyZ3NEaXNhbGxvd2VkSW5Db25maWciLCJjb25zdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLGNBQWMsR0FBRyxVQUF2QjtBQUNBLE1BQU1DLGNBQWMsR0FBRyxlQUF2QjtBQUNBLE1BQU1DLGVBQWUsR0FBRyxLQUF4Qjs7QUFHQSxNQUFNQyxlQUFlLEdBQUcsSUFBSUMsR0FBSixDQUFRLENBQUNDLDRCQUFELEVBQWNDLDRCQUFkLENBQVIsQ0FBeEI7O0FBRUEsTUFBTUMsWUFBWSxHQUFHQyxzQkFBYUMsV0FBYixDQUF5QkMsNEJBQXpCLENBQXJCOzs7O0FBQ0EsTUFBTUMsWUFBWSxHQUFHQyxzQkFBYUgsV0FBYixDQUF5QkMs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VDtBQUlFekIsRUFBQUEsUUFBUSxFQUFFLEtBSlo7QUFLRUcsRUFBQUEsSUFBSSxFQUFFO0FBTFIsQ0FGRixDQXJCMkMsRUErQjNDLENBQ0UsQ0FBQyxVQUFELENBREYsRUFFRTtBQUNFQyxFQUFBQSxJQUFJLEVBQUUsWUFEUjtBQUVFSyxFQUFBQSxJQUFJLEVBQUUsUUFGUjtBQUdFVCxFQUFBQSxRQUFRLEVBQUUsS0FIWjtBQUlFRyxFQUFBQSxJQUFJLEVBQUU7QUFKUixDQUZGLENBL0IyQyxDQUFSLENBQXJDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWNoZWNrXG5cbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgRHJpdmVyQ29uZmlnIGZyb20gJy4uL2RyaXZlci1jb25maWcnO1xuaW1wb3J0IHsgQVBQSVVNX0hPTUUsIERSSVZFUl9UWVBFLCBJTlNUQUxMX1RZUEVTLCBQTFVHSU5fVFlQRSB9IGZyb20gJy4uL2V4dGVuc2lvbi1jb25maWcnO1xuaW1wb3J0IFBsdWdpbkNvbmZpZyBmcm9tICcuLi9wbHVnaW4tY29uZmlnJztcbmltcG9ydCB7IHRvUGFyc2VyQXJncyB9IGZyb20gJy4uL3NjaGVtYS9jbGktYXJncyc7XG5cbmNvbnN0IERSSVZFUl9FWEFNUExFID0gJ3hjdWl0ZXN0JztcbmNvbnN0IFBMVUdJTl9FWEFNUExFID0gJ2ZpbmRfYnlfaW1hZ2UnO1xuY29uc3QgVVNFX0FMTF9QTFVHSU5TID0gJ2FsbCc7XG5cbi8qKiBAdHlwZSB7U2V0PEV4dGVuc2lvblR5cGU+fSAqL1xuY29uc3QgRVhURU5TSU9OX1RZUEVTID0gbmV3IFNldChbRFJJVkVSX1RZUEUsIFBMVUdJTl9UWVBFXSk7XG5cbmNvbnN0IGRyaXZlckNvbmZpZyA9IERyaXZlckNvbmZpZy5nZXRJbnN0YW5jZShBUFBJVU1fSE9NRSk7XG5jb25zdCBwbHVnaW5Db25maWcgPSBQbHVnaW5Db25maWcuZ2V0SW5zdGFuY2UoQVBQSVVNX0hPTUUpO1xuXG4vLyB0aGlzIHNldCBvZiBhcmdzIHdvcmtzIGZvciBib3RoIGRyaXZlcnMgYW5kIHBsdWdpbnMgKCdleHRlbnNpb25zJylcbi8qKiBAdHlwZSB7QXJndW1lbnREZWZpbml0aW9uc30gKi9cbmNvbnN0IGdsb2JhbEV4dGVuc2lvbkFyZ3MgPSBuZXcgTWFwKFtcbiAgW1snLS1qc29uJ10sIHtcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVmYXVsdDogZmFsc2UsXG4gICAgYWN0aW9uOiAnc3RvcmVfdHJ1ZScsXG4gICAgaGVscDogJ1VzZSBKU09OIGZvciBvdXRwdXQgZm9ybWF0JyxcbiAgICBkZXN0OiAnanNvbidcbiAgfV1cbl0pO1xuXG4vKipcbiAqIEJ1aWxkcyBhIFJlY29yZCBvZiBleHRlbnNpb24gdHlwZXMgdG8gYSBSZWNvcmQgb2Ygc3ViY29tbWFuZHMgdG8gdGhlaXIgYXJndW1lbnQgZGVmaW5pdGlvbnNcbiAqL1xuY29uc3QgZ2V0RXh0ZW5zaW9uQXJncyA9IF8ub25jZShmdW5jdGlvbiBnZXRFeHRlbnNpb25BcmdzICgpIHtcbiAgY29uc3QgZXh0ZW5zaW9uQXJncyA9IHt9O1xuICBmb3IgKGNvbnN0IHR5cGUgb2YgRVhURU5TSU9OX1RZUEVTKSB7XG4gICAgZXh0ZW5zaW9uQXJnc1t0eXBlXSA9IHtcbiAgICAgIGxpc3Q6IG1ha2VMaXN0QXJncyh0eXBlKSxcbiAgICAgIGluc3RhbGw6IG1ha2VJbnN0YWxsQXJncyh0eXBlKSxcbiAgICAgIHVuaW5zdGFsbDogbWFrZVVuaW5zdGFsbEFyZ3ModHlwZSksXG4gICAgICB1cGRhdGU6IG1ha2VVcGRhdGVBcmdzKHR5cGUpLFxuICAgICAgcnVuOiBtYWtlUnVuQXJncyh0eXBlKSxcbiAgICB9O1xuICB9XG4gIHJldHVybiAvKiogQHR5cGUge1JlY29yZDxFeHRlbnNpb25UeXBlLCBSZWNvcmQ8c3RyaW5nLEFyZ3VtZW50RGVmaW5pdGlvbnNbXT4+fSAqLyAoZXh0ZW5zaW9uQXJncyk7XG59KTtcblxuLyoqXG4gKiBNYWtlcyB0aGUgb3B0cyBmb3IgdGhlIGBsaXN0YCBzdWJjb21tYW5kIGZvciBlYWNoIGV4dGVuc2lvbiB0eXBlLlxuICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSB0eXBlXG4gKiBAcmV0dXJucyB7QXJndW1lbnREZWZpbml0aW9uc31cbiAqL1xuZnVuY3Rpb24gbWFrZUxpc3RBcmdzICh0eXBlKSB7XG4gIHJldHVybiBuZXcgTWFwKFtcbiAgICAuLi5nbG9iYWxFeHRlbnNpb25BcmdzLFxuICAgIFtbJy0taW5zdGFsbGVkJ10sIHtcbiAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgYWN0aW9uOiAnc3RvcmVfdHJ1ZScsXG4gICAgICBoZWxwOiBgTGlzdCBvbmx5IGluc3RhbGxlZCAke3R5cGV9c2AsXG4gICAgICBkZXN0OiAnc2hvd0luc3RhbGxlZCdcbiAgICB9XSxcbiAgICBbWyctLXVwZGF0ZXMnXSwge1xuICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICBhY3Rpb246ICdzdG9yZV90cnVlJyxcbiAgICAgIGhlbHA6ICdTaG93IGluZm9ybWF0aW9uIGFib3V0IG5ld2VyIHZlcnNpb25zJyxcbiAgICAgIGRlc3Q6ICdzaG93VXBkYXRlcydcbiAgICB9XVxuICBdKTtcbn1cblxuLyoqXG4gKiBNYWtlcyB0aGUgb3B0cyBmb3IgdGhlIGBpbnN0YWxsYCBzdWJjb21tYW5kIGZvciBlYWNoIGV4dGVuc2lvbiB0eXBlXG4gKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IHR5cGVcbiAqIEByZXR1cm5zIHtBcmd1bWVudERlZmluaXRpb25zfVxuICovXG5mdW5jdGlvbiBtYWtlSW5zdGFsbEFyZ3MgKHR5cGUpIHtcbiAgcmV0dXJuIG5ldyBNYXAoW1xuICAgIC4uLmdsb2JhbEV4dGVuc2lvbkFyZ3MsXG4gICAgW1t0eXBlXSwge1xuICAgICAgdHlwZTogJ3N0cicsXG4gICAgICBoZWxwOiBgTmFtZSBvZiB0aGUgJHt0eXBlfSB0byBpbnN0YWxsLCBmb3IgZXhhbXBsZTogYCArXG4gICAgICAgICAgICB0eXBlID09PSBEUklWRVJfVFlQRSA/IERSSVZFUl9FWEFNUExFIDogUExVR0lOX0VYQU1QTEUsXG4gICAgfV0sXG4gICAgW1snLS1zb3VyY2UnXSwge1xuICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgIGNob2ljZXM6IElOU1RBTExfVFlQRVMsXG4gICAgICBoZWxwOiBgV2hlcmUgdG8gbG9vayBmb3IgdGhlICR7dHlwZX0gaWYgaXQgaXMgbm90IG9uZSBvZiBBcHBpdW0ncyB2ZXJpZmllZCBgICtcbiAgICAgICAgICAgIGAke3R5cGV9cy4gUG9zc2libGUgdmFsdWVzOiAke0lOU1RBTExfVFlQRVMuam9pbignLCAnKX1gLFxuICAgICAgZGVzdDogJ2luc3RhbGxUeXBlJ1xuICAgIH1dLFxuICAgIFtbJy0tcGFja2FnZSddLCB7XG4gICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgdHlwZTogJ3N0cicsXG4gICAgICBoZWxwOiBgSWYgaW5zdGFsbGluZyBmcm9tIEdpdCBvciBHaXRIdWIsIHRoZSBwYWNrYWdlIG5hbWUsIGFzIGRlZmluZWQgaW4gdGhlIHBsdWdpbidzIGAgK1xuICAgICAgICAgICAgYHBhY2thZ2UuanNvbiBmaWxlIGluIHRoZSBcIm5hbWVcIiBmaWVsZCwgY2Fubm90IGJlIGRldGVybWluZWQgYXV0b21hdGljYWxseSwgYW5kIGAgK1xuICAgICAgICAgICAgYHNob3VsZCBiZSByZXBvcnRlZCBoZXJlLCBvdGhlcndpc2UgdGhlIGluc3RhbGwgd2lsbCBwcm9iYWJseSBmYWlsLmAsXG4gICAgICBkZXN0OiAncGFja2FnZU5hbWUnLFxuICAgIH1dLFxuICBdKTtcbn1cblxuXG4vKipcbiAqIE1ha2VzIHRoZSBvcHRzIGZvciB0aGUgYHVuaW5zdGFsbGAgc3ViY29tbWFuZCBmb3IgZWFjaCBleHRlbnNpb24gdHlwZVxuICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSB0eXBlXG4gKiBAcmV0dXJucyB7QXJndW1lbnREZWZpbml0aW9uc31cbiAqL1xuZnVuY3Rpb24gbWFrZVVuaW5zdGFsbEFyZ3MgKHR5cGUpIHtcbiAgcmV0dXJuIG5ldyBNYXAoW1xuICAgIC4uLmdsb2JhbEV4dGVuc2lvbkFyZ3MsXG4gICAgW1t0eXBlXSwge1xuICAgICAgdHlwZTogJ3N0cicsXG4gICAgICBoZWxwOiAnTmFtZSBvZiB0aGUgZHJpdmVyIHRvIHVuaW5zdGFsbCwgZm9yIGV4YW1wbGU6ICcgK1xuICAgICAgICAgICAgdHlwZSA9PT0gRFJJVkVSX1RZUEUgPyBEUklWRVJfRVhBTVBMRSA6IFBMVUdJTl9FWEFNUExFXG4gICAgfV0sXG4gIF0pO1xufVxuXG4vKipcbiAqIE1ha2VzIHRoZSBvcHRzIGZvciB0aGUgYHVwZGF0ZWAgc3ViY29tbWFuZCBmb3IgZWFjaCBleHRlbnNpb24gdHlwZVxuICogQHBhcmFtIHtFeHRlbnNpb25UeXBlfSB0eXBlXG4gKiBAcmV0dXJucyB7QXJndW1lbnREZWZpbml0aW9uc31cbiAqL1xuZnVuY3Rpb24gbWFrZVVwZGF0ZUFyZ3MgKHR5cGUpIHtcbiAgcmV0dXJuIG5ldyBNYXAoW1xuICAgIC4uLmdsb2JhbEV4dGVuc2lvbkFyZ3MsXG4gICAgW1t0eXBlXSwge1xuICAgICAgdHlwZTogJ3N0cicsXG4gICAgICBoZWxwOiBgTmFtZSBvZiB0aGUgJHt0eXBlfSB0byB1cGRhdGUsIG9yIHRoZSB3b3JkIFwiaW5zdGFsbGVkXCIgdG8gdXBkYXRlIGFsbCBpbnN0YWxsZWQgYCArXG4gICAgICAgICAgICBgJHt0eXBlfXMuIFRvIHNlZSBhdmFpbGFibGUgdXBkYXRlcywgcnVuIFwiYXBwaXVtICR7dHlwZX0gbGlzdCAtLWluc3RhbGxlZCAtLXVwZGF0ZXNcIi4gYCArXG4gICAgICAgICAgICAnRm9yIGV4YW1wbGU6ICcgKyB0eXBlID09PSBEUklWRVJfVFlQRSA/IERSSVZFUl9FWEFNUExFIDogUExVR0lOX0VYQU1QTEUsXG4gICAgfV0sXG4gICAgW1snLS11bnNhZmUnXSwge1xuICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICBhY3Rpb246ICdzdG9yZV90cnVlJyxcbiAgICAgIGhlbHA6IGBJbmNsdWRlIHVwZGF0ZXMgdGhhdCBtaWdodCBoYXZlIGEgbmV3IG1ham9yIHJldmlzaW9uLCBhbmQgcG90ZW50aWFsbHkgaW5jbHVkZSBgICtcbiAgICAgICAgICAgIGBicmVha2luZyBjaGFuZ2VzYCxcbiAgICB9XSxcbiAgXSk7XG59XG5cbi8qKlxuICogTWFrZXMgdGhlIG9wdHMgZm9yIHRoZSBgcnVuYCBzdWJjb21tYW5kIGZvciBlYWNoIGV4dGVuc2lvbiB0eXBlXG4gKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IHR5cGVcbiAqIEByZXR1cm5zIHtBcmd1bWVudERlZmluaXRpb25zfVxuICovXG5mdW5jdGlvbiBtYWtlUnVuQXJncyAodHlwZSkge1xuICByZXR1cm4gbmV3IE1hcChbXG4gICAgLi4uZ2xvYmFsRXh0ZW5zaW9uQXJncyxcbiAgICBbW3R5cGVdLCB7XG4gICAgICB0eXBlOiAnc3RyJyxcbiAgICAgIGhlbHA6IGBOYW1lIG9mIHRoZSAke3R5cGV9IHRvIHJ1biBhIHNjcmlwdCBmcm9tLCBmb3IgZXhhbXBsZTogYCArXG4gICAgICAgICAgICB0eXBlID09PSBEUklWRVJfVFlQRSA/IERSSVZFUl9FWEFNUExFIDogUExVR0lOX0VYQU1QTEUsXG4gICAgfV0sXG4gICAgW1snc2NyaXB0TmFtZSddLCB7XG4gICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgdHlwZTogJ3N0cicsXG4gICAgICBoZWxwOiBgTmFtZSBvZiB0aGUgc2NyaXB0IHRvIHJ1biBmcm9tIHRoZSAke3R5cGV9LiBUaGUgc2NyaXB0IG5hbWUgbXVzdCBiZSBjYWNoZWQgYCArXG4gICAgICAgICAgICBgaW5zaWRlIHRoZSBcInNjcmlwdHNcIiBmaWVsZCB1bmRlciBcImFwcGl1bVwiIGluc2lkZSB0aGUgJHt0eXBlfSdzIFwicGFja2FnZS5qc29uXCIgZmlsZWBcbiAgICB9XSxcbiAgXSk7XG59XG5cbi8qKlxuICogRGVyaXZlcyB0aGUgb3B0aW9ucyBmb3IgdGhlIGBzZXJ2ZXJgIGNvbW1hbmQgZnJvbSB0aGUgc2NoZW1hLCBhbmQgYWRkcyB0aGUgYXJndW1lbnRzXG4gKiB3aGljaCBhcmUgZGlzYWxsb3dlZCBpbiB0aGUgY29uZmlnIGZpbGUuXG4gKiBAcmV0dXJucyB7QXJndW1lbnREZWZpbml0aW9uc31cbiAqL1xuZnVuY3Rpb24gZ2V0U2VydmVyQXJncyAoKSB7XG4gIHJldHVybiBuZXcgTWFwKFtcbiAgICAuLi50b1BhcnNlckFyZ3MoKSxcbiAgICAuLi5zZXJ2ZXJBcmdzRGlzYWxsb3dlZEluQ29uZmlnLFxuICBdKTtcbn1cblxuLyoqXG4gKiBUaGVzZSBkb24ndCBtYWtlIHNlbnNlIGluIHRoZSBjb250ZXh0IG9mIGEgY29uZmlnIGZpbGUgZm9yIG9idmlvdXMgcmVhc29ucy5cbiAqIEB0eXBlIHtBcmd1bWVudERlZmluaXRpb25zfVxuICovXG5jb25zdCBzZXJ2ZXJBcmdzRGlzYWxsb3dlZEluQ29uZmlnID0gbmV3IE1hcChbXG4gIFtcbiAgICBbJy0tc2hlbGwnXSxcbiAgICB7XG4gICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICBoZWxwOiAnRW50ZXIgUkVQTCBtb2RlJyxcbiAgICAgIGFjdGlvbjogJ3N0b3JlX2NvbnN0JyxcbiAgICAgIGNvbnN0OiB0cnVlLFxuICAgICAgZGVzdDogJ3NoZWxsJyxcbiAgICB9LFxuICBdLFxuICBbXG4gICAgWyctLXNob3ctYnVpbGQtaW5mbyddLFxuICAgIHtcbiAgICAgIGRlc3Q6ICdzaG93QnVpbGRJbmZvJyxcbiAgICAgIGFjdGlvbjogJ3N0b3JlX2NvbnN0JyxcbiAgICAgIGNvbnN0OiB0cnVlLFxuICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgaGVscDogJ1Nob3cgaW5mbyBhYm91dCB0aGUgQXBwaXVtIGJ1aWxkIGFuZCBleGl0JyxcbiAgICB9LFxuICBdLFxuICBbXG4gICAgWyctLXNob3ctY29uZmlnJ10sXG4gICAge1xuICAgICAgZGVzdDogJ3Nob3dDb25maWcnLFxuICAgICAgYWN0aW9uOiAnc3RvcmVfY29uc3QnLFxuICAgICAgY29uc3Q6IHRydWUsXG4gICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICBoZWxwOiAnU2hvdyB0aGUgY3VycmVudCBBcHBpdW0gY29uZmlndXJhdGlvbiBhbmQgZXhpdCcsXG4gICAgfVxuICBdLFxuICBbXG4gICAgWyctLWNvbmZpZyddLFxuICAgIHtcbiAgICAgIGRlc3Q6ICdjb25maWdGaWxlJyxcbiAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgaGVscDogJ0V4cGxpY2l0IHBhdGggdG8gQXBwaXVtIGNvbmZpZ3VyYXRpb24gZmlsZScsXG4gICAgfSxcbiAgXSxcbl0pO1xuXG5leHBvcnQge1xuICBnZXRTZXJ2ZXJBcmdzLFxuICBnZXRFeHRlbnNpb25BcmdzLFxuICBVU0VfQUxMX1BMVUdJTlMsXG4gIGRyaXZlckNvbmZpZyxcbiAgcGx1Z2luQ29uZmlnLFxuICBBUFBJVU1fSE9NRVxufTtcblxuLyoqXG4gKiBBbGlhc1xuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vZXh0LWNvbmZpZy1pbycpLkV4dGVuc2lvblR5cGV9IEV4dGVuc2lvblR5cGVcbiAqL1xuXG4vKipcbiAqIEEgdHVwbGUgb2YgYXJndW1lbnQgYWxpYXNlcyBhbmQgYXJndW1lbnQgb3B0aW9uc1xuICogQHR5cGVkZWYge01hcDxzdHJpbmdbXSxpbXBvcnQoJ2FyZ3BhcnNlJykuQXJndW1lbnRPcHRpb25zPn0gQXJndW1lbnREZWZpbml0aW9uc1xuICovXG4iXSwiZmlsZSI6ImxpYi9jbGkvYXJncy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
