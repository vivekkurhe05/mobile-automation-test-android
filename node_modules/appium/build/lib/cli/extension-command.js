"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _npm = _interopRequireDefault(require("./npm"));

var _path = _interopRequireDefault(require("path"));

var _support = require("@appium/support");

var _utils = require("./utils");

var _teen_process = require("teen_process");

var _extensionConfig = require("../extension-config");

const UPDATE_ALL = 'installed';

class NotUpdatableError extends Error {}

class NoUpdatesAvailableError extends Error {}

class ExtensionCommand {
  constructor({
    config,
    json,
    type
  }) {
    this.config = config;
    this.type = type;
    this.isJsonOutput = json;
    this.npm = new _npm.default(this.config.appiumHome);
    this.knownExtensions = {};
  }

  async execute(args) {
    const cmd = args[`${this.type}Command`];

    if (!_lodash.default.isFunction(ExtensionCommand.prototype[cmd])) {
      throw new Error(`Cannot handle ${this.type} command ${cmd}`);
    }

    const executeCmd = this[cmd].bind(this);
    return await executeCmd(args);
  }

  async list({
    showInstalled,
    showUpdates
  }) {
    const lsMsg = `Listing ${showInstalled ? 'installed' : 'available'} ${this.type}s`;
    const installedNames = Object.keys(this.config.installedExtensions);
    const knownNames = Object.keys(this.knownExtensions);
    const exts = [...installedNames, ...knownNames].reduce((acc, name) => {
      if (!acc[name]) {
        if (installedNames.includes(name)) {
          acc[name] = { ...this.config.installedExtensions[name],
            installed: true
          };
        } else if (!showInstalled) {
          acc[name] = {
            pkgName: this.knownExtensions[name],
            installed: false
          };
        }
      }

      return acc;
    }, {});
    await (0, _utils.spinWith)(this.isJsonOutput, lsMsg, async () => {
      if (!showUpdates) {
        return;
      }

      for (const [ext, data] of _lodash.default.toPairs(exts)) {
        const {
          installed,
          installType
        } = data;

        if (!installed || installType !== _extensionConfig.INSTALL_TYPE_NPM) {
          continue;
        }

        const updates = await this.checkForExtensionUpdate(ext);
        data.updateVersion = updates.safeUpdate;
        data.unsafeUpdateVersion = updates.unsafeUpdate;
        data.upToDate = updates.safeUpdate === null && updates.unsafeUpdate === null;
      }
    });

    if (this.isJsonOutput) {
      return exts;
    }

    for (const [name, {
      installType,
      installSpec,
      installed,
      updateVersion,
      unsafeUpdateVersion,
      version,
      upToDate
    }] of _lodash.default.toPairs(exts)) {
      let typeTxt;

      switch (installType) {
        case _extensionConfig.INSTALL_TYPE_GIT:
        case _extensionConfig.INSTALL_TYPE_GITHUB:
          typeTxt = `(cloned from ${installSpec})`.yellow;
          break;

        case _extensionConfig.INSTALL_TYPE_LOCAL:
          typeTxt = `(linked from ${installSpec})`.magenta;
          break;

        default:
          typeTxt = '(NPM)';
      }

      const installTxt = installed ? `@${version.yellow} ${('[installed ' + typeTxt + ']').green}` : ' [not installed]'.grey;
      const updateTxt = showUpdates && updateVersion ? ` [${updateVersion} available]`.magenta : '';
      const upToDateTxt = showUpdates && upToDate ? ` [Up to date]`.green : '';
      const unsafeUpdateTxt = showUpdates && unsafeUpdateVersion ? ` [${unsafeUpdateVersion} available (potentially unsafe)]`.cyan : '';
      console.log(`- ${name.yellow}${installTxt}${updateTxt}${upToDateTxt}${unsafeUpdateTxt}`);
    }

    return exts;
  }

  async install({
    ext,
    installType,
    packageName
  }) {
    (0, _utils.log)(this.isJsonOutput, `Attempting to find and install ${this.type} '${ext}'`);
    let extData;
    let installSpec = ext;

    if (packageName && [_extensionConfig.INSTALL_TYPE_LOCAL, _extensionConfig.INSTALL_TYPE_NPM].includes(installType)) {
      throw new Error(`When using --source=${installType}, cannot also use --package`);
    }

    if (!packageName && [_extensionConfig.INSTALL_TYPE_GIT, _extensionConfig.INSTALL_TYPE_GITHUB].includes(installType)) {
      throw new Error(`When using --source=${installType}, must also use --package`);
    }

    if (installType === _extensionConfig.INSTALL_TYPE_LOCAL) {
      const msg = `Linking ${this.type} from local path`;
      const pkgJsonData = await (0, _utils.spinWith)(this.isJsonOutput, msg, async () => await this.npm.linkPackage(installSpec));
      extData = this.getExtensionFields(pkgJsonData);
      extData.installPath = extData.pkgName;
    } else if (installType === _extensionConfig.INSTALL_TYPE_GITHUB) {
      if (installSpec.split('/').length !== 2) {
        throw new Error(`Github ${this.type} spec ${installSpec} appeared to be invalid; ` + 'it should be of the form <org>/<repo>');
      }

      extData = await this.installViaNpm({
        ext: installSpec,
        pkgName: packageName
      });
    } else if (installType === _extensionConfig.INSTALL_TYPE_GIT) {
      installSpec = installSpec.replace(/\.git$/, '');
      extData = await this.installViaNpm({
        ext: installSpec,
        pkgName: packageName
      });
    } else {
      let name, pkgVer;
      const splits = installSpec.split('@');

      if (installSpec[0] === '@') {
        [name, pkgVer] = [`@${splits[1]}`, splits[2]];
      } else {
        [name, pkgVer] = splits;
      }

      let pkgName;

      if (installType === _extensionConfig.INSTALL_TYPE_NPM) {
        pkgName = name;
      } else {
        const knownNames = Object.keys(this.knownExtensions);

        if (!_lodash.default.includes(knownNames, name)) {
          const msg = `Could not resolve ${this.type}; are you sure it's in the list ` + `of supported ${this.type}s? ${JSON.stringify(knownNames)}`;
          throw new Error(msg);
        }

        pkgName = this.knownExtensions[name];
        installType = _extensionConfig.INSTALL_TYPE_NPM;
      }

      extData = await this.installViaNpm({
        ext,
        pkgName,
        pkgVer
      });
    }

    const extName = extData[`${this.type}Name`];
    delete extData[`${this.type}Name`];

    if (this.config.isInstalled(extName)) {
      throw new Error(`A ${this.type} named '${extName}' is already installed. ` + `Did you mean to update? 'appium ${this.type} update'. See ` + `installed ${this.type}s with 'appium ${this.type} list --installed'.`);
    }

    extData.installType = installType;
    extData.installSpec = installSpec;
    await this.config.addExtension(extName, extData);
    (0, _utils.log)(this.isJsonOutput, this.getPostInstallText({
      extName,
      extData
    }));
    return this.config.installedExtensions;
  }

  async installViaNpm({
    ext,
    pkgName,
    pkgVer
  }) {
    const npmSpec = `${pkgName}${pkgVer ? '@' + pkgVer : ''}`;
    const specMsg = npmSpec === ext ? '' : ` using NPM install spec '${npmSpec}'`;
    const msg = `Installing '${ext}'${specMsg}`;

    try {
      const pkgJsonData = await (0, _utils.spinWith)(this.isJsonOutput, msg, async () => await this.npm.installPackage({
        pkgDir: _path.default.resolve(this.config.appiumHome, pkgName),
        pkgName,
        pkgVer
      }));
      const extData = this.getExtensionFields(pkgJsonData);
      extData.installPath = pkgName;
      return extData;
    } catch (err) {
      throw new Error(`Encountered an error when installing package: ${err.message}`);
    }
  }

  getPostInstallText() {
    throw new Error('Must be implemented in final class');
  }

  getExtensionFields(pkgJsonData) {
    if (!pkgJsonData.appium) {
      throw new Error(`Installed driver did not have an 'appium' section in its ` + `package.json file as expected`);
    }

    const {
      appium,
      name,
      version
    } = pkgJsonData;
    this.validateExtensionFields(appium);
    return { ...appium,
      pkgName: name,
      version
    };
  }

  validateExtensionFields() {
    throw new Error('Must be implemented in final class');
  }

  async uninstall({
    ext
  }) {
    if (!this.config.isInstalled(ext)) {
      throw new Error(`Can't uninstall ${this.type} '${ext}'; it is not installed`);
    }

    try {
      await _support.fs.rimraf(this.config.getInstallPath(ext));
    } finally {
      await this.config.removeExtension(ext);
    }

    (0, _utils.log)(this.isJsonOutput, `Successfully uninstalled ${this.type} '${ext}'`.green);
    return this.config.installedExtensions;
  }

  async update({
    ext,
    unsafe
  }) {
    const shouldUpdateAll = ext === UPDATE_ALL;

    if (!shouldUpdateAll && !this.config.isInstalled(ext)) {
      throw new Error(`The ${this.type} '${ext}' was not installed, so can't be updated`);
    }

    const extsToUpdate = shouldUpdateAll ? Object.keys(this.config.installedExtensions) : [ext];
    const errors = {};
    const updates = {};

    for (const e of extsToUpdate) {
      try {
        await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' is updatable`, () => {
          if (this.config.installedExtensions[e].installType !== _extensionConfig.INSTALL_TYPE_NPM) {
            throw new NotUpdatableError();
          }
        });
        const update = await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' needs an update`, async () => {
          const update = await this.checkForExtensionUpdate(e);

          if (!(update.safeUpdate || update.unsafeUpdate)) {
            throw new NoUpdatesAvailableError();
          }

          return update;
        });

        if (!unsafe && !update.safeUpdate) {
          throw new Error(`The ${this.type} '${e}' has a major revision update ` + `(${update.current} => ${update.unsafeUpdate}), which could include ` + `breaking changes. If you want to apply this update, re-run with --unsafe`);
        }

        const updateVer = unsafe && update.unsafeUpdate ? update.unsafeUpdate : update.safeUpdate;
        await (0, _utils.spinWith)(this.isJsonOutput, `Updating driver '${e}' from ${update.current} to ${updateVer}`, async () => await this.updateExtension(e, updateVer));
        updates[e] = {
          from: update.current,
          to: updateVer
        };
      } catch (err) {
        errors[e] = err;
      }
    }

    (0, _utils.log)(this.isJsonOutput, 'Update report:');

    for (const [e, update] of _lodash.default.toPairs(updates)) {
      (0, _utils.log)(this.isJsonOutput, `- ${this.type} ${e} updated: ${update.from} => ${update.to}`.green);
    }

    for (const [e, err] of _lodash.default.toPairs(errors)) {
      if (err instanceof NotUpdatableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' was not installed via npm, so we could not check ` + `for updates`.yellow);
      } else if (err instanceof NoUpdatesAvailableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' had no updates available`.yellow);
      } else {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' failed to update: ${err}`.red);
      }
    }

    return {
      updates,
      errors
    };
  }

  async checkForExtensionUpdate(ext) {
    const {
      version,
      pkgName
    } = this.config.installedExtensions[ext];
    let unsafeUpdate = await this.npm.getLatestVersion(pkgName);
    let safeUpdate = await this.npm.getLatestSafeUpgradeVersion(pkgName, version);

    if (!_support.util.compareVersions(unsafeUpdate, '>', version)) {
      unsafeUpdate = null;
      safeUpdate = null;
    }

    if (unsafeUpdate && unsafeUpdate === safeUpdate) {
      unsafeUpdate = null;
    }

    if (safeUpdate && !_support.util.compareVersions(safeUpdate, '>', version)) {
      safeUpdate = null;
    }

    return {
      current: version,
      safeUpdate,
      unsafeUpdate
    };
  }

  async updateExtension(ext, version) {
    const {
      pkgName
    } = this.config.installedExtensions[ext];
    await _support.fs.rimraf(this.config.getInstallPath(ext));
    const extData = await this.installViaNpm({
      ext,
      pkgName,
      pkgVer: version
    });
    delete extData[`${this.type}Name`];
    await this.config.updateExtension(ext, extData);
  }

  async run({
    ext,
    scriptName
  }) {
    if (!_lodash.default.has(this.config.installedExtensions, ext)) {
      throw new Error(`please install the ${this.type} first`);
    }

    const extConfig = this.config.installedExtensions[ext];

    if (!_lodash.default.has(extConfig, 'scripts')) {
      throw new Error(`The ${this.type} named '${ext}' does not contain the ` + `"scripts" field underneath the "appium" field in its package.json`);
    }

    const extScripts = extConfig.scripts;

    if (!_lodash.default.isPlainObject(extScripts)) {
      throw new Error(`The ${this.type} named '${ext}' "scripts" field must be a plain object`);
    }

    if (!_lodash.default.has(extScripts, scriptName)) {
      throw new Error(`The ${this.type} named '${ext}' does not support the script: '${scriptName}'`);
    }

    const runner = new _teen_process.SubProcess(process.execPath, [extScripts[scriptName]], {
      cwd: this.config.getExtensionRequirePath(ext)
    });
    const output = new _utils.RingBuffer(50);
    runner.on('stream-line', line => {
      output.enqueue(line);
      (0, _utils.log)(this.isJsonOutput, line);
    });
    await runner.start(0);

    try {
      await runner.join();
      (0, _utils.log)(this.isJsonOutput, `${scriptName} successfully ran`.green);
      return {
        output: output.getBuff()
      };
    } catch (err) {
      (0, _utils.log)(this.isJsonOutput, `Encountered an error when running '${scriptName}': ${err.message}`.red);
      return {
        error: err.message,
        output: output.getBuff()
      };
    }
  }

}

exports.default = ExtensionCommand;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jbGkvZXh0ZW5zaW9uLWNvbW1hbmQuanMiXSwibmFtZXMiOlsiVVBEQVRFX0FMTCIsIk5vdFVwZGF0YWJsZUVycm9yIiwiRXJyb3IiLCJOb1VwZGF0ZXNBdmFpbGFibGVFcnJvciIsIkV4dGVuc2lvbkNvbW1hbmQiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImpzb24iLCJ0eXBlIiwiaXNKc29uT3V0cHV0IiwibnBtIiwiTlBNIiwiYXBwaXVtSG9tZSIsImtub3duRXh0ZW5zaW9ucyIsImV4ZWN1dGUiLCJhcmdzIiwiY21kIiwiXyIsImlzRnVuY3Rpb24iLCJwcm90b3R5cGUiLCJleGVjdXRlQ21kIiwiYmluZCIsImxpc3QiLCJzaG93SW5zdGFsbGVkIiwic2hvd1VwZGF0ZXMiLCJsc01zZyIsImluc3RhbGxlZE5hbWVzIiwiT2JqZWN0Iiwia2V5cyIsImluc3RhbGxlZEV4dGVuc2lvbnMiLCJrbm93bk5hbWVzIiwiZXh0cyIsInJlZHVjZSIsImFjYyIsIm5hbWUiLCJpbmNsdWRlcyIsImluc3RhbGxlZCIsInBrZ05hbWUiLCJleHQiLCJkYXRhIiwidG9QYWlycyIsImluc3RhbGxUeXBlIiwiSU5TVEFMTF9UWVBFX05QTSIsInVwZGF0ZXMiLCJjaGVja0ZvckV4dGVuc2lvblVwZGF0ZSIsInVwZGF0ZVZlcnNpb24iLCJzYWZlVXBkYXRlIiwidW5zYWZlVXBkYXRlVmVyc2lvbiIsInVuc2FmZVVwZGF0ZSIsInVwVG9EYXRlIiwiaW5zdGFsbFNwZWMiLCJ2ZXJzaW9uIiwidHlwZVR4dCIsIklOU1RBTExfVFlQRV9HSVQiLCJJTlNUQUxMX1RZUEVfR0lUSFVCIiwieWVsbG93IiwiSU5TVEFMTF9UWVBFX0xPQ0FMIiwibWFnZW50YSIsImluc3RhbGxUeHQiLCJncmVlbiIsImdyZXkiLCJ1cGRhdGVUeHQiLCJ1cFRvRGF0ZVR4dCIsInVuc2FmZVVwZGF0ZVR4dCIsImN5YW4iLCJjb25zb2xlIiwibG9nIiwiaW5zdGFsbCIsInBhY2thZ2VOYW1lIiwiZXh0RGF0YSIsIm1zZyIsInBrZ0pzb25EYXRhIiwibGlua1BhY2thZ2UiLCJnZXRFeHRlbnNpb25GaWVsZHMiLCJpbnN0YWxsUGF0aCIsInNwbGl0IiwibGVuZ3RoIiwiaW5zdGFsbFZpYU5wbSIsInJlcGxhY2UiLCJwa2dWZXIiLCJzcGxpdHMiLCJKU09OIiwic3RyaW5naWZ5IiwiZXh0TmFtZSIsImlzSW5zdGFsbGVkIiwiYWRkRXh0ZW5zaW9uIiwiZ2V0UG9zdEluc3RhbGxUZXh0IiwibnBtU3BlYyIsInNwZWNNc2ciLCJpbnN0YWxsUGFja2FnZSIsInBrZ0RpciIsInBhdGgiLCJyZXNvbHZlIiwiZXJyIiwibWVzc2FnZSIsImFwcGl1bSIsInZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzIiwidW5pbnN0YWxsIiwiZnMiLCJyaW1yYWYiLCJnZXRJbnN0YWxsUGF0aCIsInJlbW92ZUV4dGVuc2lvbiIsInVwZGF0ZSIsInVuc2FmZSIsInNob3VsZFVwZGF0ZUFsbCIsImV4dHNUb1VwZGF0ZSIsImVycm9ycyIsImUiLCJjdXJyZW50IiwidXBkYXRlVmVyIiwidXBkYXRlRXh0ZW5zaW9uIiwiZnJvbSIsInRvIiwicmVkIiwiZ2V0TGF0ZXN0VmVyc2lvbiIsImdldExhdGVzdFNhZmVVcGdyYWRlVmVyc2lvbiIsInV0aWwiLCJjb21wYXJlVmVyc2lvbnMiLCJydW4iLCJzY3JpcHROYW1lIiwiaGFzIiwiZXh0Q29uZmlnIiwiZXh0U2NyaXB0cyIsInNjcmlwdHMiLCJpc1BsYWluT2JqZWN0IiwicnVubmVyIiwiU3ViUHJvY2VzcyIsInByb2Nlc3MiLCJleGVjUGF0aCIsImN3ZCIsImdldEV4dGVuc2lvblJlcXVpcmVQYXRoIiwib3V0cHV0IiwiUmluZ0J1ZmZlciIsIm9uIiwibGluZSIsImVucXVldWUiLCJzdGFydCIsImpvaW4iLCJnZXRCdWZmIiwiZXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsVUFBVSxHQUFH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QUFQO0FBQVQsT0FBUDtBQUNELEtBSkQsQ0FJRSxPQUFPN0MsR0FBUCxFQUFZO0FBQ1osc0JBQUksS0FBS3BGLFlBQVQsRUFBd0Isc0NBQXFDOEcsVUFBVyxNQUFLMUIsR0FBRyxDQUFDQyxPQUFRLEVBQWxFLENBQW9FbUIsR0FBM0Y7QUFDQSxhQUFPO0FBQUMwQixRQUFBQSxLQUFLLEVBQUU5QyxHQUFHLENBQUNDLE9BQVo7QUFBcUJxQyxRQUFBQSxNQUFNLEVBQUVBLE1BQU0sQ0FBQ08sT0FBUDtBQUE3QixPQUFQO0FBQ0Q7QUFDRjs7QUFsaEJtQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBOUE0gZnJvbSAnLi9ucG0nO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmcywgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgeyBsb2csIHNwaW5XaXRoLCBSaW5nQnVmZmVyIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBTdWJQcm9jZXNzfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgSU5TVEFMTF9UWVBFX05QTSwgSU5TVEFMTF9UWVBFX0dJVCwgSU5TVEFMTF9UWVBFX0dJVEhVQixcbiAgICAgICAgIElOU1RBTExfVFlQRV9MT0NBTCB9IGZyb20gJy4uL2V4dGVuc2lvbi1jb25maWcnO1xuXG5jb25zdCBVUERBVEVfQUxMID0gJ2luc3RhbGxlZCc7XG5cbmNsYXNzIE5vdFVwZGF0YWJsZUVycm9yIGV4dGVuZHMgRXJyb3Ige31cbmNsYXNzIE5vVXBkYXRlc0F2YWlsYWJsZUVycm9yIGV4dGVuZHMgRXJyb3Ige31cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXh0ZW5zaW9uQ29tbWFuZCB7XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEV4dGVuc2lvbkNvbW1hbmRDb25zdHJ1Y3RvclxuICAgKiBAcHJvcGVydHkge09iamVjdH0gY29uZmlnIC0gdGhlIERyaXZlckNvbmZpZyBvciBQbHVnaW5Db25maWcgb2JqZWN0IHVzZWQgZm9yIHRoaXMgY29tbWFuZFxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGpzb24gLSB3aGV0aGVyIHRoZSBvdXRwdXQgb2YgdGhpcyBjb21tYW5kIHNob3VsZCBiZSBKU09OIG9yIHRleHRcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHR5cGUgLSBEUklWRVJfVFlQRSBvciBQTFVHSU5fVFlQRVxuICAgKi9cblxuICAvKipcbiAgICogQnVpbGQgYW4gRXh0ZW5zaW9uQ29tbWFuZFxuICAgKlxuICAgKiBAcGFyYW0ge0V4dGVuc2lvbkNvbW1hbmRDb25zdHJ1Y3Rvcn0gb3B0c1xuICAgKiBAcmV0dXJuIHtFeHRlbnNpb25Db21tYW5kfVxuICAgKi9cbiAgY29uc3RydWN0b3IgKHtjb25maWcsIGpzb24sIHR5cGV9KSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLmlzSnNvbk91dHB1dCA9IGpzb247XG4gICAgdGhpcy5ucG0gPSBuZXcgTlBNKHRoaXMuY29uZmlnLmFwcGl1bUhvbWUpO1xuICAgIHRoaXMua25vd25FeHRlbnNpb25zID0ge307IC8vIHRoaXMgbmVlZHMgdG8gYmUgb3ZlcnJpZGRlbiBpbiBmaW5hbCBjbGFzc1xuICB9XG5cbiAgLyoqXG4gICAqIFRha2UgYSBDTEkgcGFyc2UgYW5kIHJ1biBhbiBleHRlbnNpb24gY29tbWFuZCBiYXNlZCBvbiBpdHMgdHlwZVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gYXJncyAtIGEga2V5L3ZhbHVlIG9iamVjdCB3aXRoIENMSSBmbGFncyBhbmQgdmFsdWVzXG4gICAqIEByZXR1cm4ge29iamVjdH0gdGhlIHJlc3VsdCBvZiB0aGUgc3BlY2lmaWMgY29tbWFuZCB3aGljaCBpcyBleGVjdXRlZFxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZSAoYXJncykge1xuICAgIGNvbnN0IGNtZCA9IGFyZ3NbYCR7dGhpcy50eXBlfUNvbW1hbmRgXTtcbiAgICBpZiAoIV8uaXNGdW5jdGlvbihFeHRlbnNpb25Db21tYW5kLnByb3RvdHlwZVtjbWRdKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgaGFuZGxlICR7dGhpcy50eXBlfSBjb21tYW5kICR7Y21kfWApO1xuICAgIH1cbiAgICBjb25zdCBleGVjdXRlQ21kID0gdGhpc1tjbWRdLmJpbmQodGhpcyk7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGVDbWQoYXJncyk7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gTGlzdEFyZ3NcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBzaG93SW5zdGFsbGVkIC0gd2hldGhlciBzaG91bGQgc2hvdyBvbmx5IGluc3RhbGxlZCBleHRlbnNpb25zXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gc2hvd1VwZGF0ZXMgLSB3aGV0aGVyIHNob3VsZCBzaG93IGF2YWlsYWJsZSB1cGRhdGVzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBMaXN0IGV4dGVuc2lvbnNcbiAgICpcbiAgICogQHBhcmFtIHtMaXN0QXJnc30gYXJnc1xuICAgKiBAcmV0dXJuIHtvYmplY3R9IG1hcCBvZiBleHRlbnNpb24gbmFtZXMgdG8gZXh0ZW5zaW9uIGRhdGFcbiAgICovXG4gIGFzeW5jIGxpc3QgKHtzaG93SW5zdGFsbGVkLCBzaG93VXBkYXRlc30pIHtcbiAgICBjb25zdCBsc01zZyA9IGBMaXN0aW5nICR7c2hvd0luc3RhbGxlZCA/ICdpbnN0YWxsZWQnIDogJ2F2YWlsYWJsZSd9ICR7dGhpcy50eXBlfXNgO1xuICAgIGNvbnN0IGluc3RhbGxlZE5hbWVzID0gT2JqZWN0LmtleXModGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucyk7XG4gICAgY29uc3Qga25vd25OYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMua25vd25FeHRlbnNpb25zKTtcbiAgICBjb25zdCBleHRzID0gWy4uLmluc3RhbGxlZE5hbWVzLCAuLi5rbm93bk5hbWVzXS5yZWR1Y2UoKGFjYywgbmFtZSkgPT4ge1xuICAgICAgaWYgKCFhY2NbbmFtZV0pIHtcbiAgICAgICAgaWYgKGluc3RhbGxlZE5hbWVzLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgICAgYWNjW25hbWVdID0gey4uLnRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnNbbmFtZV0sIGluc3RhbGxlZDogdHJ1ZX07XG4gICAgICAgIH0gZWxzZSBpZiAoIXNob3dJbnN0YWxsZWQpIHtcbiAgICAgICAgICBhY2NbbmFtZV0gPSB7cGtnTmFtZTogdGhpcy5rbm93bkV4dGVuc2lvbnNbbmFtZV0sIGluc3RhbGxlZDogZmFsc2V9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcblxuICAgIC8vIGlmIHdlIHdhbnQgdG8gc2hvdyB3aGV0aGVyIHVwZGF0ZXMgYXJlIGF2YWlsYWJsZSwgcHV0IHRoYXQgYmVoaW5kIGEgc3Bpbm5lclxuICAgIGF3YWl0IHNwaW5XaXRoKHRoaXMuaXNKc29uT3V0cHV0LCBsc01zZywgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFzaG93VXBkYXRlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IFtleHQsIGRhdGFdIG9mIF8udG9QYWlycyhleHRzKSkge1xuICAgICAgICBjb25zdCB7aW5zdGFsbGVkLCBpbnN0YWxsVHlwZX0gPSBkYXRhO1xuICAgICAgICBpZiAoIWluc3RhbGxlZCB8fCBpbnN0YWxsVHlwZSAhPT0gSU5TVEFMTF9UWVBFX05QTSkge1xuICAgICAgICAgIC8vIGRvbid0IG5lZWQgdG8gY2hlY2sgZm9yIHVwZGF0ZXMgb24gZXh0cyB0aGF0IGFyZW4ndCBpbnN0YWxsZWRcbiAgICAgICAgICAvLyBhbHNvIGRvbid0IG5lZWQgdG8gY2hlY2sgZm9yIHVwZGF0ZXMgb24gbm9uLW5wbSBleHRzXG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBkYXRlcyA9IGF3YWl0IHRoaXMuY2hlY2tGb3JFeHRlbnNpb25VcGRhdGUoZXh0KTtcbiAgICAgICAgZGF0YS51cGRhdGVWZXJzaW9uID0gdXBkYXRlcy5zYWZlVXBkYXRlO1xuICAgICAgICBkYXRhLnVuc2FmZVVwZGF0ZVZlcnNpb24gPSB1cGRhdGVzLnVuc2FmZVVwZGF0ZTtcbiAgICAgICAgZGF0YS51cFRvRGF0ZSA9IHVwZGF0ZXMuc2FmZVVwZGF0ZSA9PT0gbnVsbCAmJiB1cGRhdGVzLnVuc2FmZVVwZGF0ZSA9PT0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGlmIHdlJ3JlIGp1c3QgZ2V0dGluZyB0aGUgZGF0YSwgc2hvcnQgY2lyY3VpdCByZXR1cm4gaGVyZSBzaW5jZSB3ZSBkb24ndCBuZWVkIHRvIGRvIGFueVxuICAgIC8vIGZvcm1hdHRpbmcgbG9naWNcbiAgICBpZiAodGhpcy5pc0pzb25PdXRwdXQpIHtcbiAgICAgIHJldHVybiBleHRzO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgW1xuICAgICAgbmFtZSxcbiAgICAgIHtpbnN0YWxsVHlwZSwgaW5zdGFsbFNwZWMsIGluc3RhbGxlZCwgdXBkYXRlVmVyc2lvbiwgdW5zYWZlVXBkYXRlVmVyc2lvbiwgdmVyc2lvbiwgdXBUb0RhdGV9XG4gICAgXSBvZiBfLnRvUGFpcnMoZXh0cykpIHtcbiAgICAgIGxldCB0eXBlVHh0O1xuICAgICAgc3dpdGNoIChpbnN0YWxsVHlwZSkge1xuICAgICAgICBjYXNlIElOU1RBTExfVFlQRV9HSVQ6XG4gICAgICAgIGNhc2UgSU5TVEFMTF9UWVBFX0dJVEhVQjpcbiAgICAgICAgICB0eXBlVHh0ID0gYChjbG9uZWQgZnJvbSAke2luc3RhbGxTcGVjfSlgLnllbGxvdztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBJTlNUQUxMX1RZUEVfTE9DQUw6XG4gICAgICAgICAgdHlwZVR4dCA9IGAobGlua2VkIGZyb20gJHtpbnN0YWxsU3BlY30pYC5tYWdlbnRhO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHR5cGVUeHQgPSAnKE5QTSknO1xuICAgICAgfVxuICAgICAgY29uc3QgaW5zdGFsbFR4dCA9IGluc3RhbGxlZCA/XG4gICAgICAgIGBAJHt2ZXJzaW9uLnllbGxvd30gJHsoJ1tpbnN0YWxsZWQgJyArIHR5cGVUeHQgKyAnXScpLmdyZWVufWAgOlxuICAgICAgICAnIFtub3QgaW5zdGFsbGVkXScuZ3JleTtcbiAgICAgIGNvbnN0IHVwZGF0ZVR4dCA9IHNob3dVcGRhdGVzICYmIHVwZGF0ZVZlcnNpb24gP1xuICAgICAgICBgIFske3VwZGF0ZVZlcnNpb259IGF2YWlsYWJsZV1gLm1hZ2VudGEgOlxuICAgICAgICAnJztcbiAgICAgIGNvbnN0IHVwVG9EYXRlVHh0ID0gc2hvd1VwZGF0ZXMgJiYgdXBUb0RhdGUgP1xuICAgICAgICBgIFtVcCB0byBkYXRlXWAuZ3JlZW4gOlxuICAgICAgICAnJztcbiAgICAgIGNvbnN0IHVuc2FmZVVwZGF0ZVR4dCA9IHNob3dVcGRhdGVzICYmIHVuc2FmZVVwZGF0ZVZlcnNpb24gP1xuICAgICAgICBgIFske3Vuc2FmZVVwZGF0ZVZlcnNpb259IGF2YWlsYWJsZSAocG90ZW50aWFsbHkgdW5zYWZlKV1gLmN5YW4gOlxuICAgICAgICAnJztcblxuICAgICAgY29uc29sZS5sb2coYC0gJHtuYW1lLnllbGxvd30ke2luc3RhbGxUeHR9JHt1cGRhdGVUeHR9JHt1cFRvRGF0ZVR4dH0ke3Vuc2FmZVVwZGF0ZVR4dH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXh0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsQXJnc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gZXh0IC0gdGhlIG5hbWUgb3Igc3BlYyBvZiBhbiBleHRlbnNpb24gdG8gaW5zdGFsbFxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gaW5zdGFsbFR5cGUgLSBob3cgdG8gaW5zdGFsbCB0aGlzIGV4dGVuc2lvbi4gT25lIG9mIHRoZSBJTlNUQUxMX1RZUEVTXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcGFja2FnZU5hbWVdIC0gZm9yIGdpdC9naXRodWIgaW5zdGFsbHMsIHRoZSBleHRlbnNpb24gbm9kZSBwYWNrYWdlIG5hbWVcbiAgICovXG5cbiAgLyoqXG4gICAqIEluc3RhbGwgYW4gZXh0ZW5zaW9uXG4gICAqXG4gICAqIEBwYXJhbSB7SW5zdGFsbEFyZ3N9IGFyZ3NcbiAgICogQHJldHVybiB7b2JqZWN0fSBtYXAgb2YgYWxsIGluc3RhbGxlZCBleHRlbnNpb24gbmFtZXMgdG8gZXh0ZW5zaW9uIGRhdGFcbiAgICovXG4gIGFzeW5jIGluc3RhbGwgKHtleHQsIGluc3RhbGxUeXBlLCBwYWNrYWdlTmFtZX0pIHtcbiAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGBBdHRlbXB0aW5nIHRvIGZpbmQgYW5kIGluc3RhbGwgJHt0aGlzLnR5cGV9ICcke2V4dH0nYCk7XG5cbiAgICBsZXQgZXh0RGF0YTtcbiAgICBsZXQgaW5zdGFsbFNwZWMgPSBleHQ7XG5cbiAgICBpZiAocGFja2FnZU5hbWUgJiYgW0lOU1RBTExfVFlQRV9MT0NBTCwgSU5TVEFMTF9UWVBFX05QTV0uaW5jbHVkZXMoaW5zdGFsbFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFdoZW4gdXNpbmcgLS1zb3VyY2U9JHtpbnN0YWxsVHlwZX0sIGNhbm5vdCBhbHNvIHVzZSAtLXBhY2thZ2VgKTtcbiAgICB9XG5cbiAgICBpZiAoIXBhY2thZ2VOYW1lICYmIFtJTlNUQUxMX1RZUEVfR0lULCBJTlNUQUxMX1RZUEVfR0lUSFVCXS5pbmNsdWRlcyhpbnN0YWxsVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgV2hlbiB1c2luZyAtLXNvdXJjZT0ke2luc3RhbGxUeXBlfSwgbXVzdCBhbHNvIHVzZSAtLXBhY2thZ2VgKTtcbiAgICB9XG5cbiAgICBpZiAoaW5zdGFsbFR5cGUgPT09IElOU1RBTExfVFlQRV9MT0NBTCkge1xuICAgICAgY29uc3QgbXNnID0gYExpbmtpbmcgJHt0aGlzLnR5cGV9IGZyb20gbG9jYWwgcGF0aGA7XG4gICAgICBjb25zdCBwa2dKc29uRGF0YSA9IGF3YWl0IHNwaW5XaXRoKHRoaXMuaXNKc29uT3V0cHV0LCBtc2csIGFzeW5jICgpID0+IChcbiAgICAgICAgYXdhaXQgdGhpcy5ucG0ubGlua1BhY2thZ2UoaW5zdGFsbFNwZWMpKVxuICAgICAgKTtcbiAgICAgIGV4dERhdGEgPSB0aGlzLmdldEV4dGVuc2lvbkZpZWxkcyhwa2dKc29uRGF0YSk7XG4gICAgICBleHREYXRhLmluc3RhbGxQYXRoID0gZXh0RGF0YS5wa2dOYW1lO1xuICAgIH0gZWxzZSBpZiAoaW5zdGFsbFR5cGUgPT09IElOU1RBTExfVFlQRV9HSVRIVUIpIHtcbiAgICAgIGlmIChpbnN0YWxsU3BlYy5zcGxpdCgnLycpLmxlbmd0aCAhPT0gMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEdpdGh1YiAke3RoaXMudHlwZX0gc3BlYyAke2luc3RhbGxTcGVjfSBhcHBlYXJlZCB0byBiZSBpbnZhbGlkOyBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdpdCBzaG91bGQgYmUgb2YgdGhlIGZvcm0gPG9yZz4vPHJlcG8+Jyk7XG4gICAgICB9XG4gICAgICBleHREYXRhID0gYXdhaXQgdGhpcy5pbnN0YWxsVmlhTnBtKHtleHQ6IGluc3RhbGxTcGVjLCBwa2dOYW1lOiBwYWNrYWdlTmFtZX0pO1xuICAgIH0gZWxzZSBpZiAoaW5zdGFsbFR5cGUgPT09IElOU1RBTExfVFlQRV9HSVQpIHtcbiAgICAgIC8vIGdpdCB1cmxzIGNhbiBoYXZlICcuZ2l0JyBhdCB0aGUgZW5kLCBidXQgdGhpcyBpcyBub3QgbmVjZXNzYXJ5IGFuZCB3b3VsZCBjb21wbGljYXRlIHRoZVxuICAgICAgLy8gd2F5IHdlIGRvd25sb2FkIGFuZCBuYW1lIGRpcmVjdG9yaWVzLCBzbyB3ZSBjYW4ganVzdCByZW1vdmUgaXRcbiAgICAgIGluc3RhbGxTcGVjID0gaW5zdGFsbFNwZWMucmVwbGFjZSgvXFwuZ2l0JC8sICcnKTtcbiAgICAgIGV4dERhdGEgPSBhd2FpdCB0aGlzLmluc3RhbGxWaWFOcG0oe2V4dDogaW5zdGFsbFNwZWMsIHBrZ05hbWU6IHBhY2thZ2VOYW1lfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGF0IHRoaXMgcG9pbnQgd2UgaGF2ZSBlaXRoZXIgYW4gbnBtIHBhY2thZ2Ugb3IgYW4gYXBwaXVtIHZlcmlmaWVkIGV4dGVuc2lvblxuICAgICAgLy8gbmFtZS4gYm90aCBvZiB3aGljaCB3aWxsIGJlIGluc3RhbGxlZCB2aWEgbnBtLlxuICAgICAgLy8gZXh0ZW5zaW9ucyBpbnN0YWxsZWQgdmlhIG5wbSBjYW4gaW5jbHVkZSB2ZXJzaW9ucyBvciB0YWdzIGFmdGVyIHRoZSAnQCdcbiAgICAgIC8vIHNpZ24sIHNvIGNoZWNrIGZvciB0aGF0LiBXZSBhbHNvIG5lZWQgdG8gYmUgY2FyZWZ1bCB0aGF0IHBhY2thZ2UgbmFtZXMgdGhlbXNlbHZlcyBjYW5cbiAgICAgIC8vIGNvbnRhaW4gdGhlICdAJyBzeW1ib2wsIGFzIGluIGBucG0gaW5zdGFsbCBAYXBwaXVtL2Zha2UtZHJpdmVyQDEuMi4wYFxuICAgICAgbGV0IG5hbWUsIHBrZ1ZlcjtcbiAgICAgIGNvbnN0IHNwbGl0cyA9IGluc3RhbGxTcGVjLnNwbGl0KCdAJyk7XG4gICAgICBpZiAoaW5zdGFsbFNwZWNbMF0gPT09ICdAJykge1xuICAgICAgICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdoZXJlIHdlIGhhdmUgYW4gbnBtIG9yZyBpbmNsdWRlZCBpbiB0aGUgcGFja2FnZSBuYW1lXG4gICAgICAgIFtuYW1lLCBwa2dWZXJdID0gW2BAJHtzcGxpdHNbMV19YCwgc3BsaXRzWzJdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2l0aG91dCBhbiBucG0gb3JnXG4gICAgICAgIFtuYW1lLCBwa2dWZXJdID0gc3BsaXRzO1xuICAgICAgfVxuICAgICAgbGV0IHBrZ05hbWU7XG5cbiAgICAgIGlmIChpbnN0YWxsVHlwZSA9PT0gSU5TVEFMTF9UWVBFX05QTSkge1xuICAgICAgICAvLyBpZiB3ZSdyZSBpbnN0YWxsaW5nIGEgbmFtZWQgcGFja2FnZSBmcm9tIG5wbSwgd2UgZG9uJ3QgbmVlZCB0byBjaGVja1xuICAgICAgICAvLyBhZ2FpbnN0IHRoZSBhcHBpdW0gZXh0ZW5zaW9uIGxpc3Q7IGp1c3QgdXNlIHRoZSBpbnN0YWxsU3BlYyBhcyBpc1xuICAgICAgICBwa2dOYW1lID0gbmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGlmIHdlJ3JlIGluc3RhbGxpbmcgYSBuYW1lZCBhcHBpdW0gZHJpdmVyIChsaWtlICd4Y3VpdGVzdCcpIHdlIG5lZWQgdG9cbiAgICAgICAgLy8gZGVyZWZlcmVuY2UgdGhlIGFjdHVhbCBucG0gcGFja2FnZSAoJ2FwcGl1cG0teGN1aXRlc3QtZHJpdmVyJyksIHNvXG4gICAgICAgIC8vIGNoZWNrIGl0IGV4aXN0cyBhbmQgZ2V0IHRoZSBjb3JyZWN0IHBhY2thZ2VcbiAgICAgICAgY29uc3Qga25vd25OYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMua25vd25FeHRlbnNpb25zKTtcbiAgICAgICAgaWYgKCFfLmluY2x1ZGVzKGtub3duTmFtZXMsIG5hbWUpKSB7XG4gICAgICAgICAgY29uc3QgbXNnID0gYENvdWxkIG5vdCByZXNvbHZlICR7dGhpcy50eXBlfTsgYXJlIHlvdSBzdXJlIGl0J3MgaW4gdGhlIGxpc3QgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYG9mIHN1cHBvcnRlZCAke3RoaXMudHlwZX1zPyAke0pTT04uc3RyaW5naWZ5KGtub3duTmFtZXMpfWA7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgICAgIH1cbiAgICAgICAgcGtnTmFtZSA9IHRoaXMua25vd25FeHRlbnNpb25zW25hbWVdO1xuICAgICAgICAvLyBnaXZlbiB0aGF0IHdlJ2xsIHVzZSB0aGUgaW5zdGFsbCB0eXBlIGluIHRoZSBkcml2ZXIganNvbiwgc3RvcmUgaXQgYXNcbiAgICAgICAgLy8gJ25wbScgbm93XG4gICAgICAgIGluc3RhbGxUeXBlID0gSU5TVEFMTF9UWVBFX05QTTtcbiAgICAgIH1cblxuICAgICAgZXh0RGF0YSA9IGF3YWl0IHRoaXMuaW5zdGFsbFZpYU5wbSh7ZXh0LCBwa2dOYW1lLCBwa2dWZXJ9KTtcbiAgICB9XG5cbiAgICBjb25zdCBleHROYW1lID0gZXh0RGF0YVtgJHt0aGlzLnR5cGV9TmFtZWBdO1xuICAgIGRlbGV0ZSBleHREYXRhW2Ake3RoaXMudHlwZX1OYW1lYF07XG5cbiAgICBpZiAodGhpcy5jb25maWcuaXNJbnN0YWxsZWQoZXh0TmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQSAke3RoaXMudHlwZX0gbmFtZWQgJyR7ZXh0TmFtZX0nIGlzIGFscmVhZHkgaW5zdGFsbGVkLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgRGlkIHlvdSBtZWFuIHRvIHVwZGF0ZT8gJ2FwcGl1bSAke3RoaXMudHlwZX0gdXBkYXRlJy4gU2VlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBpbnN0YWxsZWQgJHt0aGlzLnR5cGV9cyB3aXRoICdhcHBpdW0gJHt0aGlzLnR5cGV9IGxpc3QgLS1pbnN0YWxsZWQnLmApO1xuICAgIH1cblxuICAgIGV4dERhdGEuaW5zdGFsbFR5cGUgPSBpbnN0YWxsVHlwZTtcbiAgICBleHREYXRhLmluc3RhbGxTcGVjID0gaW5zdGFsbFNwZWM7XG4gICAgYXdhaXQgdGhpcy5jb25maWcuYWRkRXh0ZW5zaW9uKGV4dE5hbWUsIGV4dERhdGEpO1xuXG4gICAgLy8gbG9nIGluZm8gZm9yIHRoZSB1c2VyXG4gICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCB0aGlzLmdldFBvc3RJbnN0YWxsVGV4dCh7ZXh0TmFtZSwgZXh0RGF0YX0pKTtcblxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEluc3RhbGxWaWFOcG1BcmdzXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBleHQgLSB0aGUgbmFtZSBvciBzcGVjIG9mIGFuIGV4dGVuc2lvbiB0byBpbnN0YWxsXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwa2dOYW1lIC0gdGhlIE5QTSBwYWNrYWdlIG5hbWUgb2YgdGhlIGV4dGVuc2lvblxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3BrZ1Zlcl0gLSB0aGUgc3BlY2lmaWMgdmVyc2lvbiBvZiB0aGUgTlBNIHBhY2thZ2VcbiAgICovXG5cbiAgLyoqXG4gICAqIEluc3RhbGwgYW4gZXh0ZW5zaW9uIHZpYSBOUE1cbiAgICpcbiAgICogQHBhcmFtIHtJbnN0YWxsVmlhTnBtQXJnc30gYXJnc1xuICAgKi9cbiAgYXN5bmMgaW5zdGFsbFZpYU5wbSAoe2V4dCwgcGtnTmFtZSwgcGtnVmVyfSkge1xuICAgIGNvbnN0IG5wbVNwZWMgPSBgJHtwa2dOYW1lfSR7cGtnVmVyID8gJ0AnICsgcGtnVmVyIDogJyd9YDtcbiAgICBjb25zdCBzcGVjTXNnID0gbnBtU3BlYyA9PT0gZXh0ID8gJycgOiBgIHVzaW5nIE5QTSBpbnN0YWxsIHNwZWMgJyR7bnBtU3BlY30nYDtcbiAgICBjb25zdCBtc2cgPSBgSW5zdGFsbGluZyAnJHtleHR9JyR7c3BlY01zZ31gO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwa2dKc29uRGF0YSA9IGF3YWl0IHNwaW5XaXRoKHRoaXMuaXNKc29uT3V0cHV0LCBtc2csIGFzeW5jICgpID0+IChcbiAgICAgICAgYXdhaXQgdGhpcy5ucG0uaW5zdGFsbFBhY2thZ2Uoe1xuICAgICAgICAgIHBrZ0RpcjogcGF0aC5yZXNvbHZlKHRoaXMuY29uZmlnLmFwcGl1bUhvbWUsIHBrZ05hbWUpLFxuICAgICAgICAgIHBrZ05hbWUsXG4gICAgICAgICAgcGtnVmVyXG4gICAgICAgIH0pXG4gICAgICApKTtcbiAgICAgIGNvbnN0IGV4dERhdGEgPSB0aGlzLmdldEV4dGVuc2lvbkZpZWxkcyhwa2dKc29uRGF0YSk7XG4gICAgICBleHREYXRhLmluc3RhbGxQYXRoID0gcGtnTmFtZTtcbiAgICAgIHJldHVybiBleHREYXRhO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbmNvdW50ZXJlZCBhbiBlcnJvciB3aGVuIGluc3RhbGxpbmcgcGFja2FnZTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gRXh0ZW5zaW9uQXJnc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gZXh0TmFtZSAtIHRoZSBuYW1lIG9mIGFuIGV4dGVuc2lvblxuICAgKiBAcHJvcGVydHkge29iamVjdH0gZXh0RGF0YSAtIHRoZSBkYXRhIGZvciBhbiBpbnN0YWxsZWQgZXh0ZW5zaW9uXG4gICAqL1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgd2hpY2ggc2hvdWxkIGJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhZnRlciBhbiBleHRlbnNpb24gaGFzIGJlZW4gaW5zdGFsbGVkLiBUaGlzXG4gICAqIGlzIGRlc2lnbmVkIHRvIGJlIG92ZXJyaWRkZW4gYnkgZHJpdmVycy9wbHVnaW5zIHdpdGggdGhlaXIgb3duIHBhcnRpY3VsYXIgdGV4dC5cbiAgICpcbiAgICogQHBhcmFtIHtFeHRlbnNpb25BcmdzfSBhcmdzXG4gICAqL1xuICBnZXRQb3N0SW5zdGFsbFRleHQgKC8qe2V4dE5hbWUsIGV4dERhdGF9Ki8pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ011c3QgYmUgaW1wbGVtZW50ZWQgaW4gZmluYWwgY2xhc3MnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlIGFuIE5QTSBtb2R1bGUncyBwYWNrYWdlLmpzb24gYW5kIGV4dHJhY3QgQXBwaXVtIGRyaXZlciBpbmZvcm1hdGlvbiBmcm9tIGEgc3BlY2lhbFxuICAgKiAnYXBwaXVtJyBmaWVsZCBpbiB0aGUgSlNPTiBkYXRhLiBXZSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gdG8gZS5nLiBkZXRlcm1pbmUgd2hpY2ggY2xhc3MgdG9cbiAgICogbG9hZCBhcyB0aGUgbWFpbiBkcml2ZXIgY2xhc3MsIG9yIHRvIGJlIGFibGUgdG8gZGV0ZWN0IGluY29tcGF0aWJpbGl0aWVzIGJldHdlZW4gZHJpdmVyIGFuZFxuICAgKiBhcHBpdW0gdmVyc2lvbnMuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwa2dKc29uRGF0YSAtIHRoZSBwYWNrYWdlLmpzb24gZGF0YSBmb3IgYSBkcml2ZXIgbW9kdWxlLCBhcyBpZiBpdCBoYWQgYmVlblxuICAgKiBzdHJhaWdodGZvcndhcmRseSAncmVxdWlyZSdkXG4gICAqL1xuICBnZXRFeHRlbnNpb25GaWVsZHMgKHBrZ0pzb25EYXRhKSB7XG4gICAgaWYgKCFwa2dKc29uRGF0YS5hcHBpdW0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5zdGFsbGVkIGRyaXZlciBkaWQgbm90IGhhdmUgYW4gJ2FwcGl1bScgc2VjdGlvbiBpbiBpdHMgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYHBhY2thZ2UuanNvbiBmaWxlIGFzIGV4cGVjdGVkYCk7XG4gICAgfVxuICAgIGNvbnN0IHthcHBpdW0sIG5hbWUsIHZlcnNpb259ID0gcGtnSnNvbkRhdGE7XG4gICAgdGhpcy52YWxpZGF0ZUV4dGVuc2lvbkZpZWxkcyhhcHBpdW0pO1xuXG4gICAgcmV0dXJuIHsuLi5hcHBpdW0sIHBrZ05hbWU6IG5hbWUsIHZlcnNpb259O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvciBhbnkgcGFja2FnZS5qc29uIGZpZWxkcyB3aGljaCBhIHBhcnRpY3VsYXIgdHlwZSBvZiBleHRlbnNpb24gcmVxdWlyZXMsIHZhbGlkYXRlIHRoZVxuICAgKiBwcmVzZW5jZSBhbmQgZm9ybSBvZiB0aG9zZSBmaWVsZHMgb24gdGhlIHBhY2thZ2UuanNvbiBkYXRhLCB0aHJvd2luZyBhbiBlcnJvciBpZiBhbnl0aGluZyBpc1xuICAgKiBhbWlzcy5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGFwcGl1bVBrZ0RhdGEgLSB0aGUgZGF0YSBpbiB0aGUgXCJhcHBpdW1cIiBmaWVsZCBvZiBwYWNrYWdlLmpzb24gZm9yIGFuXG4gICAqIGV4dGVuc2lvblxuICAgKi9cbiAgdmFsaWRhdGVFeHRlbnNpb25GaWVsZHMgKC8qYXBwaXVtUGtnRGF0YSovKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IGJlIGltcGxlbWVudGVkIGluIGZpbmFsIGNsYXNzJyk7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gVW5pbnN0YWxsQXJnc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gZXh0IC0gdGhlIG5hbWUgb3Igc3BlYyBvZiBhbiBleHRlbnNpb24gdG8gdW5pbnN0YWxsXG4gICAqL1xuXG4gIC8qKlxuICAgKiBVbmluc3RhbGwgYW4gZXh0ZW5zaW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VW5pbnN0YWxsQXJnc30gYXJnc1xuICAgKiBAcmV0dXJuIHtvYmplY3R9IG1hcCBvZiBhbGwgaW5zdGFsbGVkIGV4dGVuc2lvbiBuYW1lcyB0byBleHRlbnNpb24gZGF0YVxuICAgKi9cbiAgYXN5bmMgdW5pbnN0YWxsICh7ZXh0fSkge1xuICAgIGlmICghdGhpcy5jb25maWcuaXNJbnN0YWxsZWQoZXh0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCB1bmluc3RhbGwgJHt0aGlzLnR5cGV9ICcke2V4dH0nOyBpdCBpcyBub3QgaW5zdGFsbGVkYCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5jb25maWcuZ2V0SW5zdGFsbFBhdGgoZXh0KSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IHRoaXMuY29uZmlnLnJlbW92ZUV4dGVuc2lvbihleHQpO1xuICAgIH1cbiAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGBTdWNjZXNzZnVsbHkgdW5pbnN0YWxsZWQgJHt0aGlzLnR5cGV9ICcke2V4dH0nYC5ncmVlbik7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnM7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gRXh0ZW5zaW9uVXBkYXRlT3B0c1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gZXh0IC0gdGhlIG5hbWUgb2YgdGhlIGV4dGVuc2lvbiB0byB1cGRhdGVcbiAgICogQHByb3BlcnR5IHtib29sZWFufSB1bnNhZmUgLSBpZiB0cnVlLCB3aWxsIHBlcmZvcm0gdW5zYWZlIHVwZGF0ZXMgcGFzdCBtYWpvciByZXZpc2lvblxuICAgKiBib3VuZGFyaWVzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBVcGRhdGVSZXBvcnRcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGZyb20gLSB2ZXJzaW9uIHVwZGF0ZWQgZnJvbVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gdG8gLSB2ZXJzaW9uIHVwZGF0ZWQgdG9cbiAgICovXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEV4dGVuc2lvblVwZGF0ZVJlc3VsdFxuICAgKiBAcHJvcGVydHkge09iamVjdH0gZXJyb3JzIC0gbWFwIG9mIGV4dCBuYW1lcyB0byBlcnJvciBvYmplY3RzXG4gICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSB1cGRhdGVzIC0gbWFwIG9mIGV4dCBuYW1lcyB0byB7QGxpbmsgVXBkYXRlUmVwb3J0fXNcbiAgICovXG5cbiAgLyoqXG4gICAqIEF0dGVtcHQgdG8gdXBkYXRlIG9uZSBvciBtb3JlIGRyaXZlcnMgdXNpbmcgTlBNXG4gICAqXG4gICAqIEBwYXJhbSB7RXh0ZW5zaW9uVXBkYXRlT3B0c30gdXBkYXRlU3BlY1xuICAgKiBAcmV0dXJuIHtFeHRlbnNpb25VcGRhdGVSZXN1bHR9XG4gICAqL1xuICBhc3luYyB1cGRhdGUgKHtleHQsIHVuc2FmZX0pIHtcbiAgICBjb25zdCBzaG91bGRVcGRhdGVBbGwgPSBleHQgPT09IFVQREFURV9BTEw7XG4gICAgLy8gaWYgd2UncmUgc3BlY2lmaWNhbGx5IHJlcXVlc3RpbmcgYW4gdXBkYXRlIGZvciBhbiBleHRlbnNpb24sIG1ha2Ugc3VyZSBpdCdzIGluc3RhbGxlZFxuICAgIGlmICghc2hvdWxkVXBkYXRlQWxsICYmICF0aGlzLmNvbmZpZy5pc0luc3RhbGxlZChleHQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAke3RoaXMudHlwZX0gJyR7ZXh0fScgd2FzIG5vdCBpbnN0YWxsZWQsIHNvIGNhbid0IGJlIHVwZGF0ZWRgKTtcbiAgICB9XG4gICAgY29uc3QgZXh0c1RvVXBkYXRlID0gc2hvdWxkVXBkYXRlQWxsID8gT2JqZWN0LmtleXModGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucykgOiBbZXh0XTtcblxuICAgIC8vICdlcnJvcnMnIHdpbGwgaGF2ZSBleHQgbmFtZXMgYXMga2V5cyBhbmQgZXJyb3Igb2JqZWN0cyBhcyB2YWx1ZXNcbiAgICBjb25zdCBlcnJvcnMgPSB7fTtcblxuICAgIC8vICd1cGRhdGVzJyB3aWxsIGhhdmUgZXh0IG5hbWVzIGFzIGtleXMgYW5kIHVwZGF0ZSBvYmplY3RzIGFzIHZhbHVlcywgd2hlcmUgYW4gdXBkYXRlXG4gICAgLy8gb2JqZWN0IGlzIG9mIHRoZSBmb3JtIHtmcm9tOiB2ZXJzaW9uU3RyaW5nLCB0bzogdmVyc2lvblN0cmluZ31cbiAgICBjb25zdCB1cGRhdGVzID0ge307XG5cbiAgICBmb3IgKGNvbnN0IGUgb2YgZXh0c1RvVXBkYXRlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgYENoZWNraW5nIGlmICR7dGhpcy50eXBlfSAnJHtlfScgaXMgdXBkYXRhYmxlYCwgKCkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2VdLmluc3RhbGxUeXBlICE9PSBJTlNUQUxMX1RZUEVfTlBNKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTm90VXBkYXRhYmxlRXJyb3IoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB1cGRhdGUgPSBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgYENoZWNraW5nIGlmICR7dGhpcy50eXBlfSAnJHtlfScgbmVlZHMgYW4gdXBkYXRlYCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGF3YWl0IHRoaXMuY2hlY2tGb3JFeHRlbnNpb25VcGRhdGUoZSk7XG4gICAgICAgICAgaWYgKCEodXBkYXRlLnNhZmVVcGRhdGUgfHwgdXBkYXRlLnVuc2FmZVVwZGF0ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBOb1VwZGF0ZXNBdmFpbGFibGVFcnJvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdXBkYXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCF1bnNhZmUgJiYgIXVwZGF0ZS5zYWZlVXBkYXRlKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJHt0aGlzLnR5cGV9ICcke2V9JyBoYXMgYSBtYWpvciByZXZpc2lvbiB1cGRhdGUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGAoJHt1cGRhdGUuY3VycmVudH0gPT4gJHt1cGRhdGUudW5zYWZlVXBkYXRlfSksIHdoaWNoIGNvdWxkIGluY2x1ZGUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBicmVha2luZyBjaGFuZ2VzLiBJZiB5b3Ugd2FudCB0byBhcHBseSB0aGlzIHVwZGF0ZSwgcmUtcnVuIHdpdGggLS11bnNhZmVgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGRhdGVWZXIgPSB1bnNhZmUgJiYgdXBkYXRlLnVuc2FmZVVwZGF0ZSA/IHVwZGF0ZS51bnNhZmVVcGRhdGUgOiB1cGRhdGUuc2FmZVVwZGF0ZTtcbiAgICAgICAgYXdhaXQgc3BpbldpdGgoXG4gICAgICAgICAgdGhpcy5pc0pzb25PdXRwdXQsXG4gICAgICAgICAgYFVwZGF0aW5nIGRyaXZlciAnJHtlfScgZnJvbSAke3VwZGF0ZS5jdXJyZW50fSB0byAke3VwZGF0ZVZlcn1gLFxuICAgICAgICAgIGFzeW5jICgpID0+IGF3YWl0IHRoaXMudXBkYXRlRXh0ZW5zaW9uKGUsIHVwZGF0ZVZlcilcbiAgICAgICAgKTtcbiAgICAgICAgdXBkYXRlc1tlXSA9IHtmcm9tOiB1cGRhdGUuY3VycmVudCwgdG86IHVwZGF0ZVZlcn07XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgZXJyb3JzW2VdID0gZXJyO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgJ1VwZGF0ZSByZXBvcnQ6Jyk7XG4gICAgZm9yIChjb25zdCBbZSwgdXBkYXRlXSBvZiBfLnRvUGFpcnModXBkYXRlcykpIHtcbiAgICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgYC0gJHt0aGlzLnR5cGV9ICR7ZX0gdXBkYXRlZDogJHt1cGRhdGUuZnJvbX0gPT4gJHt1cGRhdGUudG99YC5ncmVlbik7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2UsIGVycl0gb2YgXy50b1BhaXJzKGVycm9ycykpIHtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBOb3RVcGRhdGFibGVFcnJvcikge1xuICAgICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGAtICcke2V9JyB3YXMgbm90IGluc3RhbGxlZCB2aWEgbnBtLCBzbyB3ZSBjb3VsZCBub3QgY2hlY2sgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGZvciB1cGRhdGVzYC55ZWxsb3cpO1xuICAgICAgfSBlbHNlIGlmIChlcnIgaW5zdGFuY2VvZiBOb1VwZGF0ZXNBdmFpbGFibGVFcnJvcikge1xuICAgICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGAtICcke2V9JyBoYWQgbm8gdXBkYXRlcyBhdmFpbGFibGVgLnllbGxvdyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBvdGhlcndpc2UsIG1ha2UgaXQgcG9wIHdpdGggcmVkIVxuICAgICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGAtICcke2V9JyBmYWlsZWQgdG8gdXBkYXRlOiAke2Vycn1gLnJlZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHt1cGRhdGVzLCBlcnJvcnN9O1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIFBvc3NpYmxlVXBkYXRlc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gY3VycmVudCAtIGN1cnJlbnQgdmVyc2lvblxuICAgKiBAcHJvcGVydHkge3N0cmluZ3xudWxsfSBzYWZlVXBkYXRlIC0gdmVyc2lvbiB3ZSBjYW4gc2FmZWx5IHVwZGF0ZSB0byBpZiBpdCBleGlzdHMsIG9yIG51bGxcbiAgICogQHByb3BlcnR5IHtzdHJpbmd8bnVsbH0gdW5zYWZlVXBkYXRlIC0gdmVyc2lvbiB3ZSBjYW4gdW5zYWZlbHkgdXBkYXRlIHRvIGlmIGl0IGV4aXN0cywgb3IgbnVsbFxuICAgKi9cblxuICAvKipcbiAgICogR2l2ZW4gYW4gZXh0ZW5zaW9uIG5hbWUsIGZpZ3VyZSBvdXQgd2hhdCBpdHMgaGlnaGVzdCBwb3NzaWJsZSB2ZXJzaW9uIHVwZ3JhZGUgaXMsIGFuZCBhbHNvIHRoZVxuICAgKiBoaWdoZXN0IHBvc3NpYmxlIHNhZmUgdXBncmFkZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dCAtIG5hbWUgb2YgZXh0ZW5zaW9uXG4gICAqIEByZXR1cm4ge1Bvc3NpYmxlVXBkYXRlc31cbiAgICovXG4gIGFzeW5jIGNoZWNrRm9yRXh0ZW5zaW9uVXBkYXRlIChleHQpIHtcbiAgICAvLyBUT0RPIGRlY2lkZSBob3cgd2Ugd2FudCB0byBoYW5kbGUgYmV0YSB2ZXJzaW9ucz9cbiAgICAvLyB0aGlzIGlzIGEgaGVscGVyIG1ldGhvZCwgJ2V4dCcgaXMgYXNzdW1lZCB0byBhbHJlYWR5IGJlIGluc3RhbGxlZCBoZXJlLCBhbmQgb2YgdGhlIG5wbVxuICAgIC8vIGluc3RhbGwgdHlwZVxuICAgIGNvbnN0IHt2ZXJzaW9uLCBwa2dOYW1lfSA9IHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnNbZXh0XTtcbiAgICBsZXQgdW5zYWZlVXBkYXRlID0gYXdhaXQgdGhpcy5ucG0uZ2V0TGF0ZXN0VmVyc2lvbihwa2dOYW1lKTtcbiAgICBsZXQgc2FmZVVwZGF0ZSA9IGF3YWl0IHRoaXMubnBtLmdldExhdGVzdFNhZmVVcGdyYWRlVmVyc2lvbihwa2dOYW1lLCB2ZXJzaW9uKTtcbiAgICBpZiAoIXV0aWwuY29tcGFyZVZlcnNpb25zKHVuc2FmZVVwZGF0ZSwgJz4nLCB2ZXJzaW9uKSkge1xuICAgICAgLy8gdGhlIGxhdGVzdCB2ZXJzaW9uIGlzIG5vdCBncmVhdGVyIHRoYW4gdGhlIGN1cnJlbnQgdmVyc2lvbiwgc28gdGhlcmUncyBubyBwb3NzaWJsZSB1cGRhdGVcbiAgICAgIHVuc2FmZVVwZGF0ZSA9IG51bGw7XG4gICAgICBzYWZlVXBkYXRlID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHVuc2FmZVVwZGF0ZSAmJiB1bnNhZmVVcGRhdGUgPT09IHNhZmVVcGRhdGUpIHtcbiAgICAgIC8vIHRoZSBsYXRlc3QgdXBkYXRlIGlzIHRoZSBzYW1lIGFzIHRoZSBzYWZlIHVwZGF0ZSwgd2hpY2ggbWVhbnMgaXQncyBub3QgYWN0dWFsbHkgdW5zYWZlXG4gICAgICB1bnNhZmVVcGRhdGUgPSBudWxsO1xuICAgIH1cbiAgICBpZiAoc2FmZVVwZGF0ZSAmJiAhdXRpbC5jb21wYXJlVmVyc2lvbnMoc2FmZVVwZGF0ZSwgJz4nLCB2ZXJzaW9uKSkge1xuICAgICAgLy8gZXZlbiB0aGUgc2FmZSB1cGRhdGUgaXMgbm90IGxhdGVyIHRoYW4gdGhlIGN1cnJlbnQsIHNvIGl0IGlzIG5vdCBhY3R1YWxseSBhbiB1cGRhdGVcbiAgICAgIHNhZmVVcGRhdGUgPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4ge2N1cnJlbnQ6IHZlcnNpb24sIHNhZmVVcGRhdGUsIHVuc2FmZVVwZGF0ZX07XG4gIH1cblxuICAvKipcbiAgICogQWN0dWFsbHkgdXBkYXRlIGFuIGV4dGVuc2lvbiBpbnN0YWxsZWQgYnkgTlBNLCB1c2luZyB0aGUgTlBNIGNsaS4gQW5kIHVwZGF0ZSB0aGUgaW5zdGFsbGF0aW9uXG4gICAqIG1hbmlmZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0IC0gbmFtZSBvZiBleHRlbnNpb24gdG8gdXBkYXRlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uIC0gdmVyc2lvbiBzdHJpbmcgaWRlbnRpZmllciB0byB1cGRhdGUgZXh0ZW5zaW9uIHRvXG4gICAqL1xuICBhc3luYyB1cGRhdGVFeHRlbnNpb24gKGV4dCwgdmVyc2lvbikge1xuICAgIGNvbnN0IHtwa2dOYW1lfSA9IHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnNbZXh0XTtcbiAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5jb25maWcuZ2V0SW5zdGFsbFBhdGgoZXh0KSk7XG4gICAgY29uc3QgZXh0RGF0YSA9IGF3YWl0IHRoaXMuaW5zdGFsbFZpYU5wbSh7ZXh0LCBwa2dOYW1lLCBwa2dWZXI6IHZlcnNpb259KTtcbiAgICBkZWxldGUgZXh0RGF0YVtgJHt0aGlzLnR5cGV9TmFtZWBdO1xuICAgIGF3YWl0IHRoaXMuY29uZmlnLnVwZGF0ZUV4dGVuc2lvbihleHQsIGV4dERhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1bnMgYSBzY3JpcHQgY2FjaGVkIGluc2lkZSB0aGUgXCJzY3JpcHRzXCIgZmllbGQgdW5kZXIgXCJhcHBpdW1cIlxuICAgKiBpbnNpZGUgb2YgdGhlIGRyaXZlci9wbHVnaW5zIFwicGFja2FnZS5qc29uXCIgZmlsZS4gV2lsbCB0aHJvd1xuICAgKiBhbiBlcnJvciBpZiB0aGUgZHJpdmVyL3BsdWdpbiBkb2VzIG5vdCBjb250YWluIGEgXCJzY3JpcHRzXCIgZmllbGRcbiAgICogdW5kZXJuZWF0aCB0aGUgXCJhcHBpdW1cIiBmaWVsZCBpbiBpdHMgcGFja2FnZS5qc29uLCBpZiB0aGVcbiAgICogXCJzY3JpcHRzXCIgZmllbGQgaXMgbm90IGEgcGxhaW4gb2JqZWN0LCBvciBpZiB0aGUgc2NyaXB0TmFtZSBpc1xuICAgKiBub3QgZm91bmQgd2l0aGluIFwic2NyaXB0c1wiIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dCAtIG5hbWUgb2YgdGhlIGV4dGVuc2lvbiB0byBydW4gYSBzY3JpcHQgZnJvbVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2NyaXB0TmFtZSAtIG5hbWUgb2YgdGhlIHNjcmlwdCB0byBydW5cbiAgICogQHJldHVybiB7UnVuT3V0cHV0fVxuICAgKi9cbiAgYXN5bmMgcnVuICh7ZXh0LCBzY3JpcHROYW1lfSkge1xuICAgIGlmICghXy5oYXModGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucywgZXh0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBwbGVhc2UgaW5zdGFsbCB0aGUgJHt0aGlzLnR5cGV9IGZpcnN0YCk7XG4gICAgfVxuXG4gICAgY29uc3QgZXh0Q29uZmlnID0gdGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9uc1tleHRdO1xuXG4gICAgaWYgKCFfLmhhcyhleHRDb25maWcsICdzY3JpcHRzJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICR7dGhpcy50eXBlfSBuYW1lZCAnJHtleHR9JyBkb2VzIG5vdCBjb250YWluIHRoZSBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgXCJzY3JpcHRzXCIgZmllbGQgdW5kZXJuZWF0aCB0aGUgXCJhcHBpdW1cIiBmaWVsZCBpbiBpdHMgcGFja2FnZS5qc29uYCk7XG4gICAgfVxuXG4gICAgY29uc3QgZXh0U2NyaXB0cyA9IGV4dENvbmZpZy5zY3JpcHRzO1xuXG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZXh0U2NyaXB0cykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICR7dGhpcy50eXBlfSBuYW1lZCAnJHtleHR9JyBcInNjcmlwdHNcIiBmaWVsZCBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0YCk7XG4gICAgfVxuXG4gICAgaWYgKCFfLmhhcyhleHRTY3JpcHRzLCBzY3JpcHROYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJHt0aGlzLnR5cGV9IG5hbWVkICcke2V4dH0nIGRvZXMgbm90IHN1cHBvcnQgdGhlIHNjcmlwdDogJyR7c2NyaXB0TmFtZX0nYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcnVubmVyID0gbmV3IFN1YlByb2Nlc3MocHJvY2Vzcy5leGVjUGF0aCwgW2V4dFNjcmlwdHNbc2NyaXB0TmFtZV1dLCB7XG4gICAgICBjd2Q6IHRoaXMuY29uZmlnLmdldEV4dGVuc2lvblJlcXVpcmVQYXRoKGV4dClcbiAgICB9KTtcblxuICAgIGNvbnN0IG91dHB1dCA9IG5ldyBSaW5nQnVmZmVyKDUwKTtcblxuICAgIHJ1bm5lci5vbignc3RyZWFtLWxpbmUnLCAobGluZSkgPT4ge1xuICAgICAgb3V0cHV0LmVucXVldWUobGluZSk7XG4gICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGxpbmUpO1xuICAgIH0pO1xuXG4gICAgYXdhaXQgcnVubmVyLnN0YXJ0KDApO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJ1bm5lci5qb2luKCk7XG4gICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGAke3NjcmlwdE5hbWV9IHN1Y2Nlc3NmdWxseSByYW5gLmdyZWVuKTtcbiAgICAgIHJldHVybiB7b3V0cHV0OiBvdXRwdXQuZ2V0QnVmZigpfTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgYEVuY291bnRlcmVkIGFuIGVycm9yIHdoZW4gcnVubmluZyAnJHtzY3JpcHROYW1lfSc6ICR7ZXJyLm1lc3NhZ2V9YC5yZWQpO1xuICAgICAgcmV0dXJuIHtlcnJvcjogZXJyLm1lc3NhZ2UsIG91dHB1dDogb3V0cHV0LmdldEJ1ZmYoKX07XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUnVuT3V0cHV0XG4gKiBAcHJvcGVydHkge3N0cmluZ3x1bmRlZmluZWR9IGVycm9yIC0gZXJyb3IgbWVzc2FnZSBpZiBzY3JpcHQgcmFuIHVuc3VjY2Vzc2Z1bGx5LCBvdGhlcndpc2UgdW5kZWZpbmVkXG4gKiBAcHJvcGVydHkge3N0cmluZ1tdfSBvdXRwdXQgLSBzY3JpcHQgb3V0cHV0XG4gKi9cbiJdLCJmaWxlIjoibGliL2NsaS9leHRlbnNpb24tY29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
